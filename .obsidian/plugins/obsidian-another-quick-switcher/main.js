/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

"use strict";var Ks=Object.create;var Ee=Object.defineProperty;var Ns=Object.getOwnPropertyDescriptor;var Us=Object.getOwnPropertyNames;var Vs=Object.getPrototypeOf,Qs=Object.prototype.hasOwnProperty;var Ws=(n,i)=>()=>(i||n((i={exports:{}}).exports,i),i.exports),$s=(n,i)=>{for(var e in i)Ee(n,e,{get:i[e],enumerable:!0})},Mt=(n,i,e,t)=>{if(i&&typeof i=="object"||typeof i=="function")for(let s of Us(i))!Qs.call(n,s)&&s!==e&&Ee(n,s,{get:()=>i[s],enumerable:!(t=Ns(i,s))||t.enumerable});return n};var Lt=(n,i,e)=>(e=n!=null?Ks(Vs(n)):{},Mt(i||!n||!n.__esModule?Ee(e,"default",{value:n,enumerable:!0}):e,n)),js=n=>Mt(Ee({},"__esModule",{value:!0}),n);var st=Ws(J=>{"use strict";var tt=J&&J.__assign||function(){return tt=Object.assign||function(n){for(var i,e=1,t=arguments.length;e<t;e++){i=arguments[e];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(n[s]=i[s])}return n},tt.apply(this,arguments)},Gs=J&&J.__read||function(n,i){var e=typeof Symbol=="function"&&n[Symbol.iterator];if(!e)return n;var t=e.call(n),s,r=[],a;try{for(;(i===void 0||i-- >0)&&!(s=t.next()).done;)r.push(s.value)}catch(o){a={error:o}}finally{try{s&&!s.done&&(e=t.return)&&e.call(t)}finally{if(a)throw a.error}}return r},Ys=J&&J.__spreadArray||function(n,i,e){if(e||arguments.length===2)for(var t=0,s=i.length,r;t<s;t++)(r||!(t in i))&&(r||(r=Array.prototype.slice.call(i,0,t)),r[t]=i[t]);return n.concat(r||Array.prototype.slice.call(i))};Object.defineProperty(J,"__esModule",{value:!0});var Dt=function(n){if(typeof n=="object"&&n!==null){if(typeof Object.getPrototypeOf=="function"){var i=Object.getPrototypeOf(n);return i===Object.prototype||i===null}return Object.prototype.toString.call(n)==="[object Object]"}return!1},ee=function(){for(var n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];return n.reduce(function(e,t){if(Array.isArray(t))throw new TypeError("Arguments provided to ts-deepmerge must be objects, not arrays.");return Object.keys(t).forEach(function(s){["__proto__","constructor","prototype"].includes(s)||(Array.isArray(e[s])&&Array.isArray(t[s])?e[s]=ee.options.mergeArrays?Array.from(new Set(e[s].concat(t[s]))):t[s]:Dt(e[s])&&Dt(t[s])?e[s]=ee(e[s],t[s]):e[s]=t[s])}),e},{})},Rt={mergeArrays:!0};ee.options=Rt;ee.withOptions=function(n){for(var i=[],e=1;e<arguments.length;e++)i[e-1]=arguments[e];ee.options=tt({mergeArrays:!0},n);var t=ee.apply(void 0,Ys([],Gs(i),!1));return ee.options=Rt,t};J.default=ee});var rn={};$s(rn,{default:()=>Ze});module.exports=js(rn);var Os=require("obsidian"),Ht=Lt(st());var T=require("obsidian"),Jt=Lt(st());var U=class extends Error{constructor(i,e=`Unsupported type: ${i}`){super(e)}};function it(n,i,e){let t=new RegExp(i),s=a=>t?!!a.match(t):!1,r=a=>t?a.replace(t,e):a;return s(n)?r(n):n}var nt=n=>[...Array(n).keys()],rt=(n,i)=>Object.fromEntries(Object.entries(n).map(([e,t])=>[e,i(t)])),Bt=(n,i)=>Object.fromEntries(Object.entries(n).map(([e,t])=>[i(e),t])),H=(n,i="asc")=>(e,t)=>i==="asc"?n(e)>n(t)?1:n(t)>n(e)?-1:0:n(e)<n(t)?1:n(t)<n(e)?-1:0,at=(n,i)=>{let e={};for(let t of n){let s=i(t);e[s]||(e[s]=[]),e[s].push(t)}return e},Ot=(n,i)=>{let e={};for(let t of n){let s=i(t);e[s]=t}return e},ot=n=>{let i={};for(let e of n)i[e]?i[e]++:i[e]=1;return i};function lt(n){return n.reduce((i,e)=>(i.push(...e),i),[])}function $(n){return[...new Set(n)]}function Ce(n,i){let e=new Map;for(let t of n){let s=i(t);e.has(s)||e.set(s,t)}return Array.from(e.values())}function xe(n,i){return $(lt(n.map(i)))}function qt(n){return n.length===0?[]:n.reduce((i,e)=>i.filter(t=>e.includes(t)))}var pe=(n,i)=>{let e=(t,s)=>i(t)<=i(s)?t:s;return n.reduce(e)};function zt(n,i,e){return i.length===0?n:n.filter(t=>i.some(s=>e(t).startsWith(s)))}function _e(n,i,e){return i.length===0?n:n.filter(t=>!i.some(s=>e(t).startsWith(s)))}function Kt(n,i){return[...n].sort().join()===[...i].sort().join()}function Js(n,i){return n.reduce((e,t)=>{let s=i(t);return e[s]=s,e},{})}function ct(n){return Js(n,i=>i)}function ae(n,i){let e={...n};for(let[t,s]of Object.entries(e))i(t,s)&&delete e[t];return e}var Nt=n=>(i,e)=>n(i)>=n(e)?i:e;function ye(n,i){var t,s;let e=(s=(t=n.match(/.+[\\/]([^\\/]+)[\\/]?$/))==null?void 0:t[1])!=null?s:n;return i&&e.endsWith(i)?e.replace(i,""):e}function Ut(n){let i=ye(n).split(".").slice(1).pop();return i?`.${i}`:""}function we(n){var i,e;return(e=(i=n.match(/(.+)[\\/].+$/))==null?void 0:i[1])!=null?e:"."}function j(n){return n.replace(/\\/g,"/").replace(/\/+/g,"/")}function Vt(n,i){let e=/[\\/]/,t=[];n.split(e).forEach((r,a)=>{if(a===0&&r==="."){t=i.split("/");return}if(r===".."){a===0&&(t=i.split("/")),t=we(t.join("/")).split("/").filter(o=>o!==".");return}t=[...t,r]});let s=t.filter(r=>r!=="").join("/");return i[0]==="/"?`/${s}`:s}function te(n){return n?n.path.endsWith(".excalidraw.md")||n.path.endsWith(".excalidraw"):!1}var ut=[{base:"A",letters:"A\u24B6\uFF21\xC0\xC1\xC2\u1EA6\u1EA4\u1EAA\u1EA8\xC3\u0100\u0102\u1EB0\u1EAE\u1EB4\u1EB2\u0226\u01E0\xC4\u01DE\u1EA2\xC5\u01FA\u01CD\u0200\u0202\u1EA0\u1EAC\u1EB6\u1E00\u0104\u023A\u2C6F"},{base:"AA",letters:"\uA732"},{base:"AE",letters:"\xC6\u01FC\u01E2"},{base:"AO",letters:"\uA734"},{base:"AU",letters:"\uA736"},{base:"AV",letters:"\uA738\uA73A"},{base:"AY",letters:"\uA73C"},{base:"B",letters:"B\u24B7\uFF22\u1E02\u1E04\u1E06\u0243\u0182\u0181"},{base:"C",letters:"C\u24B8\uFF23\u0106\u0108\u010A\u010C\xC7\u1E08\u0187\u023B\uA73E"},{base:"D",letters:"D\u24B9\uFF24\u1E0A\u010E\u1E0C\u1E10\u1E12\u1E0E\u0110\u018B\u018A\u0189\uA779\xD0"},{base:"DZ",letters:"\u01F1\u01C4"},{base:"Dz",letters:"\u01F2\u01C5"},{base:"E",letters:"E\u24BA\uFF25\xC8\xC9\xCA\u1EC0\u1EBE\u1EC4\u1EC2\u1EBC\u0112\u1E14\u1E16\u0114\u0116\xCB\u1EBA\u011A\u0204\u0206\u1EB8\u1EC6\u0228\u1E1C\u0118\u1E18\u1E1A\u0190\u018E"},{base:"F",letters:"F\u24BB\uFF26\u1E1E\u0191\uA77B"},{base:"G",letters:"G\u24BC\uFF27\u01F4\u011C\u1E20\u011E\u0120\u01E6\u0122\u01E4\u0193\uA7A0\uA77D\uA77E"},{base:"H",letters:"H\u24BD\uFF28\u0124\u1E22\u1E26\u021E\u1E24\u1E28\u1E2A\u0126\u2C67\u2C75\uA78D"},{base:"I",letters:"I\u24BE\uFF29\xCC\xCD\xCE\u0128\u012A\u012C\u0130\xCF\u1E2E\u1EC8\u01CF\u0208\u020A\u1ECA\u012E\u1E2C\u0197"},{base:"J",letters:"J\u24BF\uFF2A\u0134\u0248"},{base:"K",letters:"K\u24C0\uFF2B\u1E30\u01E8\u1E32\u0136\u1E34\u0198\u2C69\uA740\uA742\uA744\uA7A2"},{base:"L",letters:"L\u24C1\uFF2C\u013F\u0139\u013D\u1E36\u1E38\u013B\u1E3C\u1E3A\u0141\u023D\u2C62\u2C60\uA748\uA746\uA780"},{base:"LJ",letters:"\u01C7"},{base:"Lj",letters:"\u01C8"},{base:"M",letters:"M\u24C2\uFF2D\u1E3E\u1E40\u1E42\u2C6E\u019C"},{base:"N",letters:"N\u24C3\uFF2E\u01F8\u0143\xD1\u1E44\u0147\u1E46\u0145\u1E4A\u1E48\u0220\u019D\uA790\uA7A4"},{base:"NJ",letters:"\u01CA"},{base:"Nj",letters:"\u01CB"},{base:"O",letters:"O\u24C4\uFF2F\xD2\xD3\xD4\u1ED2\u1ED0\u1ED6\u1ED4\xD5\u1E4C\u022C\u1E4E\u014C\u1E50\u1E52\u014E\u022E\u0230\xD6\u022A\u1ECE\u0150\u01D1\u020C\u020E\u01A0\u1EDC\u1EDA\u1EE0\u1EDE\u1EE2\u1ECC\u1ED8\u01EA\u01EC\xD8\u01FE\u0186\u019F\uA74A\uA74C"},{base:"OI",letters:"\u01A2"},{base:"OO",letters:"\uA74E"},{base:"OU",letters:"\u0222"},{base:"OE",letters:"\x8C\u0152"},{base:"oe",letters:"\x9C\u0153"},{base:"P",letters:"P\u24C5\uFF30\u1E54\u1E56\u01A4\u2C63\uA750\uA752\uA754"},{base:"Q",letters:"Q\u24C6\uFF31\uA756\uA758\u024A"},{base:"R",letters:"R\u24C7\uFF32\u0154\u1E58\u0158\u0210\u0212\u1E5A\u1E5C\u0156\u1E5E\u024C\u2C64\uA75A\uA7A6\uA782"},{base:"S",letters:"S\u24C8\uFF33\u1E9E\u015A\u1E64\u015C\u1E60\u0160\u1E66\u1E62\u1E68\u0218\u015E\u2C7E\uA7A8\uA784"},{base:"T",letters:"T\u24C9\uFF34\u1E6A\u0164\u1E6C\u021A\u0162\u1E70\u1E6E\u0166\u01AC\u01AE\u023E\uA786"},{base:"TZ",letters:"\uA728"},{base:"U",letters:"U\u24CA\uFF35\xD9\xDA\xDB\u0168\u1E78\u016A\u1E7A\u016C\xDC\u01DB\u01D7\u01D5\u01D9\u1EE6\u016E\u0170\u01D3\u0214\u0216\u01AF\u1EEA\u1EE8\u1EEE\u1EEC\u1EF0\u1EE4\u1E72\u0172\u1E76\u1E74\u0244"},{base:"V",letters:"V\u24CB\uFF36\u1E7C\u1E7E\u01B2\uA75E\u0245"},{base:"VY",letters:"\uA760"},{base:"W",letters:"W\u24CC\uFF37\u1E80\u1E82\u0174\u1E86\u1E84\u1E88\u2C72"},{base:"X",letters:"X\u24CD\uFF38\u1E8A\u1E8C"},{base:"Y",letters:"Y\u24CE\uFF39\u1EF2\xDD\u0176\u1EF8\u0232\u1E8E\u0178\u1EF6\u1EF4\u01B3\u024E\u1EFE"},{base:"Z",letters:"Z\u24CF\uFF3A\u0179\u1E90\u017B\u017D\u1E92\u1E94\u01B5\u0224\u2C7F\u2C6B\uA762"},{base:"a",letters:"a\u24D0\uFF41\u1E9A\xE0\xE1\xE2\u1EA7\u1EA5\u1EAB\u1EA9\xE3\u0101\u0103\u1EB1\u1EAF\u1EB5\u1EB3\u0227\u01E1\xE4\u01DF\u1EA3\xE5\u01FB\u01CE\u0201\u0203\u1EA1\u1EAD\u1EB7\u1E01\u0105\u2C65\u0250"},{base:"aa",letters:"\uA733"},{base:"ae",letters:"\xE6\u01FD\u01E3"},{base:"ao",letters:"\uA735"},{base:"au",letters:"\uA737"},{base:"av",letters:"\uA739\uA73B"},{base:"ay",letters:"\uA73D"},{base:"b",letters:"b\u24D1\uFF42\u1E03\u1E05\u1E07\u0180\u0183\u0253"},{base:"c",letters:"c\u24D2\uFF43\u0107\u0109\u010B\u010D\xE7\u1E09\u0188\u023C\uA73F\u2184"},{base:"d",letters:"d\u24D3\uFF44\u1E0B\u010F\u1E0D\u1E11\u1E13\u1E0F\u0111\u018C\u0256\u0257\uA77A"},{base:"dz",letters:"\u01F3\u01C6"},{base:"e",letters:"e\u24D4\uFF45\xE8\xE9\xEA\u1EC1\u1EBF\u1EC5\u1EC3\u1EBD\u0113\u1E15\u1E17\u0115\u0117\xEB\u1EBB\u011B\u0205\u0207\u1EB9\u1EC7\u0229\u1E1D\u0119\u1E19\u1E1B\u0247\u025B\u01DD"},{base:"f",letters:"f\u24D5\uFF46\u1E1F\u0192\uA77C"},{base:"g",letters:"g\u24D6\uFF47\u01F5\u011D\u1E21\u011F\u0121\u01E7\u0123\u01E5\u0260\uA7A1\u1D79\uA77F"},{base:"h",letters:"h\u24D7\uFF48\u0125\u1E23\u1E27\u021F\u1E25\u1E29\u1E2B\u1E96\u0127\u2C68\u2C76\u0265"},{base:"hv",letters:"\u0195"},{base:"i",letters:"i\u24D8\uFF49\xEC\xED\xEE\u0129\u012B\u012D\xEF\u1E2F\u1EC9\u01D0\u0209\u020B\u1ECB\u012F\u1E2D\u0268\u0131"},{base:"j",letters:"j\u24D9\uFF4A\u0135\u01F0\u0249"},{base:"k",letters:"k\u24DA\uFF4B\u1E31\u01E9\u1E33\u0137\u1E35\u0199\u2C6A\uA741\uA743\uA745\uA7A3"},{base:"l",letters:"l\u24DB\uFF4C\u0140\u013A\u013E\u1E37\u1E39\u013C\u1E3D\u1E3B\u017F\u0142\u019A\u026B\u2C61\uA749\uA781\uA747"},{base:"lj",letters:"\u01C9"},{base:"m",letters:"m\u24DC\uFF4D\u1E3F\u1E41\u1E43\u0271\u026F"},{base:"n",letters:"n\u24DD\uFF4E\u01F9\u0144\xF1\u1E45\u0148\u1E47\u0146\u1E4B\u1E49\u019E\u0272\u0149\uA791\uA7A5"},{base:"nj",letters:"\u01CC"},{base:"o",letters:"o\u24DE\uFF4F\xF2\xF3\xF4\u1ED3\u1ED1\u1ED7\u1ED5\xF5\u1E4D\u022D\u1E4F\u014D\u1E51\u1E53\u014F\u022F\u0231\xF6\u022B\u1ECF\u0151\u01D2\u020D\u020F\u01A1\u1EDD\u1EDB\u1EE1\u1EDF\u1EE3\u1ECD\u1ED9\u01EB\u01ED\xF8\u01FF\u0254\uA74B\uA74D\u0275"},{base:"oi",letters:"\u01A3"},{base:"ou",letters:"\u0223"},{base:"oo",letters:"\uA74F"},{base:"p",letters:"p\u24DF\uFF50\u1E55\u1E57\u01A5\u1D7D\uA751\uA753\uA755"},{base:"q",letters:"q\u24E0\uFF51\u024B\uA757\uA759"},{base:"r",letters:"r\u24E1\uFF52\u0155\u1E59\u0159\u0211\u0213\u1E5B\u1E5D\u0157\u1E5F\u024D\u027D\uA75B\uA7A7\uA783"},{base:"s",letters:"s\u24E2\uFF53\xDF\u015B\u1E65\u015D\u1E61\u0161\u1E67\u1E63\u1E69\u0219\u015F\u023F\uA7A9\uA785\u1E9B"},{base:"t",letters:"t\u24E3\uFF54\u1E6B\u1E97\u0165\u1E6D\u021B\u0163\u1E71\u1E6F\u0167\u01AD\u0288\u2C66\uA787"},{base:"tz",letters:"\uA729"},{base:"u",letters:"u\u24E4\uFF55\xF9\xFA\xFB\u0169\u1E79\u016B\u1E7B\u016D\xFC\u01DC\u01D8\u01D6\u01DA\u1EE7\u016F\u0171\u01D4\u0215\u0217\u01B0\u1EEB\u1EE9\u1EEF\u1EED\u1EF1\u1EE5\u1E73\u0173\u1E77\u1E75\u0289"},{base:"v",letters:"v\u24E5\uFF56\u1E7D\u1E7F\u028B\uA75F\u028C"},{base:"vy",letters:"\uA761"},{base:"w",letters:"w\u24E6\uFF57\u1E81\u1E83\u0175\u1E87\u1E85\u1E98\u1E89\u2C73"},{base:"x",letters:"x\u24E7\uFF58\u1E8B\u1E8D"},{base:"y",letters:"y\u24E8\uFF59\u1EF3\xFD\u0177\u1EF9\u0233\u1E8F\xFF\u1EF7\u1E99\u1EF5\u01B4\u024F\u1EFF"},{base:"z",letters:"z\u24E9\uFF5A\u017A\u1E91\u017C\u017E\u1E93\u1E95\u01B6\u0225\u0240\u2C6C\uA763"},{base:"2",letters:"\xB2"},{base:"3",letters:"\xB3"}],Qt={};for(let n=0;n<ut.length;n++){let i=ut[n].letters;for(let e=0;e<i.length;e++)Qt[i[e]]=ut[n].base}var ht=Qt;var Wt=new RegExp(/[\u2700-\u27BF]|[\uE000-\uF8FF]|\uD83C[\uDC00-\uDFFF]|\uD83D[\uDC00-\uDFFF]|[\u2011-\u26FF]|\uD83E[\uDD10-\uDDFF]|[\uFE0E-\uFE0F]/,"g");function oe(n){return n.replace(/ /g,"")}function le(n){return n.replace(Wt,"")}function pt(n){return n.replace(/[^\u0000-\u007E]/g,i=>{var e;return(e=ht[i])!=null?e:i})}function B(n,i){let e=n.toLowerCase();return i?pt(e):e}function Pe(n){return n.replace(/[.*+?^=!:${}()|[\]/\\]/g,"\\$&")}function Xs(n,i,e){return B(n,e).includes(B(i,e))}function Zs(n,i){var s;let e=n.toLowerCase();return!i||e.charCodeAt(0)<=126?e:(s=ht[e])!=null?s:e}function ei(n,i,e){let t=new Array(e),s=0;for(let r=0;r<n.length;r++){let a=Zs(n[r],i);for(let o=0;o<a.length;o++)t[s++]=r}return t}function dt(n,i,e){let t=B(n,e),s=B(i,e);if(s.length===0)return{start:0,end:-1};let r=t.indexOf(s);if(r===-1)return null;let a=ei(n,e,t.length),o=r+s.length-1;return{start:a[r],end:a[o]}}function $t(n,i,e){return ve(i)?e?pt(n).includes(pt(i)):n.includes(i):Xs(n,i,e)}function E(n,i,e){return oe(B(n,e)).includes(oe(B(i,e)))}function jt(n,i,e){return oe(le(B(n,e))).startsWith(oe(B(i,e)))}function Gt(n,i,e){return oe(le(B(n,e)))===B(i,e)}function ce(n){return n.replace(/\[\[[^\]]+\|(.*?)]]/g,"$1").replace(/\[\[([^\]]+)]]/g,"$1").replace(/\[([^\]]+)]\(https?[^)]+\)/g,"$1").replace(/\[([^\]]+)]/g,"$1").replace(/`([^`]+)`/g,"$1").replace(/~~([^~]+)~~/g,"$1").replace(/==([^=]+)==/g,"$1").replace(/\*\*([^*]+)\*\*/g,"$1").replace(/\*([^*]+)\*/g,"$1").replace(/__([^_]+)__/g,"$1").replace(/_([^_]+)_/g,"$1").replace(/<[^>]+>([^<]+)<\/[^>]+>/g,"$1")}function gt(n){return n.split(",").filter(i=>i)}function se(n){return n.split(`
`).filter(i=>i)}function V(n){let i=[],e="",t=!1;for(let s=0;s<n.length;s++){let r=n[s],a=n[s+1];switch(r){case"\\":a==='"'?(e+='"',s++):e+=r;break;case'"':t=!t;break;case" ":t?e+=r:(i.push(e),e="");break;default:e+=r}}return i.push(e),i.filter(s=>s)}function O(n){return n.charAt(0).toUpperCase()+n.slice(1)}function ve(n){return n.toLowerCase()!==n}function mt(n,i){if(n.startsWith(i))return{type:"starts-with",score:2**i.length/n.length,ranges:[{start:0,end:i.length-1}]};let e=le(n);if(e.startsWith(i))return{type:"starts-with",score:2**i.length/n.length,ranges:[{start:0,end:i.length-1}]};let t=n.indexOf(i);if(t!==-1)return{type:"includes",score:2**i.length/n.length,ranges:[{start:t,end:t+i.length-1}]};let s=0,r=0,a=0,o=[],l=-1;for(let c=0;c<e.length;c++)if(e[c]===i[s]?(a===0&&(l=c),a++,s++):a>0&&(r+=2**a,o.push({start:l,end:l+a-1}),a=0),s===i.length)return a>0&&(r+=2**a,o.push({start:l,end:l+a-1})),{type:"fuzzy",score:r/n.length,ranges:o};return{type:"none",score:0}}function de(n,i,e){let t=B(n,e),s=oe(t),r=le(s),a=oe(B(i,e)),o=le(a);if(o===""&&a!==""){if(s.startsWith(a))return{type:"starts-with",score:.25,ranges:[{start:0,end:Array.from(a).length}]};if(s.includes(a)){let p=s.indexOf(a),h=Array.from(a).length;return{type:"includes",score:.5,ranges:[{start:p,end:p+h}]}}return{type:"none",score:0}}let l=mt(r,o);if(!l.ranges)return l;if(a!==o&&s.startsWith(a)){let p=Array.from(a).length;return{type:"starts-with",score:l.score*2,ranges:[{start:0,end:p}]}}let c=[],u=[],g=0;s.replace(Wt,(p,h)=>{let d=h,f=h+p.length;for(let v=g;v<d;v++)u[u.length]=v;return g=f,""});for(let p=g;p<s.length;p++)u[u.length]=p;let m=[];for(let p=0,h=0;p<t.length;p++)t[p]!==" "&&(m[h]=p,h++);for(let p of l.ranges){let h=u[p.start],d;if(p.start===p.end?d=h:d=u[p.end-1],h===void 0||d===void 0)continue;let f=m[h],v;if(p.start===p.end?v=f:v=m[d]+1,f===void 0||v===void 0)continue;let y=f;for(let w=f;w<=v;w++)if(t[w]===" "){for(w>y&&c.push({start:y,end:w-1});w<=v&&t[w]===" ";)w++;y=w,w--}y<=v&&c.push({start:y,end:v})}return{...l,ranges:c}}function Q(n,i){return n.length>i*2?`${n.slice(0,i)} ... ${n.slice(n.length-i)}`:n}function Yt(n,i){return Array.from(n.matchAll(i)).map(e=>({text:e[0],range:{start:e.index,end:e.index+e[0].length-1}}))}function ft(n){try{return new RegExp(n),!0}catch(i){return!1}}function ie(n){return n.position==null}var C=class{constructor(i){this.unsafeApp=i}getActiveFile(){return this.unsafeApp.workspace.getActiveFile()}getViewInActiveLeaf(){return this.unsafeApp.workspace.getActiveViewOfType(T.View)}getFileViewInActiveLeaf(){return this.unsafeApp.workspace.getActiveViewOfType(T.FileView)}getActiveFileLeaf(){var i,e;return(e=(i=this.getFileViewInActiveLeaf())==null?void 0:i.leaf)!=null?e:null}getMarkdownViewInActiveLeaf(){return this.unsafeApp.workspace.getActiveViewOfType(T.MarkdownView)}getCanvasViewInActiveLeaf(){return this.getViewInActiveLeaf()}getCurrentEditor(){var i,e;return(e=(i=this.getMarkdownViewInActiveLeaf())==null?void 0:i.editor)!=null?e:null}getCurrentDirPath(){var i,e,t;return(t=(e=(i=this.getActiveFile())==null?void 0:i.parent)==null?void 0:e.path)!=null?t:""}getCurrentOffset(){var t;let i=this.getCurrentEditor();if(!i)return null;let e=(t=this.getCurrentEditor())==null?void 0:t.getCursor();return e?i.posToOffset(e):null}getHeadersInActiveFile(){var e,t;let i=this.getActiveFile();return i?(t=(e=this.unsafeApp.metadataCache.getFileCache(i))==null?void 0:e.headings)!=null?t:[]:[]}getFolders(){return this.unsafeApp.vault.getAllLoadedFiles().filter(i=>i instanceof T.TFolder)}getLayout(){return this.unsafeApp.workspace.getLayout()}getLeftSideBarWidth(){return this.getLayout().left.collapsed?0:this.getLayout().left.width}getRightSideBarWidth(){return this.getLayout().right.collapsed?0:this.getLayout().right.width}async findExternalLinkUrls(i){let e=await this.unsafeApp.vault.read(i);return Array.from(e.matchAll(/https?:\/\/[^ \n)]+/g)).map(s=>s[0])}findFirstLinkOffset(i,e){var l,c,u;let t=this.unsafeApp.metadataCache.getFileCache(i),s=(l=t==null?void 0:t.links)!=null?l:[],r=(c=t==null?void 0:t.frontmatterLinks)!=null?c:[],a=(u=t==null?void 0:t.embeds)!=null?u:[],o=[...s,...r,...a].find(g=>{var p;return(this.isPhantomFile(e)?this.getPathToBeCreated(g.link):(p=this.unsafeApp.metadataCache.getFirstLinkpathDest((0,T.getLinkpath)(g.link),i.path))==null?void 0:p.path)===e.path});return!o||ie(o)?0:o.position.start.offset}findFirstHeaderOffset(i,e){var r,a;let t=this.unsafeApp.metadataCache.getFileCache(i);if(!t)return null;let s=(r=t.headings)==null?void 0:r.find(o=>ce(o.heading)===ce(e));return(a=s==null?void 0:s.position.start.offset)!=null?a:null}getBacklinksByFilePathInActiveFile(){let i=this.getActiveFile();return i?Object.fromEntries(this.unsafeApp.metadataCache.getBacklinksForFile(i).data):null}createRecentFilePathMap(){let i=this.unsafeApp.workspace.recentFileTracker.lastOpenFiles,e={};for(let t=0;t<i.length;t++)e[i[t]]=t;return e}createBacklinksMap(){let i={},e=rt(this.unsafeApp.metadataCache.unresolvedLinks,t=>Bt(t,s=>this.getPathToBeCreated(s)));for(let[t,s]of Object.entries((0,Jt.default)(this.unsafeApp.metadataCache.resolvedLinks,e)))for(let r of Object.keys(s))i[r]||(i[r]=new Set),i[r].add(t);return i}createLinksMap(i){var t,s,r;let e=this.unsafeApp.metadataCache.getFileCache(i);return rt(at([...(t=e==null?void 0:e.embeds)!=null?t:[],...(s=e==null?void 0:e.links)!=null?s:[],...(r=e==null?void 0:e.frontmatterLinks)!=null?r:[]],a=>{var o;return(o=this.linkText2Path(a.link))!=null?o:this.getPathToBeCreated(a.link)}),a=>a[0])}getLinksByFilePathInActiveFile(){var t,s,r;let i=this.getActiveFile();if(!i)return null;let e=this.unsafeApp.metadataCache.getFileCache(i);return at([...(t=e==null?void 0:e.embeds)!=null?t:[],...(s=e==null?void 0:e.links)!=null?s:[],...(r=e==null?void 0:e.frontmatterLinks)!=null?r:[]],a=>{var o;return(o=this.linkText2Path(a.link))!=null?o:this.getPathToBeCreated(a.link)})}async moveTo(i,e,t){var u;let s=typeof i=="number",r=this.getActiveFile(),a=this.unsafeApp.workspace.activeLeaf;if(!r||!a||!((u=this.getMarkdownViewInActiveLeaf())==null?void 0:u.currentMode))return;let l=e!=null?e:this.getCurrentEditor();if(!l)return;let c=s?l.offsetToPos(i).line:i.start.line;t&&this.addToJumpList(l,t,{line:c,ch:0}),l.setCursor(l.offsetToPos(s?i:i.start.offset)),await a.openFile(r,{eState:{line:c},active:!1})}getFileByPath(i){let e=this.unsafeApp.vault.getAbstractFileByPath(i);return e||null}getFilePathsInActiveWindow(){return this.unsafeApp.workspace.getLeavesOfType("markdown").filter(i=>{var e;return i.getContainer()===((e=this.unsafeApp.workspace.activeLeaf)==null?void 0:e.getContainer())}).map(i=>i.getViewState().state.file)}captureState(i){let e=this.unsafeApp.workspace.getLeaf(),t=this.unsafeApp.workspace.getLeaf(),s=t.getViewState(),r=t.getEphemeralState(),a=this.unsafeApp;return{leaf:t,async restore(){t&&(!i||i.getViewState().pinned?t.detach():(await t.setViewState({...s,active:t===e,popstate:!0},r),t!==e&&a.workspace.setActiveLeaf(e,{focus:!0})),this.leaf=void 0)}}}captureStateInFile(){let i=this.unsafeApp.workspace.getMostRecentLeaf(),e=i.getViewState(),t=i.getEphemeralState(),s=this.unsafeApp;return{async restore(){await i.setViewState({...e,active:!0,popstate:!0},t),s.workspace.setActiveLeaf(i,{focus:!0}),this.leaf=void 0}}}createLeafHistorySnapshot(i){let e=this.getLeafHistory(i);return!e||!i?null:{backHistory:e.backHistory.map(t=>({...t,state:t.state?{...t.state,state:t.state.state?{...t.state.state}:void 0}:void 0,eState:t.eState?{...t.eState}:void 0})),forwardHistory:e.forwardHistory.map(t=>({...t,state:t.state?{...t.state,state:t.state.state?{...t.state.state}:void 0}:void 0,eState:t.eState?{...t.eState}:void 0})),currentEntry:this.createHistoryEntryFromLeaf(i)}}restoreLeafHistorySnapshot(i,e){let t=this.getLeafHistory(i);if(!t||!e)return;let s=e.backHistory.slice();if(e.currentEntry){let r=s.at(-1),a=this.getHistoryEntryKey(r),o=this.getHistoryEntryKey(e.currentEntry);(!a||a!==o)&&s.push(e.currentEntry)}t.backHistory=s,t.forwardHistory=e.forwardHistory.slice()}createHistoryEntryFromLeaf(i){var a,o;let e=i.getViewState();if(!e)return null;let t=i.view,s=(a=e.title)!=null?a:typeof(t==null?void 0:t.getDisplayText)=="function"?t.getDisplayText():void 0,r=(o=e.icon)!=null?o:typeof(t==null?void 0:t.getIcon)=="function"?t.getIcon():void 0;return{title:s,icon:r,state:e,eState:i.getEphemeralState()}}getLeafHistory(i){let e=i==null?void 0:i.history;return!e||!Array.isArray(e.backHistory)?null:(Array.isArray(e.forwardHistory)||(e.forwardHistory=[]),e)}getHistoryEntryKey(i){var a,o,l;if(!(i!=null&&i.state))return null;let e=i.state,t=(a=e==null?void 0:e.state)==null?void 0:a.file;if(t)return`file:${t}`;let s=(o=e==null?void 0:e.type)!=null?o:"unknown",r=(l=i.title)!=null?l:"";return`type:${s}|title:${r}`}getOpenState(i,e){let t=this.unsafeApp.viewRegistry.getTypeByExtension(e.extension);return i.view instanceof T.FileView&&i.view.canAcceptExtension(e.extension)&&(t=i.view.getViewType()),{type:t,state:{file:e.path}}}findLeaf(i){return this.unsafeApp.workspace.getLeavesOfType("markdown").find(e=>e.getViewState().state.file===i.path)}async openFile(i,e={},t){var o,l,c;let s={leafType:"same-tab",inplace:!1,...e},r=e!=null&&e.preventDuplicateTabs?this.findLeaf(i):void 0,a;switch(s.leafType){case"same-tab":a=(l=(o=e.leafPriorToSameTab)!=null?o:t==null?void 0:t.leaf)!=null?l:this.unsafeApp.workspace.getLeaf();break;case"new-tab":a=r!=null?r:this.unsafeApp.workspace.getLeaf(!0);break;case"new-pane-horizontal":a=this.unsafeApp.workspace.getLeaf("split","horizontal");break;case"new-pane-vertical":a=this.unsafeApp.workspace.getLeaf("split","vertical");break;case"new-window":a=this.unsafeApp.workspace.openPopoutLeaf();break;case"popup":{let u=this.unsafeApp.plugins.plugins["obsidian-hover-editor"];a=(c=u==null?void 0:u.spawnPopover())!=null?c:this.unsafeApp.workspace.getLeaf(!0);break}default:throw new U(s.leafType)}if(s.inplace&&s.leafType==="same-tab"?await a.setViewState({...a.getViewState(),active:!1,popstate:!0,...this.getOpenState(a,i)}):await a.openFile(i,{...a.getViewState(),active:!0}),a.view instanceof T.MarkdownView){let u=a.view;if(s.offset!=null)this.moveTo(s.offset,u.editor);else if(s.line!=null){let g={line:s.line,offset:0,col:0};this.moveTo({start:g,end:g},u.editor)}}}captureLastOpenFilesSnapshot(){return this.unsafeApp.workspace.recentFileTracker.lastOpenFiles.slice()}restoreLastOpenFilesSnapshot(i){if(!i)return;let e=this.unsafeApp.workspace.recentFileTracker.lastOpenFiles;e.length=0,e.push(...i)}openFileInDefaultApp(i){this.unsafeApp.openWithDefaultApp(i.path)}openFolderInDefaultApp(i){this.unsafeApp.openWithDefaultApp(i.path)}openInSystemExplorer(i){this.unsafeApp.showInFolder(i.path)}closeFile(i){let e=this.unsafeApp.workspace.getLeavesOfType("markdown").filter(t=>{var s;return((s=t.getViewState().state)==null?void 0:s.file)===i.path});for(let t of e)t.detach()}getStarredFilePaths(){return this.unsafeApp.internalPlugins.plugins.bookmarks.instance.getBookmarks().map(i=>i.type==="file"?i.path:void 0).filter(i=>i!==void 0)}searchPhantomFiles(){return $(lt(Object.values(this.unsafeApp.metadataCache.unresolvedLinks).map(Object.keys))).map(i=>this.createPhantomFile(i))}insertStringToActiveFile(i){let e=this.unsafeApp.workspace.getActiveViewOfType(T.MarkdownView);if(!e)return;e.editor.replaceSelection(i)}insertLinkToActiveFileBy(i,e){var l;let t=this.unsafeApp.workspace.getActiveViewOfType(T.MarkdownView);if(!(t!=null&&t.file))return;let s=this.unsafeApp.fileManager.generateMarkdownLink(i,t.file.path),r=e==null?void 0:e.displayedString,a=e==null?void 0:e.aliasTranformer;if(this.unsafeApp.vault.config.useMarkdownLinks){let{text:c,link:u}=Array.from(s.matchAll(/\[(?<text>[^\]]+)]\((?<link>.+)\)/g))[0].groups,g=r!=null?r:c;a&&(g=it(g,a.pattern,a.format)),s=`[${g}](${u})`}else{let c=(l=Array.from(s.matchAll(/\[\[(?<text>[^\]]+)]]/g))[0].groups)==null?void 0:l.text,u=r!=null?r:c;a&&(u=it(u,a.pattern,a.format)),s=c===u?`[[${c}]]`:`[[${c}|${u}]]`,e!=null&&e.phantom&&(s=`[[${s.replace("[[","").replace("]]","").split("|").map(m=>m.replace(/.*\/([^\]]+)/,"$1")).unique().join("|")}]]`)}t.editor.replaceSelection(s.endsWith(".excalidraw]]")?`!${s}`:s.endsWith(".pdf]]")?s.replace("!",""):s)}async createMarkdown(i){let e=this.getPathToBeCreated(i);if(await this.exists(e))return null;let t=we(e);return await this.exists(t)||await this.unsafeApp.vault.createFolder(t),this.unsafeApp.vault.create(e,"")}exists(i){return this.unsafeApp.vault.adapter.exists(i)}isPopWindow(){return!fish(".modal-bg")}removeCommand(i){this.unsafeApp.commands.removeCommand(i)}getCommandIds(i){return Object.keys(this.unsafeApp.commands.commands).filter(e=>e.startsWith(i))}getNormalizeVaultRootPath(){return j(this.unsafeApp.vault.adapter.basePath)}getPathToBeCreated(i){var t,s,r;let e=(0,T.getLinkpath)(i);if(Ut(e)!==".md"&&(e+=".md"),e.includes("/"))return e;switch(this.unsafeApp.vault.config.newFileLocation){case"root":return`/${e}`;case"current":return`${(r=(s=(t=this.getActiveFile())==null?void 0:t.parent)==null?void 0:s.path)!=null?r:""}/${e}`;case"folder":return`${this.unsafeApp.vault.config.newFileFolderPath}/${e}`;default:return`/${e}`}}linkText2Path(i){var t,s;let e=this.getActiveFile();return e&&(s=(t=this.unsafeApp.metadataCache.getFirstLinkpathDest(i,e.path))==null?void 0:t.path)!=null?s:null}isPhantomFile(i){return i.stat.ctime===0}isActiveLeafCanvas(){var i;return((i=this.getViewInActiveLeaf())==null?void 0:i.getViewType())==="canvas"}isCacheInitialized(){return this.unsafeApp.metadataCache.initialized}addFileToCanvas(i,e={x:0,y:0}){let t=this.getCanvasViewInActiveLeaf(),{x:s,y:r}=t.canvas.posCenter();return t.canvas.createFileNode({file:i,pos:{x:s+e.x,y:r+e.y}})}enableFileExplorer(){return this.unsafeApp.internalPlugins.getEnabledPluginById("file-explorer")}revealInFolder(i){this.unsafeApp.internalPlugins.plugins["file-explorer"].instance.revealInFolder(i)}createPhantomFile(i){let e=this.getPathToBeCreated(i);return{path:e,name:ye(e),vault:this.unsafeApp.vault,extension:"md",basename:ye(e,".md"),parent:{name:ye(we(e)),path:we(e),vault:this.unsafeApp.vault,children:[],parent:null,isRoot:()=>!0},stat:{mtime:0,ctime:0,size:0}}}addToJumpList(i,e,t){var a,o,l,c,u;let s=(a=i.cm)==null?void 0:a.cm,r=(u=(c=(l=(o=s==null?void 0:s.constructor)==null?void 0:o.Vim)==null?void 0:l.getVimGlobalState_)==null?void 0:c.call(l))==null?void 0:u.jumpList;r&&r.add(s,e,t)}};var R=require("obsidian");function Xt(){return Object.values(app.commands.commands).filter(n=>!n.checkCallback||n.checkCallback(!0))}function Zt(n,i){return n!=null?i(n):null}function es(n){return app.vault.adapter.exists(n)}async function ti(n){return await es(n)?app.vault.adapter.read(n):null}async function ts(n){return Zt(await ti(n),i=>JSON.parse(i))}async function si(n,i,e){if(!(e!=null&&e.overwrite)&&await es(n))throw new Error(`Cannot overwrite because the file already exists: ${n}`);app.vault.adapter.write(n,i)}async function ss(n,i,e){await si(n,JSON.stringify(i),e)}var A=require("obsidian");var ke=require("obsidian");var is=ke.Platform.isMacOS?"Cmd":"Ctrl",ns=ke.Platform.isMacOS?"Option":"Alt",G=n=>n?ns:is;function Fe(n){if(!n)return"";let i=n.modifiers.join(" ");return i?`${i} ${n.key}`:n.key}function rs(n,i){let e=n.split(" ");return e.length===1?e[0]===""?null:{modifiers:[],key:e[0],hideHotkeyGuide:i}:{modifiers:e.slice(0,-1),key:e.at(-1),hideHotkeyGuide:i}}function x(n){return Object.keys(n).filter(i=>n[i].length>0).map(i=>yt(i,n[i][0])).filter(i=>i!==null)}function yt(n,i){if(!i||i.hideHotkeyGuide)return null;let e=i.modifiers.map(r=>r==="Mod"?is:r==="Alt"?ns:r).join(" "),t=i.key==="Enter"?"\u21B5":i.key==="ArrowUp"?"\u2191":i.key==="ArrowDown"?"\u2193":i.key==="Escape"?"ESC":i.key;return{command:e?`[${e} ${t}]`:`[${t}]`,purpose:n}}function wt(n,i){let e={modifiers:[],key:ii(i.key)};return i.shiftKey&&e.modifiers.push("Shift"),i.altKey&&e.modifiers.push("Alt"),i.ctrlKey&&e.modifiers.push(ke.Platform.isMacOS?"Ctrl":"Mod"),i.metaKey&&e.modifiers.push(ke.Platform.isMacOS?"Mod":"Meta"),n.key.toLowerCase()===e.key.toLowerCase()&&Kt(n.modifiers,e.modifiers)}function ii(n){return n===" "?"Space":n}function q(n){return n==="Space"?" ":n}function ni(n,i,e){var v;let{searchByTags:t,searchByHeaders:s,searchByLinks:r,keysOfPropertyToSearch:a,isNormalizeAccentsDiacritics:o}=e;if(t&&i.startsWith("#")){let y=n.tags.filter(w=>E(w.slice(1),i.slice(1),o));return[{type:y.length>0?"tag":"not found",meta:y,query:i}]}let l=i.split("/"),c=l.pop();if(!l.every(y=>n.file.parent?E(n.file.parent.path,y,o):!1))return[{type:"not found",query:i}];if(c.length===0)return[{type:"directory",meta:[n.file.path],query:i}];let m=[];n.tokens.some(y=>Gt(y,c,o))&&m.push({type:"word-perfect",meta:[n.file.name],query:i});let p=de(n.file.extension==="md"?n.file.basename:n.file.name,i,o);switch(p.type){case"starts-with":m.push({type:"prefix-name",meta:[n.file.name],query:i,ranges:p.ranges});case"includes":m.push({type:"name",meta:[n.file.name],query:i,ranges:p.ranges});case"fuzzy":e.fuzzyTarget&&p.score>e.minFuzzyScore&&m.push({type:"fuzzy-name",meta:[n.file.name],query:i,score:p.score,ranges:p.ranges})}let h=[],d=[],f=[];for(let y of n.aliases){let w=de(y,c,o);switch(w.type){case"starts-with":h.push({value:y,ranges:w.ranges});case"includes":d.push({value:y,ranges:w.ranges});case"fuzzy":e.fuzzyTarget&&w.score>e.minFuzzyScore&&f.push({value:y,score:w.score,ranges:w.ranges})}}if(h.length>0){let y=pe(h,w=>w.value.length);m.push({type:"prefix-name",meta:h.map(w=>w.value),alias:y.value,query:i,ranges:void 0,allAliasRanges:h.map(w=>({alias:w.value,ranges:w.ranges||[]}))})}if(d.length>0){let y=pe(d,w=>w.value.length);m.push({type:"name",meta:d.map(w=>w.value),alias:y.value,query:i,ranges:void 0,allAliasRanges:d.map(w=>({alias:w.value,ranges:w.ranges||[]}))})}if(e.fuzzyTarget&&f.length>0){let y=pe(f,w=>w.score);m.push({type:"fuzzy-name",meta:f.map(w=>w.value),alias:y.value,score:y.score,query:i,ranges:void 0,allAliasRanges:f.map(w=>({alias:w.value,ranges:w.ranges||[]}))})}if(n.file.parent&&E(n.file.parent.path,i,o)&&m.push({type:"directory",meta:[n.file.path],query:i}),s){let y=n.headers.filter(w=>E(w,i,o));y.length>0&&m.push({type:"header",meta:y,query:i})}if(r){let y=n.links.filter(w=>E(w,i,o));y.length>0&&m.push({type:"link",meta:y,query:i})}if(t){let y=n.tags.filter(w=>E(w.slice(1),i,o));y.length>0&&m.push({type:"tag",meta:y,query:i})}if(a.length>0){let y={};for(let k of a){let S=(v=n.frontMatter)==null?void 0:v[k];if(S)if(Array.isArray(S)){let M=S.map(F=>F==null?null:dt(F.toString(),i,o));M.length>0&&M.some(F=>F!==null)&&(y[k]=M)}else{let M=dt(S.toString(),i,o);M&&(y[k]=[M])}}let w=Object.keys(y);w.length>0&&m.push({type:"property",meta:w,frontMatterRanges:y,query:i})}return m.length===0?[{type:"not found",query:i}]:m}function ri(n,i,e){return i.flatMap(t=>{var o;let[s,r]=e.excludePrefix&&t.startsWith(e.excludePrefix)?[t.slice(e.excludePrefix.length),!0]:[t,!1],a=ni(n,s,e);return((o=a[0])==null?void 0:o.type)==="not found"?r?[]:a:r?[{type:"not found",query:s}]:a})}function as(n,i,e){return{...n,matchResults:ri(n,i,e)}}function Ie(n){let i=n.matchResults.find(t=>["word-perfect","prefix-name","name","fuzzy-name"].includes(t.type)&&!t.alias),e=xe(n.matchResults.filter(t=>t.alias),t=>{var s;return(s=t.meta)!=null?s:[]});return{title:i?n.file.basename:void 0,aliases:e}}var b=require("obsidian");var be={onChange(n,i,e){return n.inputEl.addEventListener("change",async t=>{t.target instanceof HTMLInputElement&&i(t.target.value)}),e!=null&&e.className&&(n.inputEl.className=e.className),e!=null&&e.style&&n.inputEl.setAttribute("style",e.style),n}},ue={onChange(n,i,e){return n.inputEl.addEventListener("change",async t=>{t.target instanceof HTMLTextAreaElement&&i(t.target.value)}),e!=null&&e.className&&(n.inputEl.className=e.className),n}};var vt=n=>{let i=[],e="",t=a=>{e=a;let o=a.trim().toLowerCase(),l=o.length===0;for(let c of i){let u=c.getSearchText().toLowerCase(),g=l||u.includes(o);c.settingEl.toggle(g)}},s=(a,o)=>{i.push({settingEl:a,getSearchText:o}),t(e)},r=(a,o,l)=>{let c=a.trim();n.addSetting(u=>{u.setName(a),o&&u.setDesc(o),l(u),s(u.settingEl,()=>c)})};return n.addSearch(a=>{a.setPlaceholder("Filter settings").onChange(o=>{t(o)})}),{addFilterableSetting:r}};var os="another-quick-switcher__settings__nested",kt="another-quick-switcher__settings__search-command",bt="another-quick-switcher__settings__dialog-hotkey",ai=n=>{var i;return n.type==="checkbox"||n.type==="range"||n.type==="button"||n.type==="submit"||n.type==="color"?"":(i=n.value)!=null?i:""},oi=n=>{var s,r,a,o;let i=(r=(s=n.querySelector(".setting-item-name"))==null?void 0:s.textContent)!=null?r:"",e=(o=(a=n.querySelector(".setting-item-description"))==null?void 0:a.textContent)!=null?o:"",t=Array.from(n.querySelectorAll("input, textarea, select")).map(l=>{var c,u;return l instanceof HTMLInputElement?ai(l):l instanceof HTMLTextAreaElement?(c=l.value)!=null?c:"":l instanceof HTMLSelectElement&&(u=l.value)!=null?u:""}).map(l=>l.trim()).filter(l=>l.length>0);return[i,e,...t].join(" ").trim()},ls=(n,i,e)=>{for(let t=i-1;t>=0;t-=1){let s=n[t];if(e(s))return s}return null},St=(n,i)=>{var p;let e=V(i).map(h=>h.toLowerCase()),t=e.length>0,s=Array.from(n.querySelectorAll(".setting-item")),r=Array.from(n.querySelectorAll("h3")),a=Array.from(n.querySelectorAll("h3, .setting-item"));if(!t){for(let h of s)h.toggle(!0);for(let h of r)h.toggle(!0);n.querySelectorAll(`.${kt}, .${bt}`).forEach(h=>{h.toggle(!0)});return}let o=new Set;for(let h of s){let d=oi(h).toLowerCase();e.every(f=>d.includes(f))&&o.add(h)}let l=new Set;for(let h of r){let d=((p=h.textContent)!=null?p:"").toLowerCase();e.every(f=>d.includes(f))&&l.add(h)}let c=new Set(o);for(let h of l){let d=a.indexOf(h);if(d!==-1)for(let f=d+1;f<a.length;f+=1){let v=a[f];if(v.tagName==="H3")break;v.classList.contains("setting-item")&&c.add(v)}}let u=Array.from(o).filter(h=>h.classList.contains("setting-item-heading"));for(let h of u){let d=h.closest(`.${kt}`),f=h.closest(`.${bt}`),v=d!=null?d:f;v&&v.querySelectorAll(".setting-item").forEach(y=>{c.add(y)})}for(let h of o){let d=a.indexOf(h);if(d===-1)continue;let f=ls(a,d,v=>v.tagName==="H3"||v.classList.contains("setting-item-heading"));if(f&&f.tagName!=="H3"&&c.add(f),h.classList.contains(os)){let v=ls(a,d,y=>y.classList.contains("setting-item")&&!y.classList.contains(os));v&&c.add(v)}}let g=new Set(l),m=null;for(let h of a){if(h.tagName==="H3"){m=h;continue}m&&c.has(h)&&g.add(m)}for(let h of s)h.toggle(c.has(h));for(let h of r)h.toggle(g.has(h));n.querySelectorAll(`.${kt}`).forEach(h=>{let d=Array.from(h.querySelectorAll(".setting-item")).some(f=>c.has(f));h.toggle(d)}),n.querySelectorAll(`.${bt}`).forEach(h=>{let d=Array.from(h.querySelectorAll(".setting-item")).some(f=>c.has(f));h.toggle(d)})};var Et=(n,i={})=>{let{wrapperClass:e="another-quick-switcher__settings__popup",contentClass:t="another-quick-switcher__settings__popup__content",openClass:s="is-open",spacing:r=6,closeDelayMs:a=80}=i;return{createPopover:(l,c)=>{let u=document.createDocumentFragment(),g=createDiv({cls:e}),m=createDiv({cls:t});m.append(c),document.body.append(m),g.append(l);let p=!1,h=!1,d=!1,f=!1,v=null,y=L=>{let fe=L.target;fe instanceof Node&&!g.contains(fe)&&!m.contains(fe)&&(h=!1,F(),document.removeEventListener("pointerdown",y,!0))},w=()=>{let L=l.getBoundingClientRect(),fe=L.bottom+r+window.scrollY,et=L.left+window.scrollX,qs=document.documentElement.clientWidth,zs=window.scrollX+8,Tt=window.scrollX+qs-m.offsetWidth-8;Number.isFinite(Tt)&&(et=Math.min(Math.max(et,zs),Tt)),m.style.top=`${fe}px`,m.style.left=`${et}px`},k=()=>{p&&w()},S=()=>{p||(p=!0,m.style.display="block",m.style.visibility="hidden",w(),m.style.visibility="visible",window.addEventListener("resize",k),window.addEventListener("scroll",k,!0))},M=()=>{p&&(p=!1,m.style.display="none",m.style.visibility="",window.removeEventListener("resize",k),window.removeEventListener("scroll",k,!0))},F=()=>{let L=h||d||f;L?(v!=null&&(window.clearTimeout(v),v=null),g.addClass(s),S()):(g.removeClass(s),M()),l.setAttribute("aria-expanded",String(L))};l.setAttribute("aria-expanded","false"),l.setAttribute("aria-haspopup","dialog");let W=()=>g.matches(":hover")||m.matches(":hover"),N=()=>{v!=null&&window.clearTimeout(v),v=window.setTimeout(()=>{d=W(),F()},a)},Z=()=>{d=!0,F()},P=()=>{N()};return g.addEventListener("mouseenter",Z),g.addEventListener("mouseleave",P),m.addEventListener("mouseenter",Z),m.addEventListener("mouseleave",P),l.addEventListener("focus",()=>{f=!0,F()}),l.addEventListener("blur",()=>{f=!1,N()}),l.addEventListener("click",L=>{L.preventDefault(),h=!h,F(),h?document.addEventListener("pointerdown",y,!0):document.removeEventListener("pointerdown",y,!0)}),n(()=>{document.removeEventListener("pointerdown",y,!0),window.removeEventListener("resize",k),window.removeEventListener("scroll",k,!0),v!=null&&window.clearTimeout(v),m.remove()}),u.append(g),u}}};var li=["Header match","Last modified","Last opened","Created earliest","Created latest","Length","Link match","Name match","Perfect word match","Prefix name match","Fuzzy name match","Star","Tag match","Property match","Alphabetical","Alphabetical reverse"],ci=/^@([^:]+)(?::(asc|desc))?$/;function us(n){let i=n.match(ci);if(!i)return null;let[,e,t]=i;return{key:e,order:t!=null?t:"asc"}}function He(n){return us(n)!==null}function hs(n){return li.includes(n)||n.split(",").every(i=>i.startsWith("#"))||n.split(",").every(i=>i.startsWith("."))||He(n)}function ps(n){return n.filter(i=>["Last opened","Last modified","Created earliest","Created latest","Star","Alphabetical","Alphabetical reverse"].includes(i)||i.startsWith("#")||i.startsWith(".")||He(i))}function ui(n){switch(n){case"Header match":return yi;case"Last modified":return bi;case"Last opened":return ki;case"Created latest":return Si;case"Created earliest":return Ei;case"Length":return vi;case"Link match":return wi;case"Name match":return di;case"Perfect word match":return hi;case"Prefix name match":return pi;case"Fuzzy name match":return gi;case"Star":return Ci;case"Tag match":return mi;case"Property match":return fi;case"Alphabetical":return xi;case"Alphabetical reverse":return _i;default:{let i=us(n);if(i)return(e,t)=>Ai(e,t,i.key,i.order);if(n.startsWith("#")){let e=n.split(",");return(t,s)=>Pi(t,s,e)}if(n.startsWith(".")){let e=n.split(",").map(t=>t.slice(1));return(t,s)=>Fi(t,s,e)}throw new U(n)}}}function ds(n,i,e){let t=i.map(ui);return n.sort((s,r)=>{let a;for(let o of t)if(a=o(s,r,e),a!==0)return a;return 0})}function _(n,i,e,t="asc"){let s=e(n),r=e(i);if(s===r)return 0;switch(t){case"asc":return s>r?1:r>s?-1:0;case"desc":return s<r?1:r<s?-1:0}}function hi(n,i){return _(n,i,e=>e.matchResults.filter(t=>t.type==="word-perfect").map(t=>t.query).unique().length,"desc")}function pi(n,i){return _(n,i,e=>e.matchResults.filter(t=>t.type==="prefix-name").map(t=>t.query).unique().length,"desc")}function di(n,i){return _(n,i,e=>e.matchResults.filter(t=>t.type==="name").map(t=>t.query).unique().length,"desc")}function gi(n,i){return _(n,i,e=>Math.max(...e.matchResults.map(t=>{var s;return(s=t.score)!=null?s:0})),"desc")}function mi(n,i){return _(n,i,e=>e.matchResults.filter(t=>t.type==="tag").map(t=>t.query).unique().length,"desc")}function fi(n,i){return _(n,i,e=>e.matchResults.filter(t=>t.type==="property").map(t=>t.query).unique().length,"desc")}function yi(n,i){return _(n,i,e=>e.matchResults.filter(t=>t.type==="header").map(t=>t.query).unique().length,"desc")}function wi(n,i){return _(n,i,e=>e.matchResults.filter(t=>t.type==="link").map(t=>t.query).unique().length,"desc")}function vi(n,i){return _(n,i,e=>e.matchResults[0].alias?e.matchResults[0].alias.length:e.file.basename.length,"asc")}function ki(n,i,e){return _(n,i,t=>{var s;return(s=e[t.file.path])!=null?s:999999},"asc")}function bi(n,i){return _(n,i,e=>e.file.stat.mtime,"desc")}function Si(n,i){return _(n,i,e=>e.file.stat.ctime,"desc")}function Ei(n,i){return _(n,i,e=>e.file.stat.ctime||Number.MAX_SAFE_INTEGER,"asc")}function Ci(n,i){return _(n,i,e=>Number(e.starred),"desc")}var Ae=n=>{var i,e;return le((e=(i=n.matchResults[0])==null?void 0:i.alias)!=null?e:n.file.basename).toLowerCase()};function xi(n,i){return Ae(n).localeCompare(Ae(i))}function _i(n,i){return Ae(i).localeCompare(Ae(n))}function Pi(n,i,e){return _(n,i,t=>qt([e,t.tags]).length,"desc")}function Fi(n,i,e){return _(n,i,t=>Number(e.contains(t.file.extension)),"desc")}function cs(n){if(n==null)return null;let i=Array.isArray(n)?n[0]:n;return i==null?null:typeof i=="number"?i:typeof i=="boolean"?i?1:0:i}function Ii(n,i,e){if(typeof n=="number"&&typeof i=="number")return n===i?0:e==="asc"?n>i?1:-1:n<i?1:-1;let t=String(n).localeCompare(String(i));return t===0?0:e==="asc"?t>0?1:-1:t>0?-1:1}function Ai(n,i,e,t){var a,o;let s=cs((a=n.frontMatter)==null?void 0:a[e]),r=cs((o=i.frontMatter)==null?void 0:o[e]);return s===null&&r===null?0:s===null?1:r===null?-1:Ii(s,r,t)}var Hi=["file","opened file","backlink","link","2-hop-link"],Ti=["Recently used","Alphabetical","Alphabetical reverse"];var Ct=()=>({main:{up:[{modifiers:["Mod"],key:"p"}],down:[{modifiers:["Mod"],key:"n"}],"clear input":[{modifiers:["Mod"],key:"d"}],"replace input":[{modifiers:[],key:"Tab"}],open:[{modifiers:[],key:"Enter"}],"open in new tab":[{modifiers:["Mod"],key:"Enter"}],"open in new pane (horizontal)":[{modifiers:["Mod"],key:"-"}],"open in new pane (vertical)":[{modifiers:["Mod"],key:"i"}],"open in new window":[{modifiers:["Mod"],key:"o"}],"open in popup":[],"check/uncheck":[],"check/uncheck and next":[],"check/uncheck all":[],"uncheck all":[],preview:[{modifiers:["Mod"],key:","}],"toggle auto preview":[],"scroll preview up":[],"scroll preview down":[],create:[{modifiers:["Shift"],key:"Enter"}],"create in new tab":[{modifiers:["Mod","Shift"],key:"Enter"}],"create in new pane (horizontal)":[],"create in new pane (vertical)":[],"create in new window":[{modifiers:["Mod","Shift"],key:"o"}],"create in new popup":[],"open in default app":[],"show in system explorer":[],"open in google":[{modifiers:["Mod"],key:"g"}],"open first URL":[{modifiers:["Mod"],key:"]"}],"insert to editor":[{modifiers:["Alt"],key:"Enter"}],"show backlinks":[{modifiers:["Mod"],key:"h"}],"show links":[{modifiers:["Mod"],key:"l"}],"show all results":[{modifiers:["Shift","Alt"],key:"a"}],"navigate forward":[{modifiers:["Alt"],key:"ArrowRight"}],"navigate back":[{modifiers:["Alt"],key:"ArrowLeft"}],"previous search history":[],"next search history":[],"close if opened":[],"copy file vault path":[],"copy absolute file path":[],"launch grep":[],dismiss:[{modifiers:[],key:"Escape"}]},folder:{up:[{modifiers:["Mod"],key:"p"}],down:[{modifiers:["Mod"],key:"n"}],"open in default app":[],dismiss:[{modifiers:[],key:"Escape"}]},move:{up:[{modifiers:["Mod"],key:"p"}],down:[{modifiers:["Mod"],key:"n"}],"open in default app":[],dismiss:[{modifiers:[],key:"Escape"}]},command:{up:[{modifiers:["Mod"],key:"p"}],down:[{modifiers:["Mod"],key:"n"}],"copy command id":[],dismiss:[{modifiers:[],key:"Escape"}]},header:{up:[{modifiers:["Mod"],key:"p"}],down:[{modifiers:["Mod"],key:"n"}],"clear input":[{modifiers:["Mod"],key:"d"}],"move to next hit":[{modifiers:[],key:"Tab"}],"move to previous hit":[{modifiers:["Shift"],key:"Tab"}],"toggle auto preview":[{modifiers:["Mod"],key:","}],"scroll preview up":[],"scroll preview down":[],"insert all to editor":[{modifiers:["Alt","Shift"],key:"Enter"}],dismiss:[{modifiers:[],key:"Escape"}]},backlink:{up:[{modifiers:["Mod"],key:"p"}],down:[{modifiers:["Mod"],key:"n"}],open:[{modifiers:[],key:"Enter"}],"open in new tab":[{modifiers:["Mod"],key:"Enter"}],"open in new pane (horizontal)":[{modifiers:["Mod"],key:"-"}],"open in new pane (vertical)":[{modifiers:["Mod"],key:"i"}],"open in new window":[{modifiers:["Mod"],key:"o"}],"open in popup":[],"check/uncheck":[],"check/uncheck and next":[],"check/uncheck all":[],"uncheck all":[],"show all results":[{modifiers:["Shift","Alt"],key:"a"}],preview:[{modifiers:["Mod"],key:","}],"scroll preview up":[],"scroll preview down":[],dismiss:[{modifiers:[],key:"Escape"}]},link:{up:[{modifiers:["Mod"],key:"p"}],down:[{modifiers:["Mod"],key:"n"}],open:[{modifiers:[],key:"Enter"}],"open in new tab":[{modifiers:["Mod"],key:"Enter"}],"open in new pane (horizontal)":[{modifiers:["Mod"],key:"-"}],"open in new pane (vertical)":[{modifiers:["Mod"],key:"i"}],"open in new window":[{modifiers:["Mod"],key:"o"}],"open in popup":[],"show all results":[{modifiers:["Shift","Alt"],key:"a"}],preview:[{modifiers:["Mod"],key:","}],"toggle auto preview":[],"scroll preview up":[],"scroll preview down":[],dismiss:[{modifiers:[],key:"Escape"}]},"in-file":{up:[{modifiers:["Mod"],key:"p"}],down:[{modifiers:["Mod"],key:"n"}],"insert to editor":[],"show all results":[{modifiers:["Shift","Alt"],key:"a"}],"toggle auto preview":[{modifiers:["Mod"],key:","}],"scroll preview up":[],"scroll preview down":[],dismiss:[{modifiers:[],key:"Escape"}]},grep:{search:[{modifiers:[],key:"Tab"}],up:[{modifiers:["Mod"],key:"p"}],down:[{modifiers:["Mod"],key:"n"}],"clear input":[{modifiers:["Mod"],key:"d"}],"clear path":[{modifiers:["Alt"],key:"d"}],"set ./ to path":[{modifiers:["Alt"],key:"c"}],"toggle input":[],"previous search history":[],"next search history":[],open:[{modifiers:[],key:"Enter"}],"open in new tab":[{modifiers:["Mod"],key:"Enter"}],"open in new pane (horizontal)":[{modifiers:["Mod"],key:"-"}],"open in new pane (vertical)":[{modifiers:["Mod"],key:"i"}],"open in new window":[{modifiers:["Mod"],key:"o"}],"open in popup":[],"check/uncheck":[],"check/uncheck and next":[],"check/uncheck all":[],"uncheck all":[],preview:[{modifiers:["Mod"],key:","}],"scroll preview up":[],"scroll preview down":[],dismiss:[{modifiers:[],key:"Escape"}]}}),X=()=>["aliases","alias","tag","tags","cssclass","publish"],xt=()=>({name:"",searchBy:{tag:!1,link:!1,header:!1,property:!1},keysOfPropertyToSearch:[],relativeUpdatedPeriodSource:"none",relativeUpdatedPeriodPropertyKey:"Last modified",searchTarget:"file",allowFuzzySearchForSearchTarget:!1,minFuzzyMatchScore:.5,targetExtensions:[],includeCurrentFile:!1,floating:!1,autoPreview:!1,autoPreviewDelayMilliSeconds:300,showFrontMatter:!1,excludeFrontMatterKeys:X(),defaultInput:"",restoreLastInput:!1,commandPrefix:"",sortPriorities:[],includePrefixPathPatterns:[],excludePrefixPathPatterns:[],expand:!0}),gs=()=>({name:"Link search",searchBy:{tag:!1,link:!1,header:!1,property:!1},keysOfPropertyToSearch:[],relativeUpdatedPeriodSource:"none",relativeUpdatedPeriodPropertyKey:"Last modified",searchTarget:"link",allowFuzzySearchForSearchTarget:!1,minFuzzyMatchScore:.5,targetExtensions:[],includeCurrentFile:!1,floating:!1,autoPreview:!1,autoPreviewDelayMilliSeconds:300,showFrontMatter:!1,excludeFrontMatterKeys:X(),defaultInput:"",restoreLastInput:!1,commandPrefix:"",sortPriorities:[],includePrefixPathPatterns:[],excludePrefixPathPatterns:[],expand:!1}),ms=()=>({name:"Backlink search",searchBy:{tag:!1,link:!1,header:!1,property:!1},keysOfPropertyToSearch:[],relativeUpdatedPeriodSource:"none",relativeUpdatedPeriodPropertyKey:"Last modified",searchTarget:"backlink",allowFuzzySearchForSearchTarget:!1,minFuzzyMatchScore:.5,targetExtensions:["md"],includeCurrentFile:!1,floating:!1,autoPreview:!1,autoPreviewDelayMilliSeconds:300,showFrontMatter:!1,excludeFrontMatterKeys:X(),defaultInput:"",restoreLastInput:!1,commandPrefix:"",sortPriorities:["Last opened","Last modified"],includePrefixPathPatterns:[],excludePrefixPathPatterns:[],expand:!1}),Mi=()=>({name:"2 hop link search",searchBy:{tag:!0,link:!1,header:!1,property:!1},keysOfPropertyToSearch:[],relativeUpdatedPeriodSource:"none",relativeUpdatedPeriodPropertyKey:"Last modified",searchTarget:"2-hop-link",allowFuzzySearchForSearchTarget:!1,minFuzzyMatchScore:.5,targetExtensions:[],includeCurrentFile:!1,floating:!1,autoPreview:!1,autoPreviewDelayMilliSeconds:300,showFrontMatter:!1,excludeFrontMatterKeys:X(),defaultInput:"",restoreLastInput:!1,commandPrefix:"",sortPriorities:["Prefix name match","Alphabetical",".md","Last opened","Last modified"],includePrefixPathPatterns:[],excludePrefixPathPatterns:[],expand:!1}),fs=()=>[{name:"Recent search",searchBy:{tag:!0,header:!1,link:!1,property:!1},keysOfPropertyToSearch:[],relativeUpdatedPeriodSource:"none",relativeUpdatedPeriodPropertyKey:"Last modified",searchTarget:"file",allowFuzzySearchForSearchTarget:!1,minFuzzyMatchScore:.5,targetExtensions:[],includeCurrentFile:!1,floating:!1,autoPreview:!1,autoPreviewDelayMilliSeconds:300,showFrontMatter:!1,excludeFrontMatterKeys:X(),defaultInput:"",restoreLastInput:!1,commandPrefix:":e ",sortPriorities:["Name match",".md","Last opened","Last modified"],includePrefixPathPatterns:[],excludePrefixPathPatterns:[],expand:!0},{name:"File name search",searchBy:{tag:!1,link:!1,header:!1,property:!1},keysOfPropertyToSearch:[],relativeUpdatedPeriodSource:"none",relativeUpdatedPeriodPropertyKey:"Last modified",searchTarget:"file",allowFuzzySearchForSearchTarget:!1,minFuzzyMatchScore:.5,targetExtensions:[],includeCurrentFile:!1,floating:!1,autoPreview:!1,autoPreviewDelayMilliSeconds:300,showFrontMatter:!1,excludeFrontMatterKeys:X(),defaultInput:"",restoreLastInput:!1,commandPrefix:":f ",sortPriorities:["Prefix name match","Alphabetical",".md","Last opened","Last modified"],includePrefixPathPatterns:[],excludePrefixPathPatterns:[],expand:!1},{name:"File name fuzzy search",searchBy:{tag:!1,link:!1,header:!1,property:!1},keysOfPropertyToSearch:[],relativeUpdatedPeriodSource:"none",relativeUpdatedPeriodPropertyKey:"Last modified",searchTarget:"file",allowFuzzySearchForSearchTarget:!0,minFuzzyMatchScore:.5,targetExtensions:[],includeCurrentFile:!1,floating:!1,autoPreview:!1,autoPreviewDelayMilliSeconds:300,showFrontMatter:!1,excludeFrontMatterKeys:X(),defaultInput:"",restoreLastInput:!1,commandPrefix:"",sortPriorities:["Prefix name match","Fuzzy name match",".md","Last opened","Last modified"],includePrefixPathPatterns:[],excludePrefixPathPatterns:[],expand:!1},{name:"Landmark search",searchBy:{tag:!0,link:!0,header:!0,property:!1},keysOfPropertyToSearch:[],relativeUpdatedPeriodSource:"none",relativeUpdatedPeriodPropertyKey:"Last modified",searchTarget:"file",allowFuzzySearchForSearchTarget:!1,minFuzzyMatchScore:.5,targetExtensions:[],includeCurrentFile:!1,floating:!1,autoPreview:!1,autoPreviewDelayMilliSeconds:300,showFrontMatter:!1,excludeFrontMatterKeys:X(),defaultInput:"",restoreLastInput:!1,commandPrefix:":l ",sortPriorities:["Prefix name match","Name match","Tag match","Header match","Link match",".md","Last opened","Last modified"],includePrefixPathPatterns:[],excludePrefixPathPatterns:[],expand:!1},{name:"Star search",searchBy:{tag:!1,link:!1,header:!1,property:!1},keysOfPropertyToSearch:[],relativeUpdatedPeriodSource:"none",relativeUpdatedPeriodPropertyKey:"Last modified",searchTarget:"file",allowFuzzySearchForSearchTarget:!1,minFuzzyMatchScore:.5,targetExtensions:[],includeCurrentFile:!1,floating:!1,autoPreview:!1,autoPreviewDelayMilliSeconds:300,showFrontMatter:!1,excludeFrontMatterKeys:X(),defaultInput:"",restoreLastInput:!1,commandPrefix:":s ",sortPriorities:["Star",".md","Last opened","Last modified"],includePrefixPathPatterns:[],excludePrefixPathPatterns:[],expand:!1},Mi()],ys={searchDelayMilliSeconds:0,maxNumberOfSuggestions:50,normalizeAccentsAndDiacritics:!1,useSelectionWordsAsDefaultInputQuery:!1,preventDuplicateTabs:!1,showDirectory:!0,showDirectoryAtNewLine:!1,showFullPathOfDirectory:!1,showAliasesOnTop:!1,displayAliaseAsTitle:!1,displayDescriptionBelowTitle:!1,showExistingFilesOnly:!1,hideGutterIcons:!1,hideHotkeyGuides:!1,userAltInsteadOfModForQuickResultSelection:!1,hotkeys:Ct(),searchCommands:fs(),searchesExcludePrefix:"-",searchesAutoAliasTransform:{enabled:!1,aliasPattern:"",aliasFormat:""},autoPreviewInFloatingHeaderSearch:!0,autoPreviewInFloatingLinkSearch:!1,backlinkExcludePrefixPathPatterns:[],inFileContextLines:2,autoPreviewInFloatingInFileSearch:!1,inFileMaxDisplayLengthAroundMatchedWord:64,ripgrepCommand:"rg",grepSearchDelayMilliSeconds:0,grepMinQueryLength:1,grepExtensions:["md"],maxDisplayLengthAroundMatchedWord:64,includeFilenameInGrepSearch:!1,defaultGrepFolder:"",autoPreviewInGrepSearch:!1,grepAutoPreviewDelayMilliSeconds:300,autoPreviewInBacklinkSearch:!1,backlinkAutoPreviewDelayMilliSeconds:300,moveFileExcludePrefixPathPatterns:[],moveFolderSortPriority:"Recently used",moveFileRecentlyUsedFilePath:"",moveFileMaxRecentlyUsedFolders:10,commandPaletteHistoryPath:"",commandPaletteMaxHistoryRetentionDays:10,showLogAboutPerformanceInConsole:!1,showFuzzyMatchScore:!1},Te=class extends b.PluginSettingTab{constructor(e,t){super(e,t);this.resetLock=!0;this.hotkeyHelpCleanups=[];this.globalSettingSearchQuery="";this.globalSettingSearchInputEl=null;this.hotkeyExpandedStatus={main:!1,folder:!1,move:!1,header:!1,backlink:!1,link:!1,"in-file":!1,grep:!1,command:!1};this.plugin=t}isGlobalSettingSearchActive(){return this.globalSettingSearchQuery.trim().length>0}createWarningName(e,t){let{createPopover:s}=Et(l=>{this.hotkeyHelpCleanups.push(l)}),r=createEl("div",{cls:["another-quick-switcher__settings__popup__icon","another-quick-switcher__settings__warning-icon"],text:"\u26A0\uFE0F"});r.setAttribute("type","button");let a=createDiv({text:t,cls:"another-quick-switcher__settings__warning"}),o=document.createDocumentFragment();return o.append(createSpan({text:e})),o.appendChild(s(r,a)),o}updateGlobalSettingSearchQuery(e){let t=this.isGlobalSettingSearchActive();this.globalSettingSearchQuery=e;let s=this.isGlobalSettingSearchActive();if(t!==s){this.display(),this.globalSettingSearchInputEl&&(this.globalSettingSearchInputEl.focus(),this.globalSettingSearchInputEl.setSelectionRange(e.length,e.length));return}St(this.containerEl,this.globalSettingSearchQuery)}display(){let{containerEl:e}=this;for(let r of this.hotkeyHelpCleanups)r();this.hotkeyHelpCleanups=[],e.empty();let t=e.createDiv({cls:"another-quick-switcher__settings__global-search"}),s=createEl("input",{cls:"another-quick-switcher__settings__global-search-input",attr:{type:"search",placeholder:"Search all settings"}});this.globalSettingSearchInputEl=s,s.value=this.globalSettingSearchQuery,s.addEventListener("input",r=>{r.target instanceof HTMLInputElement&&this.updateGlobalSettingSearchQuery(r.target.value)}),t.append(s),this.addGeneralSettings(e),this.addAppearanceSettings(e),this.addHotKeysInDialogSettings(e),this.addSearchSettings(e),this.addHeaderSearchSettings(e),this.addBacklinkSettings(e),this.addLinkSettings(e),this.addInFileSettings(e),this.addGrepSettings(e),this.addMoveSettings(e),this.addCommandPalleteSettings(e),this.addDebugSettings(e),St(e,this.globalSettingSearchQuery)}addGeneralSettings(e){e.createEl("h3",{text:"\u{1F310}General",cls:"another-quick-switcher__settings__header"}),new b.Setting(e).setName("Search delay milli-seconds").setDesc("If keyboard operation is slow, try increasing the value").addSlider(t=>t.setLimits(0,1e3,10).setValue(this.plugin.settings.searchDelayMilliSeconds).setDynamicTooltip().onChange(async s=>{this.plugin.settings.searchDelayMilliSeconds=s,await this.plugin.saveSettings()})),new b.Setting(e).setName("Max number of suggestions").addSlider(t=>t.setLimits(1,255,1).setValue(this.plugin.settings.maxNumberOfSuggestions).setDynamicTooltip().onChange(async s=>{this.plugin.settings.maxNumberOfSuggestions=s,await this.plugin.saveSettings()})),new b.Setting(e).setName(this.createWarningName("Normalize accents/diacritics","If enabled, it is about 2 to 5 times slower than disabled")).addToggle(t=>{t.setValue(this.plugin.settings.normalizeAccentsAndDiacritics).onChange(async s=>{this.plugin.settings.normalizeAccentsAndDiacritics=s,await this.plugin.saveSettings(),this.display()})}),new b.Setting(e).setName("Use selection words as a default input query").addToggle(t=>{t.setValue(this.plugin.settings.useSelectionWordsAsDefaultInputQuery).onChange(async s=>{this.plugin.settings.useSelectionWordsAsDefaultInputQuery=s,await this.plugin.saveSettings()})}),new b.Setting(e).setName("Prevent duplicate tabs").setDesc("If a file is already opened as a tab, it will not open in a new tab; instead, the existing tab will be activated. This option is enabled for three commands: 'open in new tab', 'open in new tab in background', and 'open all in new tabs'.").addToggle(t=>{t.setValue(this.plugin.settings.preventDuplicateTabs).onChange(async s=>{this.plugin.settings.preventDuplicateTabs=s,await this.plugin.saveSettings()})})}addAppearanceSettings(e){e.createEl("h3",{text:"\u{1F441}Appearance",cls:"another-quick-switcher__settings__header"}),new b.Setting(e).setName("Show directory").addToggle(t=>{t.setValue(this.plugin.settings.showDirectory).onChange(async s=>{this.plugin.settings.showDirectory=s,await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.showDirectory&&(new b.Setting(e).setName("Show directory at the new line").setClass("another-quick-switcher__settings__nested").addToggle(t=>{t.setValue(this.plugin.settings.showDirectoryAtNewLine).onChange(async s=>{this.plugin.settings.showDirectoryAtNewLine=s,await this.plugin.saveSettings()})}),new b.Setting(e).setName("Show full path of directory").setClass("another-quick-switcher__settings__nested").addToggle(t=>{t.setValue(this.plugin.settings.showFullPathOfDirectory).onChange(async s=>{this.plugin.settings.showFullPathOfDirectory=s,await this.plugin.saveSettings()})})),new b.Setting(e).setName("Display alias as title on keyword match").setDesc("When a keyword matches an alias, display the alias as the title.").addToggle(t=>{t.setValue(this.plugin.settings.showAliasesOnTop).onChange(async s=>{this.plugin.settings.showAliasesOnTop=s,await this.plugin.saveSettings()})}),new b.Setting(e).setName("Display the alias as the title").addToggle(t=>{t.setValue(this.plugin.settings.displayAliaseAsTitle).onChange(async s=>{this.plugin.settings.displayAliaseAsTitle=s,await this.plugin.saveSettings()})}),new b.Setting(e).setName("Display the 'description' property below the title").setDesc("When enabled, it will no longer appear in the property display area of the search results.").addToggle(t=>{t.setValue(this.plugin.settings.displayDescriptionBelowTitle).onChange(async s=>{this.plugin.settings.displayDescriptionBelowTitle=s,await this.plugin.saveSettings()})}),new b.Setting(e).setName("Show existing files only").addToggle(t=>{t.setValue(this.plugin.settings.showExistingFilesOnly).onChange(async s=>{this.plugin.settings.showExistingFilesOnly=s,await this.plugin.saveSettings()})}),new b.Setting(e).setName("Hide gutter icons").addToggle(t=>{t.setValue(this.plugin.settings.hideGutterIcons).onChange(async s=>{this.plugin.settings.hideGutterIcons=s,await this.plugin.saveSettings()})}),new b.Setting(e).setName("Hide hotkey guides").addToggle(t=>{t.setValue(this.plugin.settings.hideHotkeyGuides).onChange(async s=>{this.plugin.settings.hideHotkeyGuides=s,await this.plugin.saveSettings()})})}addHotKeysInDialogSettings(e){e.createEl("h3",{text:"\u2328Hotkeys in dialog",cls:"another-quick-switcher__settings__header"});let t=e.createDiv({cls:"another-quick-switcher__settings__dialog-hotkeys-container"}),s=(a,o)=>{if(!this.isGlobalSettingSearchActive()&&!this.hotkeyExpandedStatus[a])return;let l=new b.SettingGroup(o),{addFilterableSetting:c}=vt(l),u=(m,p)=>{c(m,null,h=>{h.setName(m).setClass("another-quick-switcher__settings__dialog-hotkey-item").addText(d=>{let f=this.plugin.settings.hotkeys[a];return d.setValue(Fe(f[p][0])).onChange(async v=>{var w,k;let y=rs(v,(k=(w=f[p][0])==null?void 0:w.hideHotkeyGuide)!=null?k:!1);f[p]=y?[y]:[],await this.plugin.saveSettings()})}).addToggle(d=>{var v;let f=this.plugin.settings.hotkeys[a];return d.setTooltip("Show hotkey guide if enabled").setValue(!((v=f[p][0])!=null&&v.hideHotkeyGuide)).onChange(async y=>{f[p]=f[p][0]?[{...f[p][0],hideHotkeyGuide:!y}]:[],await this.plugin.saveSettings()})})})},g=Object.keys(this.plugin.settings.hotkeys[a]);for(let m of g)u(m,m)},r=(a,o)=>{let l=createDiv({cls:"another-quick-switcher__settings__dialog-hotkey"});t.append(l);let{createPopover:c}=Et(f=>{this.hotkeyHelpCleanups.push(f)}),u=createEl("div",{cls:"another-quick-switcher__settings__popup__icon",text:"i"});u.setAttribute("type","button");let g=createDiv(),m=g.createEl("ul"),p=m.createEl("li");p.append("You can know the keycode at ",createEl("a",{text:"keycode.info",href:"https://keycode.info/"}),". (Press any key and show 'event.key')"),p.createEl("ul").createEl("li",{text:"For the space key, please set the value to 'Space'."}),m.createEl("li",{text:"'Ctrl a' means pressing the Ctrl key and the A key."}),m.createEl("li",{text:"Use 'Mod' instead of 'Ctrl' on Windows or 'Cmd' on macOS."});let h=c(u,g),d=document.createDocumentFragment();d.createSpan({text:o,cls:"another-quick-switcher__settings__dialog-hotkey__title"}),d.appendChild(h),new b.Setting(l).setHeading().setName(d).addExtraButton(f=>f.setIcon(this.hotkeyExpandedStatus[a]?"chevron-up":"chevron-down").setTooltip(this.hotkeyExpandedStatus[a]?"fold":"unfold").onClick(()=>{this.hotkeyExpandedStatus[a]=!this.hotkeyExpandedStatus[a],this.display()})),s(a,l)};r("main","Main dialog"),r("folder","Folder dialog"),r("header","Header dialog"),r("backlink","Backlink dialog"),r("link","Link dialog"),r("in-file","In File dialog"),r("grep","Grep dialog"),r("command","Command palette"),new b.Setting(e).setName("Use `alt 1\uFF5E9` instead of `ctrl/cmd 1\uFF5E9` for quick result selection").addToggle(a=>{a.setValue(this.plugin.settings.userAltInsteadOfModForQuickResultSelection).onChange(async o=>{this.plugin.settings.userAltInsteadOfModForQuickResultSelection=o,await this.plugin.saveSettings()})})}addSearchSettings(e){if(e.createEl("h3",{text:"\u{1F50D} Search commands",cls:"another-quick-switcher__settings__header"}),this.plugin.settings.searchCommands.forEach((t,s)=>{this.addSearchCommandSetting(e,this.plugin.settings.searchCommands[s])}),new b.Setting(e).setHeading().addButton(t=>{t.setButtonText("Add a new command").setTooltip("Add a new command").setCta().setClass("another-quick-switcher__settings__search-command__add-button").onClick(async s=>{this.plugin.settings.searchCommands.push(xt()),this.display()})}),new b.Setting(e).setName("Reset all search commands").setClass("another-quick-switcher__settings__danger").setDesc("It means your customized commands will be removed.").addToggle(t=>{t.setValue(this.resetLock).onChange(s=>{this.resetLock=s,this.display()}),this.resetLock&&t.setTooltip("Turn off the lock, if you want to reset all search commands")}).addButton(t=>{t.setButtonText("Reset").setTooltip("Reset all search commands!!").setDisabled(this.resetLock).onClick(async()=>{this.plugin.settings.searchCommands=fs(),await this.plugin.saveSettings(),this.plugin.reloadCommands(),this.display()}),this.resetLock||t.setCta()}),new b.Setting(e).setName("Exclude prefix").setDesc("Adding this at the beginning of a query excludes matching results.").addText(t=>{t.setValue(this.plugin.settings.searchesExcludePrefix).onChange(async s=>{this.plugin.settings.searchesExcludePrefix=s,await this.plugin.saveSettings()})}),new b.Setting(e).setName("Auto alias transform").setDesc("Transforms a selected link candidate into an internal link with an aliase based on a regex-defined rule when using the insert to editor command.").addToggle(t=>{t.setValue(this.plugin.settings.searchesAutoAliasTransform.enabled).onChange(async s=>{this.plugin.settings.searchesAutoAliasTransform.enabled=s,await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.searchesAutoAliasTransform.enabled){let t=String.raw`Ex: (?<name>.+) \(.+\)$`;new b.Setting(e).setName("Alias pattern").setDesc(`Specifies the regex pattern to identify parts of the link candidate for transformation into an alias. ${t}`).setClass("another-quick-switcher__settings__nested").addText(s=>{s.setValue(this.plugin.settings.searchesAutoAliasTransform.aliasPattern).onChange(async r=>{this.plugin.settings.searchesAutoAliasTransform.aliasPattern=r,await this.plugin.saveSettings()})}),new b.Setting(e).setName("Alias format").setDesc("Defines the format for the alias after transformation, using regex-captured groups from the candidate name. Ex: $<name>").setClass("another-quick-switcher__settings__nested").addText(s=>{s.setValue(this.plugin.settings.searchesAutoAliasTransform.aliasFormat).onChange(async r=>{this.plugin.settings.searchesAutoAliasTransform.aliasFormat=r,await this.plugin.saveSettings()})})}}addSearchCommandSetting(e,t){let s=createDiv({cls:"another-quick-switcher__settings__search-command"});e.append(s);let r=async p=>{if(!t.name.trim()){new b.Notice("\u274C Command name is required");return}let h=t.sortPriorities.filter(d=>!hs(d));if(h.length>0){new b.Notice(`
\u274C Invalid sort priorities:
${h.map(d=>`- ${d}`).join(`
`)}
`.trim(),0);return}await this.plugin.saveSettings(),p!=null&&p.reloadCommands&&this.plugin.reloadCommands()};if(new b.Setting(s).setClass("another-quick-switcher__settings__search-command__header").setHeading().addText(p=>be.onChange(p,async h=>{t.name=h,await r({reloadCommands:!0})},{style:"text-align: left"}).setPlaceholder("Command name").setValue(t.name)).addExtraButton(p=>(p.setTooltip("Delete a command (!! it will never be restored !!)").setIcon("trash-2").onClick(async()=>{this.plugin.settings.searchCommands.remove(t),await this.plugin.saveSettings(),this.plugin.reloadCommands(),this.display()}),p.extraSettingsEl.addClass("another-quick-switcher__settings__search-command__header__delete"),p)).addExtraButton(p=>(p.setIcon(t.expand?"chevron-up":"chevron-down").setTooltip(t.expand?"fold":"unfold").onClick(async()=>{t.expand=!t.expand,await this.plugin.saveSettings(),this.display()}),p.extraSettingsEl.addClass("another-quick-switcher__settings__search-command__header__fold-button"),p)),!this.isGlobalSettingSearchActive()&&!t.expand)return;let a=new b.SettingGroup(s),{addFilterableSetting:o}=vt(a),l="another-quick-switcher__settings__search-command__search-by-button",c="another-quick-switcher__settings__search-command__search-by-button_enabled",u="another-quick-switcher__settings__search-command__search-by-button_disabled";o("Search by",null,p=>{p.setName("Search by").setDesc("Click the button to enable/disable the search target").addButton(h=>{let d=()=>{h.buttonEl.removeClass(c,u),h.buttonEl.addClass(t.searchBy.tag?c:u)};return h.setButtonText("Tag").setClass(l).onClick(async()=>{t.searchBy.tag=!t.searchBy.tag,d(),await r()}),d(),h}).addButton(h=>{let d=()=>{h.buttonEl.removeClass(c,u),h.buttonEl.addClass(t.searchBy.header?c:u)};return h.setButtonText("Header").setClass(l).onClick(async()=>{t.searchBy.header=!t.searchBy.header,d(),await r()}),d(),h}).addButton(h=>{let d=()=>{h.buttonEl.removeClass(c,u),h.buttonEl.addClass(t.searchBy.link?c:u)};return h.setButtonText("Link").setClass(l).onClick(async()=>{t.searchBy.link=!t.searchBy.link,d(),await r()}),d(),h}).addButton(h=>{let d=()=>{h.buttonEl.removeClass(c,u),h.buttonEl.addClass(t.searchBy.property?c:u)};return h.setButtonText("Property").setClass(l).onClick(async()=>{t.searchBy.property=!t.searchBy.property,d(),await r(),this.display()}),d(),h})}),t.searchBy.property&&o("Keys of the property to search","Multiple entries can be specified, separated by line breaks.",p=>{p.addTextArea(h=>ue.onChange(h,async d=>{t.keysOfPropertyToSearch=se(d),await r()},{className:"another-quick-switcher__settings__keys_of_property_to_search"}).setValue(t.keysOfPropertyToSearch.join(`
`)))}),o("Search target",null,p=>{p.setName("Search target").addDropdown(h=>{h.addOptions(ct([...Hi])).setValue(t.searchTarget).onChange(async d=>{t.searchTarget=d,await r()})})}),o('Allow fuzzy search for "Search target"',null,p=>{p.addToggle(h=>{h.setValue(t.allowFuzzySearchForSearchTarget).onChange(async d=>{t.allowFuzzySearchForSearchTarget=d,await r()})})}),o("Min fuzzy match score","Only show suggestion those score is more than the specific score",p=>{p.addSlider(h=>h.setLimits(0,10,.1).setValue(t.minFuzzyMatchScore).setDynamicTooltip().onChange(async d=>{t.minFuzzyMatchScore=d,await r()}))}),o("Target extensions","If set, only files whose extension equals will be suggested. If empty, all files will be suggested. It can set multi extensions using comma.",p=>{p.addTextArea(h=>ue.onChange(h,async d=>{t.targetExtensions=gt(d),await r()}).setPlaceholder("(ex: md,png,canvas)").setValue(t.targetExtensions.join(",")))}),o("Include current file",null,p=>{p.addToggle(h=>{h.setValue(t.includeCurrentFile).onChange(async d=>{t.includeCurrentFile=d,await r()})})}),o("Floating",null,p=>{p.addToggle(h=>{h.setValue(t.floating).onChange(async d=>{t.floating=d,await r(),this.display()})})}),o("Auto preview","If enabled, automatically shows preview when selecting candidates.",p=>{p.addToggle(h=>{h.setValue(t.autoPreview).onChange(async d=>{t.autoPreview=d,await r(),this.display()})})}),t.autoPreview&&o("Auto preview delay milli-seconds","Delay before auto preview is triggered when selection changes.",p=>{p.setClass("another-quick-switcher__settings__nested").addSlider(h=>h.setLimits(0,1e3,50).setValue(t.autoPreviewDelayMilliSeconds).setDynamicTooltip().onChange(async d=>{t.autoPreviewDelayMilliSeconds=d,await r()}))}),o("Front matter",null,p=>{p.addToggle(h=>{h.setValue(t.showFrontMatter).onChange(async d=>{t.showFrontMatter=d,await r(),this.display()})})}),t.showFrontMatter&&o("Exclude front matter keys","It can set multi patterns by line breaks.",p=>{p.addTextArea(h=>ue.onChange(h,async d=>{t.excludeFrontMatterKeys=se(d),await r()},{className:"another-quick-switcher__settings__exclude_front_matter_keys"}).setValue(t.excludeFrontMatterKeys.join(`
`)))});let g={none:"Do not show",modified:"Last modified",created:"Created time",property:"Property"};o("Relative updated period source","Shown in each suggestion.",p=>{p.addDropdown(h=>{h.addOptions(g).setValue(t.relativeUpdatedPeriodSource).onChange(async d=>{t.relativeUpdatedPeriodSource=d,await r(),this.display()})})}),t.relativeUpdatedPeriodSource==="property"&&o("Property key for relative updated period","Use a front matter property value that can be parsed as a date.",p=>{p.setClass("another-quick-switcher__settings__nested"),p.addText(h=>be.onChange(h,async d=>{t.relativeUpdatedPeriodPropertyKey=d.trim(),await r()}).setValue(t.relativeUpdatedPeriodPropertyKey).setPlaceholder("(ex: updated)"))}),o("Default input","Default input strings when it opens the dialog",p=>{p.addText(h=>be.onChange(h,async d=>{t.defaultInput=d,await r()}).setValue(t.defaultInput).setPlaceholder("(ex: #todo )"))}),o("Restore last input","If enabled, this option will restore the last input, shared across all searches where it is enabled.",p=>{p.addToggle(h=>{h.setValue(t.restoreLastInput).onChange(async d=>{t.restoreLastInput=d,await r()})})}),o("Command prefix","For example, if it sets ':r ', a query starts with ':r ' means that search as this command",p=>{p.addText(h=>be.onChange(h,async d=>{t.commandPrefix=d,await r()}).setValue(t.commandPrefix).setPlaceholder("(ex: :r )"))});let m=document.createDocumentFragment();m.append("Valid sort priorities refer to ",createEl("a",{text:"README",href:"https://github.com/tadashi-aikawa/obsidian-another-quick-switcher#sort-priorities"})),o("Sort priorities",m,p=>{p.addTextArea(h=>ue.onChange(h,async d=>{let f=se(d);t.sortPriorities=f,await r()},{className:"another-quick-switcher__settings__search-command__sort-priority"}).setPlaceholder("").setValue(t.sortPriorities.join(`
`)))}),o("Include path patterns","If set, only files whose paths start with one of the patterns will be suggested. It can set multi patterns by line breaks. <current_dir> means current directory.",p=>{p.addTextArea(h=>ue.onChange(h,async d=>{t.includePrefixPathPatterns=se(d),await r()},{className:"another-quick-switcher__settings__include_path_patterns"}).setPlaceholder("(ex: Notes/Private)").setValue(t.includePrefixPathPatterns.join(`
`)))}),o("Exclude prefix path patterns","If set, files whose paths start with one of the patterns will not be suggested. It can set multi patterns by line breaks. <current_dir> means current directory.",p=>{p.addTextArea(h=>ue.onChange(h,async d=>{t.excludePrefixPathPatterns=se(d),await r()},{className:"another-quick-switcher__settings__exclude_path_patterns"}).setPlaceholder("(ex: Notes/Private)").setValue(t.excludePrefixPathPatterns.join(`
`)))})}addHeaderSearchSettings(e){e.createEl("h3",{text:"\u{1F4D2} Header search",cls:"another-quick-switcher__settings__header"}),new b.Setting(e).setName("Auto preview in the floating mode").addToggle(t=>{t.setValue(this.plugin.settings.autoPreviewInFloatingHeaderSearch).onChange(async s=>{this.plugin.settings.autoPreviewInFloatingHeaderSearch=s,await this.plugin.saveSettings()})})}addBacklinkSettings(e){e.createEl("h3",{text:"\u{1F50D} Backlink search",cls:"another-quick-switcher__settings__header"}),new b.Setting(e).setName('Exclude prefix path patterns for "Backlink search"').setDesc("If set, folders whose paths start with one of the patterns will not be suggested. It can set multi patterns by line breaks").addTextArea(t=>{let s=t.setPlaceholder("Prefix match patterns").setValue(this.plugin.settings.backlinkExcludePrefixPathPatterns.join(`
`)).onChange(async r=>{this.plugin.settings.backlinkExcludePrefixPathPatterns=se(r),await this.plugin.saveSettings()});return s.inputEl.className="another-quick-switcher__settings__ignore_path_patterns",s}),new b.Setting(e).setName("Auto preview").setDesc("If enabled, automatically shows preview when selecting candidates.").addToggle(t=>{t.setValue(this.plugin.settings.autoPreviewInBacklinkSearch).onChange(async s=>{this.plugin.settings.autoPreviewInBacklinkSearch=s,await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.autoPreviewInBacklinkSearch&&new b.Setting(e).setName("Auto preview delay milli-seconds").setDesc("Delay before auto preview is triggered when selection changes.").addSlider(t=>t.setLimits(0,1e3,50).setValue(this.plugin.settings.backlinkAutoPreviewDelayMilliSeconds).setDynamicTooltip().onChange(async s=>{this.plugin.settings.backlinkAutoPreviewDelayMilliSeconds=s,await this.plugin.saveSettings()}))}addLinkSettings(e){e.createEl("h3",{text:"\u{1F517} Link search",cls:"another-quick-switcher__settings__header"}),new b.Setting(e).setName("Auto preview in the floating mode").addToggle(t=>{t.setValue(this.plugin.settings.autoPreviewInFloatingLinkSearch).onChange(async s=>{this.plugin.settings.autoPreviewInFloatingLinkSearch=s,await this.plugin.saveSettings()})})}addInFileSettings(e){e.createEl("h3",{text:"\u{1F50D} In file search",cls:"another-quick-switcher__settings__header"}),new b.Setting(e).setName("Context Lines").setDesc("Specifies the number of lines to display before and after the target line. For instance, setting this to '2' would display two lines before and two lines after the target line, providing context to the selected text").addSlider(t=>t.setLimits(0,10,1).setValue(this.plugin.settings.inFileContextLines).setDynamicTooltip().onChange(async s=>{this.plugin.settings.inFileContextLines=s,await this.plugin.saveSettings()})),new b.Setting(e).setName("Auto preview in the floating mode").addToggle(t=>{t.setValue(this.plugin.settings.autoPreviewInFloatingInFileSearch).onChange(async s=>{this.plugin.settings.autoPreviewInFloatingInFileSearch=s,await this.plugin.saveSettings()})}),new b.Setting(e).setName("Max display length around matched word").setDesc("Maximum display character count before or after the matched word.").addSlider(t=>t.setLimits(1,255,1).setValue(this.plugin.settings.inFileMaxDisplayLengthAroundMatchedWord).setDynamicTooltip().onChange(async s=>{this.plugin.settings.inFileMaxDisplayLengthAroundMatchedWord=s,await this.plugin.saveSettings()}))}addGrepSettings(e){e.createEl("h3",{text:"\u{1F50D} Grep",cls:"another-quick-switcher__settings__header"}),new b.Setting(e).setName(this.createWarningName("Ripgrep command","Please note that on Windows, the initial file access speed may be significantly slower.")).setDesc("A command that can execute ripgrep").addText(t=>t.setValue(this.plugin.settings.ripgrepCommand).onChange(async s=>{this.plugin.settings.ripgrepCommand=s,await this.plugin.saveSettings()})),new b.Setting(e).setName("Grep search delay milli-seconds").setDesc("If set to 1 or more, the search will be executed automatically after the specified milliseconds have passed since entering a keyword. If set to 0, the search will only be executed when the hotkey is pressed.").addSlider(t=>t.setLimits(0,1e3,10).setValue(this.plugin.settings.grepSearchDelayMilliSeconds).setDynamicTooltip().onChange(async s=>{this.plugin.settings.grepSearchDelayMilliSeconds=s,await this.plugin.saveSettings()})),new b.Setting(e).setName("Minimum query length for auto search").setDesc("The minimum number of characters required to start an automatic search.").addSlider(t=>t.setLimits(1,10,1).setValue(this.plugin.settings.grepMinQueryLength).setDynamicTooltip().onChange(async s=>{this.plugin.settings.grepMinQueryLength=s,await this.plugin.saveSettings()})),new b.Setting(e).setName("Extensions").addText(t=>t.setPlaceholder("(ex: md,html,css)").setValue(this.plugin.settings.grepExtensions.join(",")).onChange(async s=>{this.plugin.settings.grepExtensions=gt(s),await this.plugin.saveSettings()})),new b.Setting(e).setName("Default folder").setDesc("Default folder path for grep searches. Leave empty to use vault root. Use ./ for current directory.").addText(t=>t.setPlaceholder("(ex: ./, folder/subfolder)").setValue(this.plugin.settings.defaultGrepFolder).onChange(async s=>{this.plugin.settings.defaultGrepFolder=s,await this.plugin.saveSettings()})),new b.Setting(e).setName("Max display length around matched word").setDesc("Maximum display character count before or after the matched word.").addSlider(t=>t.setLimits(1,255,1).setValue(this.plugin.settings.maxDisplayLengthAroundMatchedWord).setDynamicTooltip().onChange(async s=>{this.plugin.settings.maxDisplayLengthAroundMatchedWord=s,await this.plugin.saveSettings()})),new b.Setting(e).setName("Include file name in search").setDesc("If enabled, file names are also included in the search target.").addToggle(t=>{t.setValue(this.plugin.settings.includeFilenameInGrepSearch).onChange(async s=>{this.plugin.settings.includeFilenameInGrepSearch=s,await this.plugin.saveSettings(),this.display()})}),new b.Setting(e).setName("Auto preview").setDesc("If enabled, automatically shows preview when selecting candidates.").addToggle(t=>{t.setValue(this.plugin.settings.autoPreviewInGrepSearch).onChange(async s=>{this.plugin.settings.autoPreviewInGrepSearch=s,await this.plugin.saveSettings(),this.display()})}),this.plugin.settings.autoPreviewInGrepSearch&&new b.Setting(e).setName("Auto preview delay milli-seconds").setClass("another-quick-switcher__settings__nested").setDesc("Delay before auto preview is triggered when selection changes.").addSlider(t=>t.setLimits(0,1e3,50).setValue(this.plugin.settings.grepAutoPreviewDelayMilliSeconds).setDynamicTooltip().onChange(async s=>{this.plugin.settings.grepAutoPreviewDelayMilliSeconds=s,await this.plugin.saveSettings()}))}addMoveSettings(e){e.createEl("h3",{text:"\u{1F4C1} Move file to another folder",cls:"another-quick-switcher__settings__header"}),new b.Setting(e).setName('Exclude prefix path patterns for "Move file to another folder"').setDesc("If set, folders whose paths start with one of the patterns will not be suggested. It can set multi patterns by line breaks").addTextArea(t=>{let s=t.setPlaceholder("Prefix match patterns").setValue(this.plugin.settings.moveFileExcludePrefixPathPatterns.join(`
`)).onChange(async r=>{this.plugin.settings.moveFileExcludePrefixPathPatterns=se(r),await this.plugin.saveSettings()});return s.inputEl.className="another-quick-switcher__settings__ignore_path_patterns",s}),new b.Setting(e).setName("Folder sort priority").setDesc("How to sort folders in move dialog").addDropdown(t=>t.addOptions(ct([...Ti])).setValue(this.plugin.settings.moveFolderSortPriority).onChange(async s=>{this.plugin.settings.moveFolderSortPriority=s,await this.plugin.saveSettings()})),new b.Setting(e).setName("Recently used folders file path").setDesc("Path within vault to store recently used folders history").addText(t=>{t.setPlaceholder(".obsidian/plugins/obsidian-another-quick-switcher/recently-used-folders.json").setValue(this.plugin.settings.moveFileRecentlyUsedFilePath).onChange(async s=>{this.plugin.settings.moveFileRecentlyUsedFilePath=s,await this.plugin.saveSettings()})}),new b.Setting(e).setName("Max recently used folders").setDesc("Maximum number of recently used folders to remember").addSlider(t=>{t.setLimits(5,50,5).setValue(this.plugin.settings.moveFileMaxRecentlyUsedFolders).setDynamicTooltip().onChange(async s=>{this.plugin.settings.moveFileMaxRecentlyUsedFolders=s,await this.plugin.saveSettings()})})}addCommandPalleteSettings(e){e.createEl("h3",{text:"\u2318 Command pallete",cls:"another-quick-switcher__settings__header"}),new b.Setting(e).setName("History mapping file path").setDesc("Path within vault to store command history data").addText(t=>{t.setPlaceholder(".obsidian/plugins/obsidian-another-quick-switcher/command-history.json").setValue(this.plugin.settings.commandPaletteHistoryPath).onChange(async s=>{this.plugin.settings.commandPaletteHistoryPath=s,await this.plugin.saveSettings()})}),new b.Setting(e).setName("Max history retention days").setDesc("Commands not used within this number of days will be removed. Set to 0 to retain all history.").addSlider(t=>{t.setLimits(0,30,1).setValue(this.plugin.settings.commandPaletteMaxHistoryRetentionDays).setDynamicTooltip().onChange(async s=>{this.plugin.settings.commandPaletteMaxHistoryRetentionDays=s,await this.plugin.saveSettings()})})}addDebugSettings(e){e.createEl("h3",{text:"Debug",cls:"another-quick-switcher__settings__header"}),new b.Setting(e).setName("Show log about performance in a console").addToggle(t=>{t.setValue(this.plugin.settings.showLogAboutPerformanceInConsole).onChange(async s=>{this.plugin.settings.showLogAboutPerformanceInConsole=s,await this.plugin.saveSettings()})}),new b.Setting(e).setName("Show fuzzy match score in the dialog").addToggle(t=>{t.setValue(this.plugin.settings.showFuzzyMatchScore).onChange(async s=>{this.plugin.settings.showFuzzyMatchScore=s,await this.plugin.saveSettings()})})}};function Li(n,i){return`${n}: ${Math.round(i)}[ms]`}var z=class n{constructor(i){this.settings=i}static of(i){return new n(i)}showDebugLog(i,e){this.settings.showLogAboutPerformanceInConsole&&console.log(Li(i,performance.now()-e))}};var ws=require("obsidian");function Di(n){return n.ctrlKey||ws.Platform.isMacOS&&n.metaKey}function ne(n){return Di(n)?"new-tab":"same-tab"}var vs=require("obsidian"),I=class extends vs.SuggestModal{constructor(){super(...arguments);this.selectedItemMap={};this.lastPreviewScrollAt=0}getItems(){var e;return(e=this.chooser.values)!=null?e:null}getSelectedItem(){var e,t;return(t=(e=this.getItems())==null?void 0:e[this.chooser.selectedItem])!=null?t:null}getSelectedElement(){var e,t;return(t=(e=this.chooser.suggestions)==null?void 0:e[this.chooser.selectedItem])!=null?t:null}getSelected(){return{item:this.getSelectedItem(),element:this.getSelectedElement()}}scheduleRecentHistoryRestore(e){if(!e)return;let t=()=>this.appHelper.restoreLastOpenFilesSnapshot(e);if(typeof requestAnimationFrame=="function"){requestAnimationFrame(()=>{setTimeout(t,0)});return}setTimeout(t,0)}buildRecentHistoryForFinalOpen(e,t,s){if(!e)return null;let r=e.filter(a=>a!==s&&a!==t);return t&&t!==s&&r.unshift(t),r.unshift(s),r}selectNextItem(){this.chooser.setSelectedItem(this.chooser.selectedItem+1)}getCheckedItems(){return Object.values(this.selectedItemMap)}renderCheckedCountBadge(e,t){var s;(s=this.checkedCountEl)==null||s.remove(),this.checkedCountEl=createDiv({cls:["another-quick-switcher__checked-count-badge","another-quick-switcher__checked-count-badge--hidden",e]}),t.appendChild(this.checkedCountEl),this.updateCheckedCountBadge()}updateCheckedCountBadge(){if(!this.checkedCountEl)return;let e=Object.keys(this.selectedItemMap).length;if(e===0){this.checkedCountEl.classList.add("another-quick-switcher__checked-count-badge--hidden"),this.checkedCountEl.textContent="";return}this.checkedCountEl.classList.remove("another-quick-switcher__checked-count-badge--hidden"),this.checkedCountEl.textContent=String(e)}async actionMultiItems(e,t){let s=this.getCheckedItems();if(s.length>0){for(let a of s)await e(a,"check");return}let r=this.getSelectedItem();if(!r){t&&await t();return}e(r,"select")}async toggleCheckedItem(e){let{item:t,element:s}=this.getSelected();if(!t||!s)return;let r=this.toKey(t);this.selectedItemMap[r]?delete this.selectedItemMap[r]:this.selectedItemMap[r]=t,s.empty(),this.renderSuggestion(t,s),this.updateCheckedCountBadge(),e!=null&&e.moveNext&&this.selectNextItem()}checkAll(){var e;for(let t of(e=this.chooser.values)!=null?e:[]){let s=this.toKey(t);this.selectedItemMap[s]=t}this.updateSuggestions(),this.updateCheckedCountBadge()}toggleCheckAll(){var s;if(((s=this.chooser.values)!=null?s:[]).every(r=>{let a=this.toKey(r);return!!this.selectedItemMap[a]})){this.uncheckAll();return}this.checkAll()}uncheckAll(){var e;for(let t of(e=this.chooser.values)!=null?e:[]){let s=this.toKey(t);this.selectedItemMap[s]&&delete this.selectedItemMap[s]}this.updateSuggestions(),this.updateCheckedCountBadge()}getScrollElementFromActiveLeaf(){let e=this.appHelper.getMarkdownViewInActiveLeaf();return e?e.getMode()==="preview"?e.contentEl.querySelector(".markdown-preview-view"):e.contentEl.querySelector(".cm-scroller"):null}scrollActiveLeafByPage(e){let t=this.getScrollElementFromActiveLeaf();if(!t)return;let s=Math.max(80,Math.floor(t.clientHeight*.25)),r=Date.now(),a=r-this.lastPreviewScrollAt<=120;this.lastPreviewScrollAt=r;let o=activeWindow.matchMedia("(prefers-reduced-motion: reduce)").matches;t.scrollBy({top:e==="down"?s:-s,left:0,behavior:o||a?"auto":"smooth"})}enableFloatingModalWheelScroll(){let e=activeWindow.activeDocument.querySelector(".modal-bg");if(!e)return;let t=r=>{let a=activeWindow.activeDocument.elementsFromPoint(r.clientX,r.clientY);for(let o of a){if(o.closest(".modal, .prompt, .modal-bg"))continue;let l=o.closest(".markdown-preview-view, .cm-scroller");if(l&&!(l.classList.contains("cm-scroller")&&!l.closest(".markdown-source-view")))return l}return null},s=r=>{var o,l;if((o=this.modalEl)!=null&&o.contains(r.target))return;let a=(l=t(r))!=null?l:this.getScrollElementFromActiveLeaf();a&&(r.deltaX===0&&r.deltaY===0||a.scrollBy({left:r.deltaX,top:r.deltaY,behavior:"auto"}))};e.addEventListener("wheel",s,{passive:!0}),this.floatingModalBg=e,this.floatingWheelHandler=s}disableFloatingModalWheelScroll(){this.floatingModalBg&&this.floatingWheelHandler&&this.floatingModalBg.removeEventListener("wheel",this.floatingWheelHandler),this.floatingModalBg=void 0,this.floatingWheelHandler=void 0}};var ks='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 24 24" width="15" height="15"><g fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 3v4a1 1 0 0 0 1 1h4"></path><path d="M17 21H7a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7l5 5v11a2 2 0 0 1-2 2z"></path></g></svg>',D='<svg viewBox="0 0 100 100" class="folder" width="17" height="17"><path fill="currentColor" stroke="currentColor" d="M6.1,8c-3.3,0-6,2.7-6,6v73.8c-0.1,0.5-0.1,0.9,0.1,1.4c0.6,2.7,3,4.8,5.9,4.8h78c3,0,5.4-2.2,5.9-5.1 c0-0.1,0.1-0.2,0.1-0.4c0,0,0-0.1,0-0.1l0.1-0.3c0,0,0,0,0-0.1l9.9-53.6l0.1-0.2V34c0-3.3-2.7-6-6-6v-6c0-3.3-2.7-6-6-6H36.1 c0,0,0,0-0.1,0c-0.1,0-0.2-0.2-0.6-0.6c-0.5-0.6-1.1-1.5-1.7-2.5c-0.6-1-1.3-2.1-2.1-3C30.9,9,29.7,8,28.1,8L6.1,8z M6.1,12h22 c-0.1,0,0.1,0,0.6,0.6c0.5,0.6,1.1,1.5,1.7,2.5c0.6,1,1.3,2.1,2.1,3c0.8,0.9,1.9,1.9,3.6,1.9h52c1.1,0,2,0.9,2,2v6h-74 c-3.1,0-5.7,2.5-5.9,5.6h-0.1L10.1,34l-6,32.4V14C4.1,12.9,4.9,12,6.1,12z M16.1,32h78c1.1,0,2,0.9,2,2l-9.8,53.1l-0.1,0.1 c0,0.1,0,0.2-0.1,0.2c0,0.1,0,0.2-0.1,0.2c0,0,0,0.1,0,0.1c0,0,0,0,0,0.1c0,0.1,0,0.2-0.1,0.3c0,0.1,0,0.1,0,0.2 c0,0.1,0,0.2,0,0.2c-0.3,0.8-1,1.4-1.9,1.4h-78c-1.1,0-2-0.9-2-2L14,34.4l0.1-0.2V34C14.1,32.9,14.9,32,16.1,32L16.1,32z"></path></svg>',_t='<svg viewBox="0 0 100 100" class="forward-arrow" width="16" height="16"><path fill="currentColor" stroke="currentColor" d="m9.9,89.09226c-0.03094,0 -0.05414,0 -0.08508,0c-1.06734,-0.04641 -1.91039,-0.92812 -1.89492,-1.99547c0.00774,-0.48726 1.14469,-48.13101 47.52,-49.44586l0,-13.89094c0,-0.7657 0.44086,-1.4618 1.12922,-1.78664c0.68062,-0.33258 1.5082,-0.23203 2.09601,0.2475l31.68,25.74c0.46406,0.37899 0.73476,0.9436 0.73476,1.53914c0,0.59555 -0.2707,1.16016 -0.72703,1.53914l-31.68,25.74c-0.59555,0.47953 -1.41539,0.57234 -2.10375,0.2475c-0.68836,-0.32485 -1.12922,-1.02094 -1.12922,-1.78664l0,-13.84453c-41.26289,0.75024 -43.49039,24.81961 -43.56773,25.85601c-0.06961,1.04414 -0.93586,1.84078 -1.97226,1.84078z"></path></svg>',Me='<svg viewBox="0 0 100 100" class="hashtag" width="17" height="17"><path fill="currentColor" stroke="currentColor" d="M36,18l-1.5,16H20l-0.4,4h14.5l-2.4,26H17.2l-0.4,4h14.5L30,82h4l1.3-14h26L60,82h4l1.3-14h15.5l0.4-4H65.7l2.4-26h15.5 l0.4-4H68.5L70,18h-4l-1.5,16h-26L40,18L36,18z M38.1,38h26l-2.4,26h-26L38.1,38z"></path></svg>',Le='<svg viewBox="0 0 100 100" class="links-going-out" width="15" height="15"><path fill="currentColor" stroke="currentColor" d="M76.4,11.7c3.7,3.8,5.6,8.9,5,14.3c-0.5,4-2.4,7.6-5.2,10.5c-2.6,2.6-6.7,6.7-9.2,9.2c-2,2-4.4,3.6-7.1,4.5 c-4.5,1.4-9,1-12.8-0.9l2.9-2.9c1.4,0.5,3,0.8,4.5,0.8c3.6,0,7-1.4,9.5-3.9l9.6-9.6c3.3-3.3,4.7-8.1,3.5-13 c-0.3-1.2-0.8-2.4-1.5-3.5C73,13,68.7,10.6,64,10.6c-3.6,0-7,1.4-9.5,3.9L45,24c-2.5,2.5-3.9,5.9-3.9,9.5c0,1.6,0.3,3.1,0.8,4.5 l-3,3c-1.1-2.3-1.7-4.8-1.7-7.5c0-0.7,0-1.4,0.1-2.1c0.5-3.8,2.2-7.4,5-10.2l9.4-9.4C54.5,9,58.2,7,62.1,6.6 C67.5,6.1,72.6,7.9,76.4,11.7L76.4,11.7z M54.4,34.7c0.3,0.7,0.1,1.6-0.4,2.1L30.9,59.9c-0.5,0.5-1.2,0.7-1.9,0.5 s-1.2-0.7-1.4-1.4s0-1.4,0.5-1.9L51.2,34c0.3-0.4,0.8-0.6,1.3-0.6C53.4,33.5,54.1,34,54.4,34.7z M35.1,44.9l-2.9,2.9 c-1.4-0.5-3-0.8-4.5-0.8c-3.6,0-7,1.4-9.5,3.9l-9.6,9.6c-3.3,3.4-4.7,8.1-3.5,13c0.3,1.2,0.8,2.4,1.5,3.5 c2.6,4.2,6.9,6.6,11.6,6.6c3.6,0,7-1.4,9.5-3.9l9.6-9.6c2.5-2.5,3.9-5.9,3.9-9.5c0-1.6-0.3-3.1-0.8-4.5l2.9-2.9 c1.1,2.3,1.7,4.8,1.7,7.5c0,3-0.8,5.9-2.2,8.5c-0.8,1-1.5,1.9-2.1,2.9c-0.3,0.3-0.5,0.6-0.8,0.8l-9.4,9.4 c-2.9,2.9-6.6,4.8-10.6,5.2c-6.2,0.6-12-1.9-15.8-6.9c-2.4-3.2-3.6-7.2-3.4-11.2c0-0.1,0-0.2,0-0.3c0.3-4.2,2-8.1,5-11.1l9.4-9.4 c2-2,4.4-3.6,7.1-4.5C26.8,42.6,31.3,43,35.1,44.9L35.1,44.9z"></path><path fill="currentColor" stroke="currentColor" d="M99.2,69.3c0-0.2,0-0.2,0-0.4c0-0.2,0-0.2,0-0.4s0-0.2-0.2-0.4c0-0.2,0-0.2-0.2-0.4l0,0l-0.2-0.2l-0.2-0.2L79.2,53 c-0.6-0.4-1.3-0.6-1.9-0.2c-0.8,0.4-1.2,1-1.2,1.7V62c-8.1,0.4-14.6,3.1-19.2,8.1c-8.5,9-7.7,22.5-7.7,23.1c0,0.2,0,0.2,0,0.4 c0,0.2,0,0.2,0,0.4s0.2,0.2,0.2,0.4l0.2,0.2c0.2,0.2,0.2,0.2,0.4,0.2l0.2,0.2c0.2,0,0.4,0,0.6,0.2H51l0,0l0,0c0,0,0,0,0.2,0 s0.2,0,0.4,0s0.2,0,0.4-0.2c0.2,0,0.2-0.2,0.4-0.2s0.2-0.2,0.4-0.2c0,0,0.2-0.2,0.2-0.4c0-0.2,0.2-0.2,0.2-0.4s0-0.2,0-0.4 c0-0.2,0-0.2,0-0.4c0-0.8,0.6-16.6,23.1-17.5v7.3c0,0.8,0.4,1.3,1,1.7c0.6,0.4,1.3,0.2,1.9-0.2l19.2-14l0.2-0.2l0.2-0.2l0,0 c0-0.2,0.2-0.2,0.2-0.4L99.2,69.3L99.2,69.3z"></path></svg>',De='<svg viewBox="0 0 100 100" class="bullet-list" width="15" height="15"><path fill="currentColor" stroke="currentColor" d="M16.4,16.4c-3.5,0-6.4,2.9-6.4,6.4s2.9,6.4,6.4,6.4s6.4-2.9,6.4-6.4S19.9,16.4,16.4,16.4z M16.4,19.6 c1.8,0,3.2,1.4,3.2,3.2c0,1.8-1.4,3.2-3.2,3.2s-3.2-1.4-3.2-3.2C13.2,21,14.6,19.6,16.4,19.6z M29.2,21.2v3.2H90v-3.2H29.2z M16.4,43.6c-3.5,0-6.4,2.9-6.4,6.4s2.9,6.4,6.4,6.4s6.4-2.9,6.4-6.4S19.9,43.6,16.4,43.6z M16.4,46.8c1.8,0,3.2,1.4,3.2,3.2 s-1.4,3.2-3.2,3.2s-3.2-1.4-3.2-3.2S14.6,46.8,16.4,46.8z M29.2,48.4v3.2H90v-3.2H29.2z M16.4,70.8c-3.5,0-6.4,2.9-6.4,6.4 c0,3.5,2.9,6.4,6.4,6.4s6.4-2.9,6.4-6.4C22.8,73.7,19.9,70.8,16.4,70.8z M16.4,74c1.8,0,3.2,1.4,3.2,3.2c0,1.8-1.4,3.2-3.2,3.2 s-3.2-1.4-3.2-3.2C13.2,75.4,14.6,74,16.4,74z M29.2,75.6v3.2H90v-3.2H29.2z"></path></svg>',bs=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <path d="M4 22h14a2 2 0 0 0 2-2V7.5L14.5 2H6a2 2 0 0 0-2 2v3"></path>
  <polyline points="14 2 14 8 20 8"></polyline>
  <path d="M5 17a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"></path>
  <path d="m9 18-1.5-1.5"></path>
</svg>`,Ss=`<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
  <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon>
</svg>`,Es='<svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 20 20"><g fill="none"><path d="M10.32 2.013A4 4 0 0 0 6.162 7.13l-3.987 3.986a.6.6 0 0 0-.176.424V14.4a.6.6 0 0 0 .6.6h2.8a.6.6 0 0 0 .6-.6V13h1.9a.6.6 0 0 0 .6-.6v-1.693l.735-.735a5.51 5.51 0 0 1-.569-.846l-.99.991a.6.6 0 0 0-.176.424V12H5.6a.6.6 0 0 0-.6.6V14H3v-2.293l4.32-4.32l-.118-.303a3.001 3.001 0 0 1 1.96-3.965c.33-.423.72-.796 1.157-1.106zM13.5 6.25a.75.75 0 1 0 0-1.5a.75.75 0 0 0 0 1.5zM9 6.5a4.5 4.5 0 1 1 7 3.742v2.05l.783.784a.6.6 0 0 1 0 .848L15.707 15l1.068 1.067a.6.6 0 0 1-.05.893l-2.35 1.88a.6.6 0 0 1-.75 0l-2.4-1.92a.6.6 0 0 1-.225-.468v-6.21A4.496 4.496 0 0 1 9 6.5zM13.5 3a3.5 3.5 0 0 0-1.75 6.532a.5.5 0 0 1 .25.433v6.295l2 1.6l1.751-1.401l-1.034-1.035a.6.6 0 0 1 0-.848l1.076-1.076l-.617-.617a.6.6 0 0 1-.176-.424V9.965a.5.5 0 0 1 .25-.433A3.5 3.5 0 0 0 13.5 3z" fill="currentColor"></path></g></svg>',re='<svg xmlns="http://www.w3.org/2000/svg" width="17" height="17" viewBox="0 0 20 20"><g fill="none"><path d="M19 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14c1.1 0 2-.9 2-2V5a2 2 0 0 0-2-2zm0 16H5V7h14v12zm-5.5-6c0 .83-.67 1.5-1.5 1.5s-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5s1.5.67 1.5 1.5zM12 9c-2.73 0-5.06 1.66-6 4c.94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4zm0 6.5a2.5 2.5 0 0 1 0-5a2.5 2.5 0 0 1 0 5z" fill="currentColor"></path></g></svg>',Cs='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="16" viewBox="0 0 20 20"><g fill="none"><path d="M11 6H9V4h2v2zm4-2h-2v2h2V4zM9 14h2v-2H9v2zm10-4V8h-2v2h2zm0 4v-2h-2v2h2zm-6 0h2v-2h-2v2zm6-10h-2v2h2V4zm-6 4V6h-2v2h2zm-6 2V8h2V6H7V4H5v16h2v-8h2v-2H7zm8 2h2v-2h-2v2zm-4-2v2h2v-2h-2zM9 8v2h2V8H9zm4 2h2V8h-2v2zm2-4v2h2V6h-2z" fill="currentColor"></path></g></svg>';function K(n){var t,s,r;(t=activeWindow.activeDocument.querySelector(".modal-bg"))==null||t.addClass("another-quick-switcher__floating-modal-bg");let i=activeWindow.activeDocument.querySelector(".prompt");i==null||i.addClass("another-quick-switcher__floating-prompt");let e=n.getFileViewInActiveLeaf();if(e){let a=activeWindow.innerWidth,o=activeWindow.innerHeight,l=activeWindow.activeDocument.querySelector(".another-quick-switcher__floating-prompt");if(!l){console.error("Unexpected error.");return}let c=(s=e.getState)==null?void 0:s.call(e),u=(c==null?void 0:c.mode)==="preview"?".markdown-preview-sizer":".cm-sizer",g=(r=e.contentEl.querySelector(u))!=null?r:e.contentEl,{width:m,height:p}=l.getBoundingClientRect(),{x:h,width:d}=g.getBoundingClientRect(),{y:f}=e.containerEl.getBoundingClientRect(),{y:v}=i.getBoundingClientRect(),y=h+d,w=a-y-30>m?y-30:h-m-30>0?h-m:a-m-30,k=Math.min(o-p-10,f+v);i==null||i.setAttribute("style",`left: ${w}px; top: ${k}px`)}}function Re(){return Math.ceil(Date.now()/1e3)}function xs(n,i=Date.now()){let e=Math.max(0,i-n),t=60*1e3,s=60*t,r=24*s,a=30*r,o=365*r;if(e<t)return{text:"1m",unit:"minute"};if(e<s){let c=Math.floor(e/t);return{text:`${Math.max(1,c)}m`,unit:"minute"}}if(e<r){let c=Math.floor(e/s);return{text:`${Math.max(1,c)}h`,unit:"hour"}}if(e<a){let c=Math.floor(e/r);return{text:`${Math.max(1,c)}d`,unit:"day"}}if(e<o){let c=Math.floor(e/a);return{text:`${Math.min(11,Math.max(1,c))}M`,unit:"month"}}let l=Math.floor(e/o);return{text:`${Math.max(1,l)}Y`,unit:"year"}}function he(n){return n!=null}function _s(n,i){let e=10**i;return Math.round(n*e)/e}function Ri(n){var e,t;if(n==null)return null;let i=Array.isArray(n)?n[0]:n;if(typeof i=="string"){let s=i.trim();if(!s)return null;let r=activeWindow.moment;if(typeof r=="function"){let o=r(s);if((e=o==null?void 0:o.isValid)!=null&&e.call(o)){let l=o.valueOf();if(Number.isFinite(l))return l}}let a=Date.parse(s);return Number.isNaN(a)?null:a}if(typeof i=="number"){let s=activeWindow.moment;if(typeof s=="function"){let r=s(i);if((t=r==null?void 0:r.isValid)!=null&&t.call(r)){let a=r.valueOf();if(Number.isFinite(a))return a}}}return null}function Bi(n){var e,t;if(n.isPhantom)return null;let i=null;switch(n.source){case"none":return null;case"modified":i=n.fileStat.mtime>0?n.fileStat.mtime:null;break;case"created":i=n.fileStat.ctime>0?n.fileStat.ctime:null;break;case"property":{let s=(e=n.propertyKey)==null?void 0:e.trim();if(!s)return null;i=Ri((t=n.frontMatter)==null?void 0:t[s]);break}default:throw new U(n.source)}return i==null?null:xs(i,n.nowMs)}function Oi(n){if(n.length===0)return[];let i=[...n].sort((s,r)=>s.start-r.start),e=[],t=i[0];for(let s=1;s<i.length;s++){let r=i[s];r.start<=t.end+1?t={start:t.start,end:Math.max(t.end,r.end)}:(e.push(t),t=r)}return e.push(t),e}function Be(n,i){let e=document.createDocumentFragment();if(!i||i.length===0)return e.appendChild(document.createTextNode(n)),e;let t=Oi(i),s=-1;for(let r of t){if(r.start>s+1){let o=n.slice(s+1,r.start);if(o){let l=createSpan({text:o});e.appendChild(l)}}let a=n.slice(r.start,r.end+1);if(a){let o=createSpan({cls:"another-quick-switcher__hit_word",text:a});e.appendChild(o)}s=r.end}if(s+1<n.length){let r=n.slice(s+1);if(r){let a=createSpan({text:r});e.appendChild(a)}}return e}function qi(n,i,e,t){var h,d;let s=createDiv({cls:["another-quick-switcher__item",t.selected?"another-quick-switcher__item__selected":"",n.phantom?"another-quick-switcher__phantom_item":"",n.starred?"another-quick-switcher__starred_item":"",t.hideGutterIcons?"another-quick-switcher__gutter_hidden":""].filter(f=>f),attr:{extension:n.file.extension}}),r=createDiv({cls:"another-quick-switcher__item__entry"}),a=createDiv({cls:["another-quick-switcher__item__title","another-quick-switcher__custom__item__title"]}),o=i.length>0&&(t.displayAliaseAsTitle||!e&&t.displayAliasAsTitleOnKeywordMatched),l=Bi({source:t.relativeUpdatedPeriodSource,propertyKey:t.relativeUpdatedPeriodPropertyKey,fileStat:n.file.stat,frontMatter:n.frontMatter,isPhantom:n.phantom}),c=null;l&&(c=createSpan({cls:["another-quick-switcher__item__relative-age",`another-quick-switcher__item__relative-age--${l.unit}`],text:l.text}));let u=o?i.join(" | "):n.file.basename,g=[];for(let f of n.matchResults)if(o){if(f.allAliasRanges)for(let v of i){let y=f.allAliasRanges.find(w=>w.alias===v);if(y){let w=i.slice(0,i.indexOf(v)).reduce((k,S)=>k+S.length+3,0);for(let k of y.ranges)g.push({start:k.start+w,end:k.end+w})}}}else f.ranges&&g.push(...f.ranges);o&&a.insertAdjacentHTML("beforeend",_t);let m=Be(u,g.length>0?g:void 0);a.appendChild(m),r.appendChild(a);let p=te(n.file);if(n.file.extension!=="md"||p){let f=createDiv({cls:"another-quick-switcher__item__extension",text:p?"excalidraw":n.file.extension});a.appendChild(f)}if(c&&a.appendChild(c),n.order<9){let f=createSpan({cls:"another-quick-switcher__item__hot-key-guide",text:`${n.order+1}`});r.appendChild(f)}if(t.showDirectory){let f=createDiv({cls:"another-quick-switcher__item__directory"});f.insertAdjacentHTML("beforeend",D);let v=t.showFullPathOfDirectory?(h=n.file.parent)==null?void 0:h.path:(d=n.file.parent)==null?void 0:d.name;if(f.appendText(` ${v}`),r.appendChild(f),t.showDirectoryAtNewLine)return s.appendChild(r),s.appendChild(f),s}return s.appendChild(r),s}function zi(n){var r,a,o;let{frontMatter:i,options:e,frontMatterRanges:t}=n,s=createDiv({cls:"another-quick-switcher__item__metas"});if(e.displayDescriptionBelowTitle&&i.description){let l=createDiv({cls:"another-quick-switcher__item__meta"}),c=createSpan({cls:"another-quick-switcher__item__meta__description"}),u=String(i.description),g=Be(u,(a=(r=t==null?void 0:t.description)==null?void 0:r.at(0))!=null?a:[]);c.appendChild(g),l.appendChild(c),s.appendChild(l)}if(e.showFuzzyMatchScore&&n.score>0){let l=createDiv({cls:"another-quick-switcher__item__meta"}),c=createSpan({cls:"another-quick-switcher__item__meta__score"});c.insertAdjacentHTML("beforeend",Cs),c.appendText(String(n.score)),l.appendChild(c),s.appendChild(l)}if(e.showFrontMatter&&Object.keys(i).length>0){let l=createDiv({cls:"another-quick-switcher__item__meta"});for(let[c,u]of Object.entries(i)){if(c==="description"&&e.displayDescriptionBelowTitle)continue;let g=createDiv({cls:"another-quick-switcher__item__meta__front_matter",title:`${c}: ${u}`});g.insertAdjacentHTML("beforeend",Es),g.createSpan({cls:"another-quick-switcher__item__meta__front_matter__key",title:c,text:c});let m=createDiv({cls:"another-quick-switcher__item__meta__front_matter__values"}),p=Array.isArray(u)?u:[u];for(let h=0;h<p.length;h++){let d=p[h];if(d==null)continue;let f=Be(d.toString(),(o=t==null?void 0:t[c])==null?void 0:o.at(h)),v=m.createSpan({cls:"another-quick-switcher__item__meta__front_matter__value"});v.appendChild(f),m.appendChild(v)}g.appendChild(m),l.appendChild(g)}s.appendChild(l)}return s}function Ki(n){let{item:i,aliases:e,tags:t,countByLink:s,countByHeader:r,linkResultsNum:a,headerResultsNum:o,isTitleMatched:l,options:c}=n,u=createDiv({cls:"another-quick-switcher__item__descriptions"}),g=!l&&c.displayAliasAsTitleOnKeywordMatched||c.displayAliaseAsTitle;if(e.length>0){let m=createDiv({cls:"another-quick-switcher__item__description"}),p=g?[i.file.basename]:e;for(let h of p){let d=createSpan({cls:"another-quick-switcher__item__description__alias"});d.insertAdjacentHTML("beforeend",g?ks:_t);let f=[];for(let w of i.matchResults)if(g){if(w.ranges)for(let k of w.ranges)f.push(k)}else if(w.allAliasRanges)for(let k of w.allAliasRanges)k.alias===h&&f.push(...k.ranges);let v=Be(h,f),y=createSpan({cls:"another-quick-switcher__item__description__alias__inner"});y.appendChild(v),d.appendChild(y),m.appendChild(d)}u.appendChild(m)}if(t.length>0){let m=createDiv({cls:"another-quick-switcher__item__description"});for(let p of t){let h=createSpan({cls:"another-quick-switcher__item__description__tag"});h.insertAdjacentHTML("beforeend",Me),h.appendText(p.replace("#","")),m.appendChild(h)}u.appendChild(m)}if(Object.keys(s).length>0){let m=createDiv({cls:"another-quick-switcher__item__description"}),p=Object.entries(s).map(([h,d])=>({link:h,n:d})).sort((h,d)=>d.n-h.n);for(let{link:h,n:d}of p){let f=createSpan({cls:["another-quick-switcher__item__description__link",d!==a?"another-quick-switcher__item__description__link__dimmed":""]});f.insertAdjacentHTML("beforeend",Le),f.appendChild(createSpan({text:h,attr:{style:"padding-left: 3px"}})),m.appendChild(f)}u.appendChild(m)}if(Object.keys(r).length>0){let m=createDiv({cls:"another-quick-switcher__item__description"}),p=Object.entries(r).map(([h,d])=>({header:h,n:d})).sort((h,d)=>d.n-h.n);for(let{header:h,n:d}of p){let f=createSpan({cls:["another-quick-switcher__item__description__header",d!==o?"another-quick-switcher__item__description__header__dimmed":""]});f.insertAdjacentHTML("beforeend",De),f.appendChild(createSpan({text:h,attr:{style:"padding-left: 3px"}})),m.appendChild(f)}u.appendChild(m)}return u}function Ps(n,i){var w;let{title:e,aliases:t}=Ie(n),s=!!e,r=i.displayAliaseAsTitle?n.aliases:t,a=qi(n,r,s,i),o=ae((w=n.frontMatter)!=null?w:{},(k,S)=>i.excludeFrontMatterKeys.includes(k)||S==null),l=_s(Math.max(...n.matchResults.map(k=>{var S;return(S=k.score)!=null?S:0})),6),c=n.matchResults.filter(k=>k.type==="property").map(k=>k.frontMatterRanges).filter(he).reduce((k,S)=>{var M,F,W;for(let[N,Z]of Object.entries(S)){(M=k[N])!=null||(k[N]=[]);for(let P=0;P<Z.length;P++){let L=Z[P];L!=null&&((W=(F=k[N])[P])!=null||(F[P]=[]),k[N][P].push(L))}}return k},{}),u=Object.keys(o).length>0||l>0?zi({frontMatter:o,frontMatterRanges:c,score:l,options:i}):void 0,g=xe(n.matchResults.filter(k=>k.type==="tag"),k=>{var S;return(S=k.meta)!=null?S:[]}),m=n.matchResults.filter(k=>k.type==="link"),p=m.length,h=ot(m.flatMap(k=>{var S;return $((S=k.meta)!=null?S:[])})),d=n.matchResults.filter(k=>k.type==="header"),f=d.length,v=ot(d.flatMap(k=>{var S;return $((S=k.meta)!=null?S:[])})),y=r.length!==0||g.length!==0||Object.keys(h).length!==0||Object.keys(v).length!==0?Ki({item:n,aliases:r,tags:g,countByLink:h,countByHeader:v,linkResultsNum:p,headerResultsNum:f,isTitleMatched:s,options:i}):void 0;return{itemDiv:a,metaDiv:u,descriptionDiv:y}}var ge={query:"",queryHistories:[]},Oe=class n extends I{constructor(e){var t,s,r,a,o,l,c,u;super(e.app);this.usedPreview=!1;this.skipRestoreOnClose=!1;this.skipRecentHistoryRestoreOnClose=!1;this.willSilentClose=!1;this.historyRestoreStatus="initial";this.isClosed=new Promise(e=>{this.markClosed=e});this.lastOpenFileIndexByPath={};this.modalEl.addClass("another-quick-switcher__modal-prompt"),this.appHelper=new C(e.app),this.settings=e.settings,this.logger=z.of(this.settings),this.initialCommand=e.command,this.command=e.command,this.autoPreviewEnabled=e.command.autoPreview,this.originFile=e.originFile,this.floating=e.command.floating,this.initialInputQuery=e.inputQuery,this.navigationHistories=e.navigationHistories,this.currentNavigationHistoryIndex=e.currentNavigationHistoryIndex,this.stackHistory=e.stackHistory,this.initialLeaf=e.initialLeaf,this.stateToRestore=e.initialState,this.historySnapshot=e.historySnapshot?(t=e.historySnapshot)!=null?t:null:this.appHelper.createLeafHistorySnapshot((s=this.initialLeaf)!=null?s:this.appHelper.getActiveFileLeaf()),this.recentHistorySnapshot=e.recentHistorySnapshot?(r=e.recentHistorySnapshot)!=null?r:null:this.appHelper.captureLastOpenFilesSnapshot(),this.recentHistoryBaseFilePath=e.recentHistoryBaseFilePath?(a=e.recentHistoryBaseFilePath)!=null?a:null:(l=(o=this.appHelper.getActiveFile())==null?void 0:o.path)!=null?l:null,this.navQueue=(c=e.navQueue)!=null?c:Promise.resolve(),this.selectedItemMap=(u=e.selectedItemMap)!=null?u:this.selectedItemMap,this.queryHistoryIndex=ge.queryHistories.length,this.queryHistoryBaseQuery=null,this.limit=this.settings.maxNumberOfSuggestions,this.lastOpenFileIndexByPath=this.appHelper.createRecentFilePathMap(),this.setHotkeys(),this.phantomItems=this.settings.showExistingFilesOnly?[]:this.appHelper.searchPhantomFiles().map(g=>({file:g,aliases:[],tags:[],headers:[],links:[],phantom:!0,starred:!1,matchResults:[],tokens:g.basename.split(" ")})),this.indexingItems(),this.debounceGetSuggestions=(0,A.debounce)((g,m)=>{m(this._getSuggestions(g))},this.settings.searchDelayMilliSeconds,!0)}toKey(e){return e.file.path}close(){A.Platform.isMobile&&this.onClose(),super.close()}safeClose(){return this.close(),this.isClosed}silentClose(){this.willSilentClose=!0,this.close()}onOpen(){var e,t;this.isOpen=!0,this.inputEl.value=this.command.restoreLastInput?(e=this.initialInputQuery)!=null?e:ge.query:(t=this.initialInputQuery)!=null?t:"",this.inputEl.select(),this.updateSuggestions(),this.resetQueryHistoryNavigationBase(),(this.command.floating||this.autoPreviewEnabled)&&this.enableFloating(),this.stackHistory&&this.navigationHistories.push({inputQuery:this.inputEl.value,command:{...this.command},originFile:this.originFile}),this.opened=!0,this.setupAutoPreviewListeners(),this.refreshAutoPreviewIcon(),this.requestAutoPreview()}onClose(){var s,r,a;let e=this.inputEl.value;if(super.onClose(),this.disableFloatingModalWheelScroll(),(s=this.debouncePreview)==null||s.cancel(),this.debouncePreviewCancelListener&&this.inputEl.removeEventListener("keydown",this.debouncePreviewCancelListener),this.willSilentClose)return;((a=(r=this.chooser.values)==null?void 0:r.length)!=null?a:0)>0?this.recordCurrentQueryToHistory(e):this.resetQueryHistoryNavigationBase(),this.command.restoreLastInput&&(ge.query=this.inputEl.value),this.stateToRestore&&!this.skipRestoreOnClose&&this.navigate(()=>this.stateToRestore.restore()),this.skipRestoreOnClose=!1,this.usedPreview&&!this.skipRecentHistoryRestoreOnClose&&this.navigate(()=>{this.scheduleRecentHistoryRestore(this.recentHistorySnapshot)}),this.skipRecentHistoryRestoreOnClose=!1,this.navigate(this.markClosed)}enableFloating(){this.floating=!0,A.Platform.isPhone||(K(this.appHelper),this.enableFloatingModalWheelScroll())}setupAutoPreviewListeners(){this.originalSetSelectedItem||(this.originalSetSelectedItem=this.chooser.setSelectedItem.bind(this.chooser),this.chooser.setSelectedItem=(e,t)=>{var s;(s=this.originalSetSelectedItem)==null||s.call(this,e,t),this.requestAutoPreview()}),this.debouncePreviewCancelListener||(this.debouncePreviewCancelListener=()=>{var e;(e=this.debouncePreview)==null||e.cancel()},this.inputEl.addEventListener("keydown",this.debouncePreviewCancelListener))}refreshAutoPreviewDebouncer(){var t,s;let e=`${this.autoPreviewEnabled}-${this.command.autoPreviewDelayMilliSeconds}`;if(!this.autoPreviewEnabled){(t=this.debouncePreview)==null||t.cancel(),this.debouncePreview=void 0,this.autoPreviewConfigKey=e;return}(this.autoPreviewConfigKey!==e||!this.debouncePreview)&&((s=this.debouncePreview)==null||s.cancel(),this.debouncePreview=(0,A.debounce)(()=>this.preview(),this.command.autoPreviewDelayMilliSeconds,!0),this.autoPreviewConfigKey=e)}refreshAutoPreviewIcon(){var e;(e=this.previewIcon)==null||e.remove(),this.previewIcon=null,this.autoPreviewEnabled&&this.searchCommandEl&&(this.previewIcon=createDiv({cls:"another-quick-switcher__status__auto-preview-icon"}),this.previewIcon.insertAdjacentHTML("beforeend",re),this.searchCommandEl.appendChild(this.previewIcon))}requestAutoPreview(){var e;this.refreshAutoPreviewDebouncer(),this.autoPreviewEnabled&&((e=this.debouncePreview)==null||e.call(this))}async preview(){let e=this.getSelectedItem();!e||e.phantom||(this.floating||this.enableFloating(),await this.chooseCurrentSuggestion("same-tab",{keepOpen:!0}))}indexingItems(){var l;let e=Ot(this.appHelper.getStarredFilePaths(),c=>c),t=(l=this.originFile)==null?void 0:l.path,s=this.command.relativeUpdatedPeriodPropertyKey.trim(),r=this.command.showFrontMatter||this.command.searchBy.property||this.command.sortPriorities.some(He)||this.command.relativeUpdatedPeriodSource==="property"&&s.length>0,a=performance.now(),o=this.app.vault.getFiles().filter(c=>(this.command.includeCurrentFile||c.path!==t)&&this.app.metadataCache.getFileCache(c)).map(c=>{var g,m,p,h,d,f;let u=this.app.metadataCache.getFileCache(c);return{file:c,aliases:(g=(0,A.parseFrontMatterAliases)(u.frontmatter))!=null?g:[],tags:this.command.searchBy.tag?$([...((m=u.tags)!=null?m:[]).map(v=>v.tag),...(p=(0,A.parseFrontMatterTags)(u.frontmatter))!=null?p:[]]):[],headers:this.command.searchBy.header?((h=u.headings)!=null?h:[]).map(v=>ce(v.heading)):[],links:this.command.searchBy.link?$([...(d=u.links)!=null?d:[],...(f=u.frontmatterLinks)!=null?f:[]].map(v=>{var y;return(y=v.displayText)!=null?y:""})):[],frontMatter:r&&u.frontmatter?ae(u.frontmatter,(v,y)=>v==="position"):void 0,phantom:!1,starred:c.path in e,matchResults:[],tokens:c.basename.split(" ")}});this.logger.showDebugLog("Indexing file items: ",a),this.originItems=[...o,...this.phantomItems],a=performance.now(),this.ignoredItems=this.prefilterItems(this.command),this.logger.showDebugLog("Prefilter items: ",a)}prefilterItems(e){return((s,r)=>{let a=this.originItems;switch(e.targetExtensions.length>0&&(a=a.filter(o=>e.targetExtensions.includes(o.file.extension))),e.searchTarget){case"file":break;case"opened file":{let o=this.appHelper.getFilePathsInActiveWindow();a=a.filter(l=>o.includes(l.file.path));break}case"backlink":{let o=this.appHelper.createBacklinksMap();a=a.filter(l=>{var c,u,g;return(g=o[(u=(c=this.originFile)==null?void 0:c.path)!=null?u:""])==null?void 0:g.has(l.file.path)});break}case"link":{let o=this.originFile?this.appHelper.createLinksMap(this.originFile):{};a=a.filter(l=>o[l.file.path]).sort(H(l=>{let c=o[l.file.path];return ie(c)?-1:c.position.start.offset}));break}case"2-hop-link":{let o=this.appHelper.createBacklinksMap(),l=this.originFile?this.appHelper.createLinksMap(this.originFile):{},c=a.filter(m=>l[m.file.path]).map(m=>m.file.path),u=c.flatMap(m=>Array.from(o[m])),g=$([...c,...u]);a=a.filter(m=>g.includes(m.file.path)).sort(H(m=>{let p=l[m.file.path];return!p||ie(p)?65535:p.position.start.offset}));break}}return s.length>0&&(a=zt(a,s,o=>o.file.path)),r.length>0&&(a=_e(a,r,o=>o.file.path)),a})(e.includePrefixPathPatterns.map(s=>s.replace(/<current_dir>/g,this.appHelper.getCurrentDirPath())),e.excludePrefixPathPatterns.map(s=>s.replace(/<current_dir>/g,this.appHelper.getCurrentDirPath())))}getSuggestions(e){return!e||e===this.command.defaultInput||!this.opened?this._getSuggestions(e):new Promise(t=>{this.debounceGetSuggestions(e,s=>{t(s)})})}_getSuggestions(e){var c,u;let t=performance.now(),s=this.settings.searchCommands.filter(g=>g.commandPrefix).find(g=>e.startsWith(g.commandPrefix));(s||this.initialCommand!==this.command)&&s!==this.command&&(this.command=s!=null?s:this.initialCommand,this.autoPreviewEnabled=this.command.autoPreview,this.indexingItems(),this.refreshAutoPreviewDebouncer(),this.refreshAutoPreviewIcon()),this.searchQuery=e.startsWith(this.command.commandPrefix)?e.replace(this.command.commandPrefix,""):e,this.command.defaultInput&&(this.searchQuery=`${this.command.defaultInput}${this.searchQuery}`),this.searchQuery=this.searchQuery.replace(/<cd>/g,this.appHelper.getCurrentDirPath()),this.renderInputComponent();let r=V(this.searchQuery);if(this.command.searchTarget==="backlink"&&!((c=this.originFile)!=null&&c.path))return[];let a=!this.searchQuery.trim(),o=a?this.ignoredItems:this.ignoredItems.map(g=>as(g,r,{isNormalizeAccentsDiacritics:this.settings.normalizeAccentsAndDiacritics,searchByHeaders:this.command.searchBy.header,searchByLinks:this.command.searchBy.link,searchByTags:this.command.searchBy.tag,keysOfPropertyToSearch:this.command.searchBy.property?this.command.keysOfPropertyToSearch:[],fuzzyTarget:this.command.allowFuzzySearchForSearchTarget,minFuzzyScore:this.command.minFuzzyMatchScore,excludePrefix:this.settings.searchesExcludePrefix})).filter(g=>g.matchResults.every(m=>m.type!=="not found")),l=ds(o,a?ps(this.command.sortPriorities):this.command.sortPriorities,this.lastOpenFileIndexByPath);return this.logger.showDebugLog(`Get suggestions: ${this.searchQuery} (${this.command.name})`,t),(u=this.countWrapperEl)==null||u.remove(),this.countWrapperEl=createDiv({cls:"another-quick-switcher__status__count-wrapper"}),this.countInputEl=createDiv({text:`${Math.min(l.length,this.limit)} / ${l.length}`,cls:"another-quick-switcher__status__count-input"}),this.countWrapperEl.appendChild(this.countInputEl),this.inputEl.before(this.countWrapperEl),this.renderCheckedCountBadge("another-quick-switcher__status__checked-count-badge",this.countWrapperEl),l.slice(0,this.limit).map((g,m)=>({...g,order:m}))}renderInputComponent(){var r,a,o,l,c;(r=this.navigationHistoryEl)==null||r.remove(),(a=this.searchCommandEl)==null||a.remove(),(o=this.defaultInputEl)==null||o.remove(),(l=this.countWrapperEl)==null||l.remove(),(c=this.countInputEl)==null||c.remove(),this.navigationHistoryEl=createDiv({cls:"another-quick-switcher__custom-search__navigation-history-header"});let e=this.currentNavigationHistoryIndex;e>0&&this.navigationHistoryEl.appendText(`${e} < `),this.navigationHistoryEl.appendText(this.originFile?this.originFile.basename:"No file");let t=this.navigationHistories.length-this.currentNavigationHistoryIndex-1;t>0&&this.navigationHistoryEl.appendText(` > ${t}`),this.inputEl.before(this.navigationHistoryEl),this.searchCommandEl=createDiv({cls:"another-quick-switcher__status__search-command"}),this.searchCommandEl.insertAdjacentHTML("beforeend",bs),this.searchCommandEl.createSpan({text:this.command.name,cls:"another-quick-switcher__status__search-command-name"}),this.searchCommandEl.createSpan({cls:"another-quick-switcher__status__search-command-separator"}),this.command.searchBy.tag&&this.searchCommandEl.insertAdjacentHTML("beforeend",Me),this.command.searchBy.header&&this.searchCommandEl.insertAdjacentHTML("beforeend",De),this.command.searchBy.link&&this.searchCommandEl.insertAdjacentHTML("beforeend",Le),this.refreshAutoPreviewIcon();let s=this.modalEl.find(".prompt-input-container");s&&s.setAttr("style","display: initial"),this.inputEl.before(this.searchCommandEl),this.command.defaultInput&&(this.defaultInputEl=createDiv({text:this.searchQuery,cls:"another-quick-switcher__status__default-input"}),this.defaultInputEl.insertAdjacentHTML("afterbegin",Ss),this.resultContainerEl.before(this.defaultInputEl))}renderSuggestion(e,t){let{itemDiv:s,metaDiv:r,descriptionDiv:a}=Ps(e,{showFrontMatter:this.command.showFrontMatter,excludeFrontMatterKeys:this.command.excludeFrontMatterKeys,showDirectory:this.settings.showDirectory,showDirectoryAtNewLine:this.settings.showDirectoryAtNewLine,showFullPathOfDirectory:this.settings.showFullPathOfDirectory,displayAliasAsTitleOnKeywordMatched:this.settings.showAliasesOnTop,displayAliaseAsTitle:this.settings.displayAliaseAsTitle,displayDescriptionBelowTitle:this.settings.displayDescriptionBelowTitle,hideGutterIcons:this.settings.hideGutterIcons,showFuzzyMatchScore:this.settings.showFuzzyMatchScore,relativeUpdatedPeriodSource:this.command.relativeUpdatedPeriodSource,relativeUpdatedPeriodPropertyKey:this.command.relativeUpdatedPeriodPropertyKey,selected:!!this.selectedItemMap[this.toKey(e)]});r!=null&&r.hasChildNodes()&&s.appendChild(r),a!=null&&a.hasChildNodes()&&s.appendChild(a),t.appendChild(s)}onNoSuggestion(){super.onNoSuggestion();let e=createDiv({cls:"another-quick-switcher__command_buttons"}),t=createEl("button",{text:"Create",cls:"another-quick-switcher__command_button"});t.addEventListener("click",()=>this.handleCreateNewMarkdown(this.searchQuery,"same-tab")),e.appendChild(t);let s=createEl("button",{text:"Search in google",cls:"another-quick-switcher__command_button"});s.addEventListener("click",()=>{activeWindow.open(`https://www.google.com/search?q=${this.searchQuery}`),this.close()}),e.appendChild(s),this.resultContainerEl.appendChild(e)}navigate(e){this.navQueue=this.navQueue.then(e)}async chooseCurrentSuggestion(e,t={}){var g,m,p,h,d;let s=this.getSelectedItem();if(!s)return null;let r=s.file;s.phantom&&(r=await this.app.vault.create(s.file.path,""));let a,o;switch(this.command.searchTarget){case"file":if(((g=s.matchResults[0])==null?void 0:g.type)==="header"){let f=s.matchResults[0].meta[0];a=(m=this.appHelper.findFirstHeaderOffset(s.file,f))!=null?m:void 0}break;case"opened file":if(((p=s.matchResults[0])==null?void 0:p.type)==="header"){let f=s.matchResults[0].meta[0];a=(h=this.appHelper.findFirstHeaderOffset(s.file,f))!=null?h:void 0}this.appHelper.getFilePathsInActiveWindow,o=this.appHelper.findLeaf(r);break;case"backlink":a=this.appHelper.findFirstLinkOffset(s.file,this.originFile);break;case"link":break;case"2-hop-link":break;default:throw new U(this.command.searchTarget)}let l=e==="same-tab",c=!t.keepOpen;c&&this.usedPreview&&(this.skipRecentHistoryRestoreOnClose=!0,l&&(this.skipRestoreOnClose=!0)),c?(this.close(),this.navigate(()=>this.isClosed)):l&&((d=this.stateToRestore)!=null||(this.stateToRestore=this.appHelper.captureState(this.initialLeaf)),this.usedPreview=!0);let u=t.keepOpen===!0;return this.navigate(async()=>{try{await this.appHelper.openFile(r,{leafType:e,offset:a,inplace:t.keepOpen,preventDuplicateTabs:this.settings.preventDuplicateTabs,leafPriorToSameTab:o},this.stateToRestore)}finally{if(u)this.scheduleRecentHistoryRestore(this.recentHistorySnapshot);else if(c&&this.usedPreview){let f=this.buildRecentHistoryForFinalOpen(this.recentHistorySnapshot,this.recentHistoryBaseFilePath,r.path);this.scheduleRecentHistoryRestore(f)}}}),c&&l&&this.usedPreview&&this.navigate(()=>{var v,y;let f=(y=(v=this.stateToRestore)==null?void 0:v.leaf)!=null?y:this.initialLeaf;this.appHelper.restoreLeafHistorySnapshot(f!=null?f:null,this.historySnapshot)}),r}async onChooseSuggestion(e,t){await this.chooseCurrentSuggestion(ne(t))}async handleCreateNewMarkdown(e,t){if(!e)return!0;let s=await this.appHelper.createMarkdown(this.searchQuery);if(!s)return new A.Notice("This file already exists."),!0;let r=t==="same-tab";return this.usedPreview&&(this.skipRecentHistoryRestoreOnClose=!0),r&&this.usedPreview&&(this.skipRestoreOnClose=!0),this.close(),this.navigate(()=>this.isClosed),this.navigate(()=>this.appHelper.openFile(s,{leafType:t})),this.usedPreview&&this.navigate(()=>{let a=this.buildRecentHistoryForFinalOpen(this.recentHistorySnapshot,this.recentHistoryBaseFilePath,s.path);this.scheduleRecentHistoryRestore(a)}),r&&this.usedPreview&&this.navigate(()=>{var o,l;let a=(l=(o=this.stateToRestore)==null?void 0:o.leaf)!=null?l:this.initialLeaf;this.appHelper.restoreLeafHistorySnapshot(a!=null?a:null,this.historySnapshot)}),!1}registerKeys(e,t){var s;for(let r of(s=this.settings.hotkeys.main[e])!=null?s:[])this.scope.register(r.modifiers,q(O(r.key)),a=>{if(!a.isComposing)return a.preventDefault(),t(),!1})}async toFileToOpened(e){let t=e.file;return e.phantom&&(t=await this.app.vault.create(e.file.path,"")),t}resetQueryHistoryNavigationBase(){this.queryHistoryBaseQuery=this.inputEl.value,this.queryHistoryIndex=ge.queryHistories.length}recordCurrentQueryToHistory(e){let t=(e!=null?e:this.inputEl.value).trim();if(!t){this.resetQueryHistoryNavigationBase();return}let s=ge.queryHistories;s[s.length-1]!==t&&(s.push(t),s.length>50&&s.shift()),this.resetQueryHistoryNavigationBase()}navigateQueryHistory(e){var a;let t=ge.queryHistories;if(t.length===0)return;this.queryHistoryIndex===t.length?this.queryHistoryBaseQuery=this.inputEl.value:this.queryHistoryBaseQuery===null&&this.resetQueryHistoryNavigationBase();let s=e==="back"?-1:1,r=this.queryHistoryIndex+s;for(;r>=0&&r<=t.length;){let o=this.inputEl.value,l=r===t.length?(a=this.queryHistoryBaseQuery)!=null?a:"":t[r];if(l!==o){this.queryHistoryIndex=r,this.inputEl.value=l,this.inputEl.dispatchEvent(new Event("input"));return}r+=s}}setHotkeys(){this.scope.unregister(this.scope.keys.find(l=>l.key==="Enter")),this.scope.unregister(this.scope.keys.find(l=>l.key==="Escape")),this.scope.unregister(this.scope.keys.find(l=>l.key==="Home")),this.scope.unregister(this.scope.keys.find(l=>l.key==="End"));let e=G(this.settings.userAltInsteadOfModForQuickResultSelection);this.settings.hideHotkeyGuides||this.setInstructions([{command:"[\u2191]",purpose:"up"},{command:"[\u2193]",purpose:"down"},{command:`[${e} 1~9]`,purpose:"open Nth"},...x(this.settings.hotkeys.main)]),this.registerKeys("up",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"}))}),this.registerKeys("down",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"}))}),this.registerKeys("scroll preview up",()=>{this.scrollActiveLeafByPage("up")}),this.registerKeys("scroll preview down",()=>{this.scrollActiveLeafByPage("down")}),this.registerKeys("clear input",()=>{this.inputEl.value="",this.inputEl.dispatchEvent(new Event("input"))}),this.registerKeys("replace input",()=>{this.chooser.values&&(this.inputEl.value=this.chooser.values[this.chooser.selectedItem].file.basename,this.inputEl.dispatchEvent(new Event("input")))}),this.registerKeys("open",async()=>{let l=this.getCheckedItems();if(l.length>0){this.close();for(let c of l)this.appHelper.openFile(await this.toFileToOpened(c),{leafType:"new-tab",preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("same-tab")}),this.registerKeys("open in new tab",async()=>{let l=this.getCheckedItems();if(l.length>0){this.close();for(let c of l)this.appHelper.openFile(await this.toFileToOpened(c),{leafType:"new-tab",preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("new-tab")}),this.registerKeys("open in new pane (horizontal)",async()=>{let l=this.getCheckedItems();if(l.length>0){this.close();for(let c of l)this.appHelper.openFile(await this.toFileToOpened(c),{leafType:"new-pane-horizontal",preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("new-pane-horizontal")}),this.registerKeys("open in new pane (vertical)",async()=>{let l=this.getCheckedItems();if(l.length>0){this.close();for(let c of l)this.appHelper.openFile(await this.toFileToOpened(c),{leafType:"new-pane-vertical",preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("new-pane-vertical")}),this.registerKeys("open in new window",async()=>{await this.chooseCurrentSuggestion("new-window")}),this.registerKeys("open in popup",async()=>{await this.chooseCurrentSuggestion("popup")}),this.registerKeys("preview",()=>this.preview()),this.registerKeys("toggle auto preview",()=>{this.autoPreviewEnabled=!this.autoPreviewEnabled,this.refreshAutoPreviewDebouncer(),this.refreshAutoPreviewIcon(),this.autoPreviewEnabled&&(this.floating||this.enableFloating(),this.preview())}),this.registerKeys("create",async()=>{await this.handleCreateNewMarkdown(this.searchQuery,"same-tab")}),this.registerKeys("create in new tab",async()=>{await this.handleCreateNewMarkdown(this.searchQuery,"new-tab")}),this.registerKeys("create in new pane (horizontal)",async()=>{await this.handleCreateNewMarkdown(this.searchQuery,"new-pane-horizontal")}),this.registerKeys("create in new pane (vertical)",async()=>{await this.handleCreateNewMarkdown(this.searchQuery,"new-pane-vertical")}),this.registerKeys("create in new window",async()=>{await this.handleCreateNewMarkdown(this.searchQuery,"new-window")}),this.registerKeys("create in new popup",async()=>{await this.handleCreateNewMarkdown(this.searchQuery,"popup")}),this.registerKeys("check/uncheck",async()=>{await this.toggleCheckedItem()}),this.registerKeys("check/uncheck and next",async()=>{await this.toggleCheckedItem({moveNext:!0})}),this.registerKeys("check/uncheck all",()=>{this.toggleCheckAll()}),this.registerKeys("uncheck all",()=>{this.uncheckAll()}),this.registerKeys("open in default app",()=>{this.actionMultiItems(l=>{this.appHelper.openFileInDefaultApp(l.file)}),this.close()}),this.registerKeys("show in system explorer",()=>{this.actionMultiItems(l=>{this.appHelper.openInSystemExplorer(l.file)}),this.close()}),this.registerKeys("open in google",()=>{activeWindow.open(`https://www.google.com/search?q=${this.searchQuery}`),this.close()}),this.registerKeys("open first URL",async()=>{this.close(),await this.isClosed,this.actionMultiItems(async(l,c)=>{let u=await this.appHelper.findExternalLinkUrls(l.file);u.length>0?activeWindow.open(u[0]):this.appHelper.openFile(l.file,{leafType:c==="select"?"same-tab":"new-tab"})})});let t=(l,c)=>{let u=this.settings.searchesAutoAliasTransform,{title:g,aliases:m}=Ie(c);this.appHelper.insertLinkToActiveFileBy(l,{phantom:c.phantom,displayedString:this.settings.showAliasesOnTop?g!=null?g:m.at(0):void 0,aliasTranformer:u.enabled?{pattern:u.aliasPattern,format:u.aliasFormat}:void 0})},s=l=>{let c=this.settings.searchesAutoAliasTransform;this.appHelper.insertLinkToActiveFileBy(this.appHelper.createPhantomFile(l),{phantom:!0,aliasTranformer:c.enabled?{pattern:c.aliasPattern,format:c.aliasFormat}:void 0})};this.registerKeys("insert to editor",async()=>{let l=0;this.actionMultiItems(async(c,u)=>{switch(await this.safeClose(),u){case"select":this.appHelper.isActiveLeafCanvas()?this.appHelper.addFileToCanvas(c.file):t(c.file,c);break;case"check":if(this.appHelper.isActiveLeafCanvas()){let g=this.appHelper.addFileToCanvas(c.file,{x:l,y:0});l+=g.width+30}else t(c.file,c),this.appHelper.insertStringToActiveFile(`
`);break;default:throw new U(u)}},async()=>{s(this.searchQuery),await this.safeClose()})});let r=l=>{var g,m;let c=(m=(g=this.chooser.values)==null?void 0:g[this.chooser.selectedItem])==null?void 0:m.file;if(!c)return;this.silentClose(),new n({app:this.app,settings:this.settings,command:{...l,searchBy:this.command.searchBy,keysOfPropertyToSearch:this.command.keysOfPropertyToSearch,relativeUpdatedPeriodSource:this.command.relativeUpdatedPeriodSource,relativeUpdatedPeriodPropertyKey:this.command.relativeUpdatedPeriodPropertyKey,allowFuzzySearchForSearchTarget:this.command.allowFuzzySearchForSearchTarget,minFuzzyMatchScore:this.command.minFuzzyMatchScore,targetExtensions:this.command.targetExtensions,floating:this.floating,autoPreview:this.command.autoPreview,autoPreviewDelayMilliSeconds:this.command.autoPreviewDelayMilliSeconds,showFrontMatter:this.command.showFrontMatter,excludeFrontMatterKeys:this.command.excludeFrontMatterKeys,sortPriorities:this.command.sortPriorities,excludePrefixPathPatterns:this.command.excludePrefixPathPatterns,includePrefixPathPatterns:this.command.includePrefixPathPatterns},originFile:c,inputQuery:null,navigationHistories:[...this.navigationHistories.slice(0,this.currentNavigationHistoryIndex),{inputQuery:this.inputEl.value,command:{...this.command},originFile:this.originFile}],currentNavigationHistoryIndex:this.currentNavigationHistoryIndex+1,stackHistory:!0,initialLeaf:this.initialLeaf,initialState:this.stateToRestore,selectedItemMap:this.selectedItemMap,historySnapshot:this.historySnapshot,recentHistorySnapshot:this.recentHistorySnapshot,recentHistoryBaseFilePath:this.recentHistoryBaseFilePath,navQueue:this.navQueue}).open()};this.registerKeys("show links",()=>{r(gs())}),this.registerKeys("show backlinks",()=>{r(ms())}),this.registerKeys("show all results",()=>{this.limit=Number.MAX_SAFE_INTEGER,this.inputEl.dispatchEvent(new Event("input"))});let a=l=>{let c=this.navigationHistories[l];if(!c)return;this.silentClose(),new n({app:this.app,settings:this.settings,command:{...c.command,floating:this.floating},originFile:c.originFile,inputQuery:c.inputQuery,navigationHistories:this.navigationHistories,currentNavigationHistoryIndex:l,stackHistory:!1,initialState:this.stateToRestore,initialLeaf:this.initialLeaf,selectedItemMap:this.selectedItemMap,historySnapshot:this.historySnapshot,recentHistorySnapshot:this.recentHistorySnapshot,recentHistoryBaseFilePath:this.recentHistoryBaseFilePath,navQueue:this.navQueue}).open()};this.registerKeys("navigate back",()=>{a(this.currentNavigationHistoryIndex-1)}),this.registerKeys("navigate forward",()=>{a(this.currentNavigationHistoryIndex+1)}),this.registerKeys("previous search history",()=>{this.navigateQueryHistory("back")}),this.registerKeys("next search history",()=>{this.navigateQueryHistory("forward")}),this.registerKeys("close if opened",()=>{this.actionMultiItems(async(l,c)=>{this.appHelper.closeFile(l.file),c==="check"&&this.close()})});let o=this.settings.userAltInsteadOfModForQuickResultSelection?"Alt":"Mod";for(let l of[1,2,3,4,5,6,7,8,9])this.scope.register([o],String(l),c=>(this.chooser.setSelectedItem(l-1,c),this.chooseCurrentSuggestion("same-tab"),!1));this.registerKeys("launch grep",async()=>{let l=this.inputEl.value.trim();await this.safeClose(),await Pt(this.app,this.settings,l||void 0)}),this.registerKeys("copy file vault path",async()=>{var c;let l=(c=this.chooser.values)==null?void 0:c[this.chooser.selectedItem];if(l)try{await navigator.clipboard.writeText(l.file.path),new A.Notice("Vault path copied to clipboard")}catch(u){new A.Notice("Failed to copy vault path to clipboard")}}),this.registerKeys("copy absolute file path",async()=>{var c;let l=(c=this.chooser.values)==null?void 0:c[this.chooser.selectedItem];if(l)try{let u=this.appHelper.getNormalizeVaultRootPath();await navigator.clipboard.writeText(`${u}/${l.file.path}`),new A.Notice("Absolute file path copied to clipboard")}catch(u){new A.Notice("Failed to copy absolute file path to clipboard")}}),this.registerKeys("dismiss",async()=>{this.close()})}};var me=require("obsidian");var qe=class extends I{constructor(e,t,s){var r,a,o;super(e);this.usedPreview=!1;this.skipRestoreOnClose=!1;this.skipRecentHistoryRestoreOnClose=!1;this.lastOpenFileIndexByPath={};this.suggestions=[];this.isClosed=new Promise(e=>{this.markClosed=e});this.navQueue=Promise.resolve();this.modalEl.addClass("another-quick-switcher__modal-prompt"),this.vaultRootPath=j(this.app.vault.adapter.basePath),this.appHelper=new C(e),this.settings=t,this.logger=z.of(this.settings),this.initialLeaf=s,this.historySnapshot=this.appHelper.createLeafHistorySnapshot((r=this.initialLeaf)!=null?r:this.appHelper.getActiveFileLeaf()),this.recentHistorySnapshot=this.appHelper.captureLastOpenFilesSnapshot(),this.recentHistoryBaseFilePath=(o=(a=this.appHelper.getActiveFile())==null?void 0:a.path)!=null?o:null,this.originFileBaseName=this.appHelper.getActiveFile().basename,this.originFileBaseNameRegExp=new RegExp(Pe(this.originFileBaseName),"g"),this.limit=255,this.lastOpenFileIndexByPath=this.appHelper.createRecentFilePathMap(),this.setHotkeys(),this.debounceGetSuggestions=(0,me.debounce)((l,c)=>{c(this._getSuggestions(l))},this.settings.searchDelayMilliSeconds,!0)}toKey(e){return`${e.file.path}:${e.lineNumber}`}async init(){await this.indexingItems()}onOpen(){var e;if(super.onOpen(),me.Platform.isPhone||(K(this.appHelper),this.enableFloatingModalWheelScroll()),this.opened=!0,this.settings.autoPreviewInBacklinkSearch){this.debouncePreview=(0,me.debounce)(this.preview,this.settings.backlinkAutoPreviewDelayMilliSeconds,!0),this.debouncePreviewCancelListener=()=>{var s;(s=this.debouncePreview)==null||s.cancel()};let t=this.chooser.setSelectedItem.bind(this.chooser);this.chooser.setSelectedItem=(s,r)=>{var a;t(s,r),(a=this.debouncePreview)==null||a.call(this)},this.inputEl.addEventListener("keydown",this.debouncePreviewCancelListener),(e=this.debouncePreview)==null||e.call(this)}}close(){me.Platform.isMobile&&this.onClose(),super.close(),this.disableFloatingModalWheelScroll()}onClose(){var e;super.onClose(),(e=this.debouncePreview)==null||e.cancel(),this.inputEl.removeEventListener("keydown",this.debouncePreviewCancelListener),this.stateToRestore&&!this.skipRestoreOnClose&&this.navigate(()=>this.stateToRestore.restore()),this.skipRestoreOnClose=!1,this.usedPreview&&!this.skipRecentHistoryRestoreOnClose&&this.navigate(()=>{this.scheduleRecentHistoryRestore(this.recentHistorySnapshot)}),this.skipRecentHistoryRestoreOnClose=!1,this.navigate(this.markClosed)}async indexingItems(){let e=performance.now(),t=[],s=this.appHelper.getBacklinksByFilePathInActiveFile();if(s){for(let[r,a]of Object.entries(s)){let o=this.appHelper.getFileByPath(r);if(this.settings.backlinkExcludePrefixPathPatterns.some(c=>o.path.startsWith(c)))continue;let l=await this.app.vault.cachedRead(o);for(let c of a)t.push(ie(c)?{file:o,line:`<${c.key}: in properties>`,lineNumber:1,offset:0}:{file:o,line:l.split(`
`).at(c.position.start.line),lineNumber:c.position.start.line+1,offset:c.position.start.offset})}this.ignoredItems=Ce(t,r=>`${r.file.path}/${r.lineNumber}`),this.logger.showDebugLog("Indexing backlinks",e)}}getSuggestions(e){return!e||!this.opened?this._getSuggestions(e):new Promise(t=>{this.debounceGetSuggestions(e,s=>{t(s)})})}_getSuggestions(e){var o;let t=performance.now(),s=e.trim()==="",r=e.trim().split(" "),a=s?this.ignoredItems:this.ignoredItems.filter(l=>r.every(c=>E(l.file.path,c,this.settings.normalizeAccentsAndDiacritics)||E(l.line,c,this.settings.normalizeAccentsAndDiacritics)));return this.logger.showDebugLog(`Get suggestions: ${e}`,t),(o=this.countWrapperEl)==null||o.remove(),this.countWrapperEl=createDiv({cls:"another-quick-switcher__backlink__status__count-wrapper"}),this.countInputEl=createDiv({text:`${Math.min(a.length,this.limit)} / ${a.length}`,cls:"another-quick-switcher__backlink__status__count-input"}),this.countWrapperEl.appendChild(this.countInputEl),this.inputEl.before(this.countWrapperEl),this.renderCheckedCountBadge("another-quick-switcher__backlink__status__checked-count-badge",this.countWrapperEl),this.suggestions=a.sort((l,c)=>_(l,c,u=>{var g;return(g=this.lastOpenFileIndexByPath[u.file.path])!=null?g:999999},"asc")).slice(0,this.limit).map((l,c)=>({...l,order:c})),this.suggestions}renderSuggestion(e,t){var p,h,d;let r=((p=this.suggestions[e.order-1])==null?void 0:p.file.path)===e.file.path,a=createDiv({cls:["another-quick-switcher__item",this.selectedItemMap[this.toKey(e)]?"another-quick-switcher__item__selected":""].filter(f=>f)}),o=createDiv({cls:"another-quick-switcher__item__entry"});if(!r){let f=createDiv({cls:["another-quick-switcher__item__title","another-quick-switcher__backlink__item__title_entry"],text:e.file.basename,attr:{extension:e.file.extension}}),v=te(e.file);if(e.file.extension!=="md"||v){let y=createDiv({cls:"another-quick-switcher__item__extension",text:v?"excalidraw":e.file.extension});f.appendChild(y)}if(o.appendChild(f),a.appendChild(o),this.settings.showDirectory){let y=createDiv({cls:"another-quick-switcher__item__directory"});y.insertAdjacentHTML("beforeend",D);let w=this.settings.showFullPathOfDirectory?(h=e.file.parent)==null?void 0:h.path:(d=e.file.parent)==null?void 0:d.name;y.appendText(` ${w}`),o.appendChild(y),this.settings.showDirectoryAtNewLine&&a.appendChild(y)}}let l=createDiv({cls:"another-quick-switcher__item__descriptions"}),c=createDiv({cls:"another-quick-switcher__backlink__item__description"}),u=e.line,g=0,m=Array.from(u.matchAll(this.originFileBaseNameRegExp)).map(f=>f.index);for(let f of m){let v=u.slice(0,f-g);c.createSpan({text:Q(v,this.settings.maxDisplayLengthAroundMatchedWord)}),c.createSpan({text:this.originFileBaseName,cls:"another-quick-switcher__hit_word"}),g=f-g+this.originFileBaseName.length,u=u.slice(g)}if(c.createSpan({text:Q(u,this.settings.maxDisplayLengthAroundMatchedWord)}),e.order<9){let f=createSpan({cls:"another-quick-switcher__backlink__item__hot-key-guide",text:`${e.order+1}`});l.appendChild(f)}l.appendChild(c),a.appendChild(l),t.appendChild(a)}navigate(e){this.navQueue=this.navQueue.then(e)}async chooseCurrentSuggestion(e,t={}){var l;let s=this.getSelectedItem();if(!s)return null;let r=e==="same-tab",a=!t.keepOpen;a&&this.usedPreview&&(this.skipRecentHistoryRestoreOnClose=!0,r&&(this.skipRestoreOnClose=!0)),a?(this.close(),this.navigate(()=>this.isClosed)):r&&((l=this.stateToRestore)!=null||(this.stateToRestore=this.appHelper.captureState(this.initialLeaf)),this.usedPreview=!0);let o=t.keepOpen===!0;return this.navigate(async()=>{try{await this.appHelper.openFile(s.file,{leafType:e,line:s.lineNumber-1,inplace:t.keepOpen,preventDuplicateTabs:this.settings.preventDuplicateTabs},this.stateToRestore)}finally{if(o)this.scheduleRecentHistoryRestore(this.recentHistorySnapshot);else if(a&&this.usedPreview){let c=this.buildRecentHistoryForFinalOpen(this.recentHistorySnapshot,this.recentHistoryBaseFilePath,s.file.path);this.scheduleRecentHistoryRestore(c)}}}),a&&r&&this.usedPreview&&this.navigate(()=>{var u,g;let c=(g=(u=this.stateToRestore)==null?void 0:u.leaf)!=null?g:this.initialLeaf;this.appHelper.restoreLeafHistorySnapshot(c!=null?c:null,this.historySnapshot)}),s.file}async onChooseSuggestion(e,t){await this.chooseCurrentSuggestion(ne(t))}async preview(){await this.chooseCurrentSuggestion("same-tab",{keepOpen:!0})}registerKeys(e,t){let s=this.settings.hotkeys.backlink[e];for(let r of s)this.scope.register(r.modifiers,q(O(r.key)),a=>{if(!a.isComposing)return a.preventDefault(),t(),!1})}setHotkeys(){this.scope.unregister(this.scope.keys.find(s=>s.key==="Enter")),this.scope.unregister(this.scope.keys.find(s=>s.key==="Escape")),this.scope.unregister(this.scope.keys.find(s=>s.key==="Home")),this.scope.unregister(this.scope.keys.find(s=>s.key==="End"));let e=G(this.settings.userAltInsteadOfModForQuickResultSelection);this.settings.hideHotkeyGuides||this.setInstructions([{command:"[\u21B5]",purpose:"open"},{command:"[\u2191]",purpose:"up"},{command:"[\u2193]",purpose:"down"},{command:`[${e} 1~9]`,purpose:"open Nth"},...x(this.settings.hotkeys.backlink)]),this.registerKeys("up",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"}))}),this.registerKeys("down",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"}))}),this.registerKeys("scroll preview up",()=>{this.scrollActiveLeafByPage("up")}),this.registerKeys("scroll preview down",()=>{this.scrollActiveLeafByPage("down")}),this.registerKeys("open",async()=>{let s=this.getCheckedItems();if(s.length>0){this.close();for(let r of s.slice())await this.appHelper.openFile(r.file,{leafType:"new-tab",line:r.lineNumber-1,preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("same-tab")}),this.registerKeys("open in new tab",async()=>{let s=this.getCheckedItems();if(s.length>0){this.close();for(let r of s.slice())await this.appHelper.openFile(r.file,{leafType:"new-tab",line:r.lineNumber-1,preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("new-tab")}),this.registerKeys("open in new pane (horizontal)",async()=>{let s=this.getCheckedItems();if(s.length>0){this.close();for(let r of s.slice())await this.appHelper.openFile(r.file,{leafType:"new-pane-horizontal",line:r.lineNumber-1,preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("new-pane-horizontal")}),this.registerKeys("open in new pane (vertical)",async()=>{let s=this.getCheckedItems();if(s.length>0){this.close();for(let r of s.slice())await this.appHelper.openFile(r.file,{leafType:"new-pane-vertical",line:r.lineNumber-1,preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("new-pane-vertical")}),this.registerKeys("open in new window",async()=>{await this.chooseCurrentSuggestion("new-window")}),this.registerKeys("open in popup",async()=>{await this.chooseCurrentSuggestion("popup")}),this.registerKeys("check/uncheck",async()=>{await this.toggleCheckedItem()}),this.registerKeys("check/uncheck and next",async()=>{await this.toggleCheckedItem({moveNext:!0})}),this.registerKeys("check/uncheck all",()=>{this.toggleCheckAll()}),this.registerKeys("uncheck all",()=>{this.uncheckAll()}),this.registerKeys("show all results",()=>{this.limit=Number.MAX_SAFE_INTEGER,this.inputEl.dispatchEvent(new Event("input"))}),this.registerKeys("preview",()=>this.preview());let t=this.settings.userAltInsteadOfModForQuickResultSelection?"Alt":"Mod";for(let s of[1,2,3,4,5,6,7,8,9])this.scope.register([t],String(s),r=>(this.chooser.setSelectedItem(s-1,r),this.chooser.useSelectedItem({}),!1));this.registerKeys("dismiss",async()=>{this.close()})}};var Fs=require("obsidian");var ze=class extends I{constructor(e,t,s,r,a,o){super(e);this.commands=t;this.lastUsedMap=s;this.queryUsedMap=r;this.commandHistoryPath=a;this.settings=o;this.query="";this.app=e,this.setHotkeys()}toKey(e){return e.id}getSuggestions(e){let t=e.trim();return this.query=t,this.commands.map(s=>({command:t&&this.queryUsedMap[t]===s.id?{...s,topPriority:!0}:s,results:t.split(" ").filter(he).map(r=>mt(s.name.toLowerCase(),r.toLowerCase()))})).filter(({results:s})=>s.every(r=>r.type!=="none")).map(({command:s,results:r})=>({command:s,result:r.reduce(Nt(a=>a.score))})).filter(({result:s})=>s.type!=="none").filter(({result:s})=>!t||s.type!=="fuzzy"||s.score>.25).slice().sort(H(({result:s})=>s.score,"desc")).sort(H(({command:s})=>{var r;return(r=s.lastUsed)!=null?r:0},"desc")).sort(H(({result:s})=>s.type==="includes"||s.type==="starts-with","desc")).sort(H(({command:s})=>s.lastUsed!=null,"desc")).sort(H(({command:s})=>{var r;return(r=s.topPriority)!=null?r:!1},"desc")).map(({command:s})=>s)}renderSuggestion(e,t){let s=createDiv({cls:["another-quick-switcher__command-palette__item",e.lastUsed?"another-quick-switcher__command-palette__item-lastused":"",e.topPriority?"another-quick-switcher__command-palette__item-top-priority":""]});s.appendChild(createDiv({text:e.name}));let r=this.app.hotkeyManager.getHotkeys(e.id);if(r){let a=createDiv({cls:["another-quick-switcher__command-palette__item__keys"]});for(let o of r)a.appendChild(createEl("kbd",{text:Fe(o),cls:["another-quick-switcher__command-palette__item__key"]}));s.appendChild(a)}t.appendChild(s)}async onChooseSuggestion(e){var t,s,r;(r=(t=e.callback)==null?void 0:t.call(e))!=null||(s=e.checkCallback)==null||s.call(e,!1),this.lastUsedMap[e.id]=Re(),this.queryUsedMap[this.query]=e.id,await ss(this.commandHistoryPath,{lastUsedMap:this.lastUsedMap,queryUsedMap:this.queryUsedMap},{overwrite:!0})}registerKeys(e,t){var s;for(let r of(s=this.settings.hotkeys.command[e])!=null?s:[])this.scope.register(r.modifiers,r.key.toUpperCase(),a=>(a.preventDefault(),t(),!1))}setHotkeys(){this.scope.unregister(this.scope.keys.find(e=>e.key==="Escape")),this.scope.unregister(this.scope.keys.find(e=>e.key==="Home")),this.scope.unregister(this.scope.keys.find(e=>e.key==="End")),this.settings.hideHotkeyGuides||this.setInstructions([{command:"[\u21B5]",purpose:"run"},{command:"[\u2191]",purpose:"up"},{command:"[\u2193]",purpose:"down"},...x(this.settings.hotkeys.move)]),this.registerKeys("up",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"}))}),this.registerKeys("down",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"}))}),this.registerKeys("copy command id",async()=>{let e=this.getSelectedItem();e&&(await navigator.clipboard.writeText(e.id),new Fs.Notice(`Copied command ID to clipboard: ${e.id}`),this.close())}),this.registerKeys("dismiss",async()=>{this.close()})}};var Ne=require("obsidian");function Ni(n,i,e,t){let s=i.split("/"),r=s.pop();return s.every(a=>n.folder.parent&&E(n.folder.parent.path,a,t))&&e(n,r)}function Ft(n,i,e,t){return i.every(s=>Ni(n,s,e,t))}function Ui(n,i,e){return Ft(n,i,(t,s)=>jt(t.folder.name,s,e),e)?{...n,matchType:"prefix-name"}:Ft(n,i,(t,s)=>E(t.folder.name,s,e),e)?{...n,matchType:"name"}:Ft(n,i,(t,s)=>E(t.folder.path,s,e),e)?{...n,matchType:"directory"}:n}var Ke=class extends Ne.SuggestModal{constructor(i,e){super(i),this.modalEl.addClass("another-quick-switcher__modal-prompt"),this.appHelper=new C(i),this.settings=e,this.setHotkeys(),this.originItems=this.appHelper.getFolders().filter(t=>!t.isRoot()).map(t=>({folder:t})),this.filteredItems=this.originItems}getSuggestions(i){let e=i.split(" ").filter(t=>t);return this.filteredItems.map(t=>Ui(t,e,this.settings.normalizeAccentsAndDiacritics)).filter(t=>t.matchType).sort(H(t=>t.matchType==="directory"?1:0)).sort(H(t=>t.matchType==="prefix-name"?1e3-t.folder.name.length:0,"desc")).slice(0,10)}renderSuggestion(i,e){var o;let t=createDiv({cls:["another-quick-switcher__item","another-quick-switcher__directory_item"]}),s=createDiv({cls:"another-quick-switcher__item__entry"}),r=createDiv({cls:"another-quick-switcher__item__title",text:i.folder.name});s.appendChild(r);let a=createDiv({cls:"another-quick-switcher__item__directory"});a.insertAdjacentHTML("beforeend",D),a.appendText(` ${(o=i.folder.parent)==null?void 0:o.name}`),s.appendChild(a),t.appendChild(s),e.appendChild(t)}async onChooseSuggestion(i){if(!this.appHelper.enableFileExplorer()){new Ne.Notice("File explorer (core plugin) is not enabled.");return}this.appHelper.revealInFolder(i.folder)}registerKeys(i,e){var t;for(let s of(t=this.settings.hotkeys.folder[i])!=null?t:[])this.scope.register(s.modifiers,s.key.toUpperCase(),r=>(r.preventDefault(),e(),!1))}setHotkeys(){this.scope.unregister(this.scope.keys.find(i=>i.key==="Escape")),this.scope.unregister(this.scope.keys.find(i=>i.key==="Home")),this.scope.unregister(this.scope.keys.find(i=>i.key==="End")),this.settings.hideHotkeyGuides||this.setInstructions([{command:"[\u21B5]",purpose:"reveal in file tree"},{command:"[\u2191]",purpose:"up"},{command:"[\u2193]",purpose:"down"},...x(this.settings.hotkeys.folder)]),this.registerKeys("up",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"}))}),this.registerKeys("down",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"}))}),this.registerKeys("open in default app",()=>{var e,t;let i=(t=(e=this.chooser.values)==null?void 0:e[this.chooser.selectedItem])==null?void 0:t.folder;i&&(this.appHelper.openFolderInDefaultApp(i),this.close())}),this.registerKeys("dismiss",async()=>{this.close()})}};var Qe=require("obsidian");function Is(n,i){let e=Buffer.from(n,"utf8");if(i>=e.length)return n.length;let t=[...n],s=0,r=0;for(let a=0;a<t.length;a++){let o=t[a],l=Buffer.from(o,"utf8").length;if(s+l>i||(s+=l,r+=o.length,s>=i))break}return r}function As(n,i){return n.map(e=>({...e,start:Is(i,e.start),end:Is(i,e.end)}))}function Ue(n,i){if(n.length<=1)return n;let e=[...n].filter(s=>i?s.start>=0&&s.end<=i.length&&s.start<s.end:!0).sort((s,r)=>s.start-r.start);if(e.length===0)return[];let t=[];for(let s of e)t.some(a=>a.start===s.start&&a.end===s.end)||t.push(s);return t}function Hs(n){if(n.length===0)return[];if(n.length===1)return n[0];let i=new Map;for(let t=0;t<n.length;t++){let s=n[t];for(let r of s){let a=`${r.data.path.text}:${r.data.line_number}`;i.has(a)||i.set(a,[]),i.get(a).push(r)}}let e=[];for(let[t,s]of i)if(s.length===n.length){let r=s[0],a=s.flatMap(o=>o.data.submatches);e.push({...r,data:{...r.data,submatches:a}})}return e}var Ve=require("child_process");async function Ts(n){return new Promise((i,e)=>{(0,Ve.execFile)(n,["--version"],(t,s,r)=>{t&&console.dir(t),i(!t)})})}async function It(n,...i){return new Promise((e,t)=>{(0,Ve.execFile)(n,["--json",...i],{maxBuffer:1024*1024*1024},(s,r,a)=>{if(s){if(s.message.includes("regex parse error")){e({type:"error",errorType:"regex_parse_error",message:s.message});return}if(r){let l=JSON.parse(r);if(l.type==="summary"&&l.data.stats.matches===0){e([]);return}}console.error("ripgrep error:",s),e([]);return}let o=r.split(`
`).filter(l=>l).map(l=>{try{return JSON.parse(l)}catch(c){return console.warn("JSON parse error for line:",l),null}}).filter(l=>l!==null&&l.type==="match");e(o)})})}async function Ms(n,i,e,t){return new Promise((s,r)=>{let a=["--files","--follow",...t.flatMap(o=>["-t",o]),e].filter(o=>o);(0,Ve.execFile)(n,a,{maxBuffer:1024*1024*1024},(o,l,c)=>{if(o){if(o.message.includes("No such file or directory")){s([]);return}if(l){let g=JSON.parse(l);if(g.type==="summary"&&g.data.stats.matches===0){s([]);return}}console.error("ripgrep files error:",o),s([]);return}let u=l.split(`
`).filter(g=>g);for(let g of i)g.trim()&&(u=u.filter(m=>(m.split("/").pop()||"").toLowerCase().includes(g.toLowerCase())));s(u)})})}var Y={items:[],basePath:void 0,selected:void 0,queryHistories:[]},We=class extends I{constructor(e,t,s,r){var o,l,c;super(e);this.usedPreview=!1;this.skipRestoreOnClose=!1;this.skipRecentHistoryRestoreOnClose=!1;this.isClosed=new Promise(e=>{this.markClosed=e});this.navQueue=Promise.resolve();this.modalEl.addClass("another-quick-switcher__modal-prompt"),this.suggestions=Y.items,this.vaultRootPath=j(this.app.vault.adapter.basePath),this.appHelper=new C(e),this.settings=t,this.logger=z.of(this.settings),this.initialLeaf=s,this.historySnapshot=this.appHelper.createLeafHistorySnapshot((o=this.initialLeaf)!=null?o:this.appHelper.getActiveFileLeaf()),this.recentHistorySnapshot=this.appHelper.captureLastOpenFilesSnapshot(),this.recentHistoryBaseFilePath=(c=(l=this.appHelper.getActiveFile())==null?void 0:l.path)!=null?c:null,this.limit=255,this.queryHistoryIndex=Y.queryHistories.length,this.queryHistoryBaseQuery=null;let a=this.settings.hotkeys.grep.search.at(0);if(a){let u=yt("_",{key:a.key,modifiers:a.modifiers});this.setPlaceholder(`Search around the vault by ${u==null?void 0:u.command} key`)}else this.setPlaceholder('Please set a key about "search" in the "Grep dialog" setting');this.setHotkeys(),this.initialQuery=r}toKey(e){return`${e.file.path}:${e.lineNumber}`}onOpen(){var e;super.onOpen(),K(this.appHelper),this.enableFloatingModalWheelScroll(),this.basePath=(e=Y.basePath)!=null?e:this.settings.defaultGrepFolder,this.initialQuery&&(this.clonedInputEl.value=this.initialQuery,this.currentQuery=this.initialQuery,this.inputEl.value=this.initialQuery,this.inputEl.dispatchEvent(new Event("input"))),this.resetQueryHistoryNavigationBase(),window.setTimeout(()=>{var l;this.basePathInputEl=createEl("input",{value:this.basePath,placeholder:"path from vault root (./ means current directory. ../ means parent directory)",cls:"another-quick-switcher__grep__path-input",type:"text"}),this.basePathInputEl.setAttrs({autocomplete:"on",list:"directories"});let t=createEl("datalist");t.setAttrs({id:"directories"});let s=this.appHelper.getFolders().filter(c=>!c.isRoot());for(let c of s)t.appendChild(createEl("option",{value:c.path}));this.basePathInputElChangeEventListener=c=>{this.basePath=c.target.value},this.basePathInputElKeydownEventListener=c=>{if(!c.key){c.preventDefault();return}let u=this.settings.hotkeys.grep.search[0];if(!u)return;wt(u,c)&&(c.preventDefault(),this.basePath=c.target.value,this.triggerSearch())},this.basePathInputEl.addEventListener("change",this.basePathInputElChangeEventListener),this.basePathInputEl.addEventListener("keydown",this.basePathInputElKeydownEventListener);let r=createDiv({cls:"another-quick-switcher__grep__path-input__wrapper"});r.appendChild(this.basePathInputEl),r.appendChild(t);let a=activeWindow.activeDocument.querySelector(".prompt-input-container");if(a==null||a.after(r),r.insertAdjacentHTML("afterbegin",D),this.settings.autoPreviewInGrepSearch){this.debouncePreview=(0,Qe.debounce)(this.preview,this.settings.grepAutoPreviewDelayMilliSeconds,!0),this.debouncePreviewCancelListener=()=>{var u;(u=this.debouncePreview)==null||u.cancel()},this.debouncePreviewSearchCancelListener=()=>{var u;(u=this.debouncePreview)==null||u.cancel(),this.debounceInputEvent.cancel()};let c=this.chooser.setSelectedItem.bind(this.chooser);this.chooser.setSelectedItem=(u,g)=>{var m;c(u,g),(m=this.debouncePreview)==null||m.call(this)},this.clonedInputEl.addEventListener("keydown",this.debouncePreviewCancelListener),this.clonedInputEl.addEventListener("focusout",this.debouncePreviewSearchCancelListener),this.basePathInputEl.addEventListener("keydown",this.debouncePreviewCancelListener),this.basePathInputEl.addEventListener("focusout",this.debouncePreviewSearchCancelListener)}let o=Y.selected;o!=null&&(this.chooser.setSelectedItem(o),(l=this.chooser.suggestions.at(o))==null||l.scrollIntoView({behavior:"auto",block:"center",inline:"center"}))},0)}onClose(){var s,r,a,o;let e=(s=this.clonedInputEl)==null?void 0:s.value;super.onClose(),this.disableFloatingModalWheelScroll(),(r=this.debouncePreview)==null||r.cancel(),((o=(a=this.suggestions)==null?void 0:a.length)!=null?o:0)>0?this.recordCurrentQueryToHistory(e):this.resetQueryHistoryNavigationBase(),Y.items=this.suggestions,Y.basePath=this.basePath,Y.selected=this.chooser.selectedItem,this.clonedInputEl.removeEventListener("keydown",this.clonedInputElKeydownEventListener),this.clonedInputEl.removeEventListener("input",this.clonedInputElInputEventListener),this.clonedInputEl.removeEventListener("keydown",this.debouncePreviewCancelListener),this.clonedInputEl.removeEventListener("focusout",this.debouncePreviewSearchCancelListener),this.basePathInputEl.removeEventListener("change",this.basePathInputElChangeEventListener),this.basePathInputEl.removeEventListener("keydown",this.basePathInputElKeydownEventListener),this.basePathInputEl.removeEventListener("keydown",this.debouncePreviewCancelListener),this.basePathInputEl.removeEventListener("focusout",this.debouncePreviewSearchCancelListener),this.stateToRestore&&!this.skipRestoreOnClose&&this.navigate(()=>this.stateToRestore.restore()),this.skipRestoreOnClose=!1,this.usedPreview&&!this.skipRecentHistoryRestoreOnClose&&this.navigate(()=>{this.scheduleRecentHistoryRestore(this.recentHistorySnapshot)}),this.skipRecentHistoryRestoreOnClose=!1,this.navigate(this.markClosed)}async searchSuggestions(e){let t=performance.now(),s=Vt(this.basePath,this.appHelper.getCurrentDirPath()),r=V(e.trim()),a;for(let u of r)if(!ft(u))return this.renderCountStatus(`Invalid regex pattern: ${u}`,{error:!0}),[];if(this.renderCountStatus("searching..."),r.length>1){let u=[];for(let g of r){let m=await It(this.settings.ripgrepCommand,...[...this.settings.grepExtensions.flatMap(p=>["-t",p]),ve(g)?"":"-i","--follow","--",g,`${this.vaultRootPath}/${s}`].filter(p=>p));if(Array.isArray(m))u.push(m);else if(m.type==="error"&&m.errorType==="regex_parse_error")return this.renderCountStatus(`Invalid regex pattern: ${g}`,{error:!0}),[]}a=Hs(u)}else{let u=r[0],g=[...this.settings.grepExtensions.flatMap(p=>["-t",p]),ve(u)?"":"-i","--follow","--",u,`${this.vaultRootPath}/${s}`].filter(p=>p),m=await It(this.settings.ripgrepCommand,...g);if(Array.isArray(m))a=m;else{if(m.type==="error"&&m.errorType==="regex_parse_error")return this.renderCountStatus(`Invalid regex pattern: ${u}`,{error:!0}),[];a=[]}}let o=this.settings.includeFilenameInGrepSearch?await Ms(this.settings.ripgrepCommand,r,`${this.vaultRootPath}/${s}`,this.settings.grepExtensions).catch(u=>{if(u.includes("regex parse error"))return[];throw u}):[],l=a.map(u=>({order:-1,file:this.appHelper.getFileByPath(j(u.data.path.text).replace(`${this.vaultRootPath}/`,"")),line:u.data.lines.text,lineNumber:u.data.line_number,offset:u.data.absolute_offset,submatches:Ue(As(u.data.submatches,u.data.lines.text),u.data.lines.text).map(g=>({...g,type:"text"}))})).filter(u=>u.file!=null).sort(H(u=>u.file.stat.mtime,"desc")),c=o.map(u=>{let g=this.appHelper.getFileByPath(j(u).replace(`${this.vaultRootPath}/`,""));if(!g)return null;let m=[];for(let p of r){if(!p.trim())continue;let h=ve(p)?"g":"gi",d=Yt(g.basename,new RegExp(p,h));m.push(...d.map(f=>({text:f.text,start:f.range.start,end:f.range.end})))}return{order:-1,file:g,line:"",lineNumber:0,offset:0,submatches:Ue(m.map(p=>({match:{text:p.text},start:p.start,end:p.end})),g.basename).map(p=>({...p,type:"title"}))}}).filter(u=>u!=null).sort(H(u=>u.file.stat.mtime,"desc"));return this.logger.showDebugLog("getSuggestions: ",t),c.concat(l).map((u,g)=>({...u,order:g}))}async getSuggestions(e){var t;return e&&(this.suggestions=await this.searchSuggestions(e),(t=this.countInputEl)!=null&&t.classList.contains("another-quick-switcher__grep__count-input--error")||this.renderCountStatus(`${Math.min(this.suggestions.length,this.limit)} / ${this.suggestions.length}`)),this.suggestions}renderSuggestion(e,t){var m,p,h;let r=((m=this.suggestions[e.order-1])==null?void 0:m.file.path)===e.file.path,a=createDiv({cls:["another-quick-switcher__item",this.selectedItemMap[this.toKey(e)]?"another-quick-switcher__item__selected":""].filter(d=>d)}),o=createDiv({cls:"another-quick-switcher__item__entry"});if(!r){let d=createDiv({cls:["another-quick-switcher__item__title","another-quick-switcher__grep__item__title_entry"],attr:{extension:e.file.extension}}),f=e.file.basename;for(let y of e.submatches.filter(w=>w.type==="title")){let w=f.indexOf(y.match.text),k=f.slice(0,w);d.createSpan({text:k}),d.createSpan({text:y.match.text,cls:"another-quick-switcher__hit_word"}),f=f.slice(w+y.match.text.length)}d.createSpan({text:f});let v=te(e.file);if(e.file.extension!=="md"||v){let y=createDiv({cls:"another-quick-switcher__item__extension",text:v?"excalidraw":e.file.extension});d.appendChild(y)}if(o.appendChild(d),a.appendChild(o),this.settings.showDirectory){let y=createDiv({cls:"another-quick-switcher__item__directory"});y.insertAdjacentHTML("beforeend",D);let w=this.settings.showFullPathOfDirectory?(p=e.file.parent)==null?void 0:p.path:(h=e.file.parent)==null?void 0:h.name;y.appendText(` ${w}`),o.appendChild(y),this.settings.showDirectoryAtNewLine&&a.appendChild(y)}}let l=createDiv({cls:"another-quick-switcher__item__descriptions"}),c=createDiv({cls:"another-quick-switcher__grep__item__description"}),u=Ue(e.submatches.filter(d=>d.type==="text"),e.line).sort((d,f)=>d.start-f.start),g=0;for(let d of u){if(d.start>g){let f=e.line.slice(g,d.start);c.createSpan({text:Q(f,this.settings.maxDisplayLengthAroundMatchedWord)})}c.createSpan({text:d.match.text,cls:"another-quick-switcher__hit_word"}),g=d.end}if(g<e.line.length){let d=e.line.slice(g);c.createSpan({text:Q(d,this.settings.maxDisplayLengthAroundMatchedWord)})}if(e.order<9){let d=createSpan({cls:"another-quick-switcher__grep__item__hot-key-guide",text:`${e.order+1}`});l.appendChild(d)}l.appendChild(c),a.appendChild(l),t.appendChild(a)}renderCountStatus(e,t={}){var s;(s=this.countWrapperEl)==null||s.remove(),this.countWrapperEl=createDiv({cls:"another-quick-switcher__grep__count-wrapper"}),this.countInputEl=createDiv({text:e,cls:t.error?"another-quick-switcher__grep__count-input another-quick-switcher__grep__count-input--error":"another-quick-switcher__grep__count-input"}),this.countWrapperEl.appendChild(this.countInputEl),this.clonedInputEl.before(this.countWrapperEl),this.renderCheckedCountBadge("another-quick-switcher__grep__checked-count-badge",this.countWrapperEl)}navigate(e){this.navQueue=this.navQueue.then(e)}async chooseCurrentSuggestion(e,t={}){var l;let s=this.getSelectedItem();if(!s)return null;let r=e==="same-tab",a=!t.keepOpen;a&&this.usedPreview&&(this.skipRecentHistoryRestoreOnClose=!0,r&&(this.skipRestoreOnClose=!0)),a?(this.close(),this.navigate(()=>this.isClosed)):r&&((l=this.stateToRestore)!=null||(this.stateToRestore=this.appHelper.captureState(this.initialLeaf)),this.usedPreview=!0);let o=t.keepOpen===!0;return this.navigate(async()=>{try{await this.appHelper.openFile(s.file,{leafType:e,line:s.lineNumber-1,inplace:t.keepOpen,preventDuplicateTabs:this.settings.preventDuplicateTabs},this.stateToRestore)}finally{if(o)this.scheduleRecentHistoryRestore(this.recentHistorySnapshot);else if(a&&this.usedPreview){let c=this.buildRecentHistoryForFinalOpen(this.recentHistorySnapshot,this.recentHistoryBaseFilePath,s.file.path);this.scheduleRecentHistoryRestore(c)}}}),a&&r&&this.usedPreview&&this.navigate(()=>{var u,g;let c=(g=(u=this.stateToRestore)==null?void 0:u.leaf)!=null?g:this.initialLeaf;this.appHelper.restoreLeafHistorySnapshot(c!=null?c:null,this.historySnapshot)}),s.file}async onChooseSuggestion(e,t){await this.chooseCurrentSuggestion(ne(t))}resetQueryHistoryNavigationBase(){var e,t;this.queryHistoryBaseQuery=(t=(e=this.clonedInputEl)==null?void 0:e.value)!=null?t:"",this.queryHistoryIndex=Y.queryHistories.length}recordCurrentQueryToHistory(e){var r,a;let t=((a=e!=null?e:(r=this.clonedInputEl)==null?void 0:r.value)!=null?a:"").trim();if(!t){this.resetQueryHistoryNavigationBase();return}let s=Y.queryHistories;s[s.length-1]!==t&&(s.push(t),s.length>50&&s.shift()),this.resetQueryHistoryNavigationBase()}navigateQueryHistory(e){var a;let t=Y.queryHistories;if(t.length===0)return;this.queryHistoryIndex===t.length?this.queryHistoryBaseQuery=this.clonedInputEl.value:this.queryHistoryBaseQuery===null&&this.resetQueryHistoryNavigationBase();let s=e==="back"?-1:1,r=this.queryHistoryIndex+s;for(;r>=0&&r<=t.length;){let o=this.clonedInputEl.value,l=r===t.length?(a=this.queryHistoryBaseQuery)!=null?a:"":t[r];if(l!==o){this.queryHistoryIndex=r,this.clonedInputEl.value=l,this.inputEl.value=l,this.currentQuery=l,this.triggerSearch({useDebounce:!0});return}r+=s}}triggerSearch(e){if(this.currentQuery=this.clonedInputEl.value,this.inputEl.value=this.currentQuery,e!=null&&e.useDebounce&&this.settings.grepSearchDelayMilliSeconds>0){this.debounceInputEvent();return}this.validateRegexInput(),this.currentQuery.length&&this.inputEl.dispatchEvent(new Event("input"))}toggleInput(){document.activeElement===this.clonedInputEl?this.basePathInputEl.focus():this.clonedInputEl.focus()}validateRegexInput(){var a,o,l,c,u,g,m,p,h;let e=(o=(a=this.clonedInputEl)==null?void 0:a.value)==null?void 0:o.trim();if(!e){(l=this.clonedInputEl)==null||l.classList.remove("another-quick-switcher__grep__input--invalid"),(c=this.countInputEl)!=null&&c.classList.contains("another-quick-switcher__grep__count-input--error")&&((u=this.countWrapperEl)==null||u.remove(),this.countWrapperEl=void 0,this.countInputEl=void 0);return}let t=V(e),s=!1,r="";for(let d of t)if(!ft(d)){s=!0,r=d;break}s?((g=this.clonedInputEl)==null||g.classList.add("another-quick-switcher__grep__input--invalid"),this.renderCountStatus(`Invalid regex pattern: ${r}`,{error:!0})):((m=this.clonedInputEl)==null||m.classList.remove("another-quick-switcher__grep__input--invalid"),(p=this.countInputEl)!=null&&p.classList.contains("another-quick-switcher__grep__count-input--error")&&((h=this.countWrapperEl)==null||h.remove(),this.countWrapperEl=void 0,this.countInputEl=void 0))}registerKeys(e,t){let s=this.settings.hotkeys.grep[e];for(let r of s)this.scope.register(r.modifiers,q(O(r.key)),a=>{if(!a.isComposing)return a.preventDefault(),t(),!1})}async preview(){await this.chooseCurrentSuggestion("same-tab",{keepOpen:!0})}setHotkeys(){var s;this.scope.unregister(this.scope.keys.find(r=>r.key==="Enter")),this.scope.unregister(this.scope.keys.find(r=>r.key==="Escape")),this.scope.unregister(this.scope.keys.find(r=>r.key==="Home")),this.scope.unregister(this.scope.keys.find(r=>r.key==="End"));let e=G(this.settings.userAltInsteadOfModForQuickResultSelection);this.settings.hideHotkeyGuides||this.setInstructions([{command:"[\u21B5]",purpose:"open"},{command:"[\u2191]",purpose:"up"},{command:"[\u2193]",purpose:"down"},{command:`[${e} 1~9]`,purpose:"open Nth"},...x(this.settings.hotkeys.grep)]),this.clonedInputEl=this.inputEl.cloneNode(!0),(s=this.inputEl.parentNode)==null||s.replaceChild(this.clonedInputEl,this.inputEl),this.clonedInputElKeydownEventListener=r=>{let a=r,o=this.settings.hotkeys.grep.search[0];o&&wt(o,a)&&(r.preventDefault(),this.triggerSearch())},this.clonedInputEl.addEventListener("keydown",this.clonedInputElKeydownEventListener),this.debounceInputEvent=this.settings.grepSearchDelayMilliSeconds>0?(0,Qe.debounce)(()=>{this.currentQuery=this.clonedInputEl.value,this.inputEl.value=this.currentQuery,this.validateRegexInput(),this.currentQuery.length>=this.settings.grepMinQueryLength&&this.inputEl.dispatchEvent(new Event("input"))},this.settings.grepSearchDelayMilliSeconds,!0):(0,Qe.debounce)(()=>{this.validateRegexInput()},0,!0),this.clonedInputElInputEventListener=()=>{this.debounceInputEvent()},this.clonedInputEl.addEventListener("input",this.clonedInputElInputEventListener),this.registerKeys("up",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"}))}),this.registerKeys("down",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"}))}),this.registerKeys("scroll preview up",()=>{this.scrollActiveLeafByPage("up")}),this.registerKeys("scroll preview down",()=>{this.scrollActiveLeafByPage("down")}),this.registerKeys("clear input",()=>{this.clonedInputEl.value="",this.clonedInputEl.dispatchEvent(new InputEvent("input")),this.clonedInputEl.focus()}),this.registerKeys("clear path",()=>{this.basePathInputEl.value="",this.basePathInputEl.dispatchEvent(new InputEvent("change"))}),this.registerKeys("set ./ to path",()=>{this.basePathInputEl.value="./",this.basePathInputEl.dispatchEvent(new InputEvent("change"))}),this.registerKeys("toggle input",()=>{this.toggleInput()}),this.registerKeys("previous search history",()=>{this.navigateQueryHistory("back")}),this.registerKeys("next search history",()=>{this.navigateQueryHistory("forward")}),this.registerKeys("open",async()=>{let r=this.getCheckedItems();if(r.length>0){this.close();for(let a of r.slice())await this.appHelper.openFile(a.file,{leafType:"new-tab",line:a.lineNumber-1,preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("same-tab")}),this.registerKeys("open in new tab",async()=>{let r=this.getCheckedItems();if(r.length>0){this.close();for(let a of r.slice())await this.appHelper.openFile(a.file,{leafType:"new-tab",line:a.lineNumber-1,preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("new-tab")}),this.registerKeys("open in new pane (horizontal)",async()=>{let r=this.getCheckedItems();if(r.length>0){this.close();for(let a of r.slice())await this.appHelper.openFile(a.file,{leafType:"new-pane-horizontal",line:a.lineNumber-1,preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("new-pane-horizontal")}),this.registerKeys("open in new pane (vertical)",async()=>{let r=this.getCheckedItems();if(r.length>0){this.close();for(let a of r.slice())await this.appHelper.openFile(a.file,{leafType:"new-pane-vertical",line:a.lineNumber-1,preventDuplicateTabs:this.settings.preventDuplicateTabs}),await sleep(0)}else await this.chooseCurrentSuggestion("new-pane-vertical")}),this.registerKeys("open in new window",async()=>{await this.chooseCurrentSuggestion("new-window")}),this.registerKeys("open in popup",async()=>{await this.chooseCurrentSuggestion("popup")}),this.registerKeys("check/uncheck",async()=>{await this.toggleCheckedItem()}),this.registerKeys("check/uncheck and next",async()=>{await this.toggleCheckedItem({moveNext:!0})}),this.registerKeys("check/uncheck all",()=>{this.toggleCheckAll()}),this.registerKeys("uncheck all",()=>{this.uncheckAll()}),this.registerKeys("preview",()=>this.preview());let t=this.settings.userAltInsteadOfModForQuickResultSelection?"Alt":"Mod";for(let r of[1,2,3,4,5,6,7,8,9])this.scope.register([t],String(r),a=>(this.chooser.setSelectedItem(r-1,a),this.chooser.useSelectedItem({}),!1));this.registerKeys("dismiss",async()=>{this.close()})}};var Ls=require("obsidian");var $e=class extends I{constructor(e,t,s){super(e);this.hitItems=[];this.unsafeSelectedIndex=0;this.modalEl.addClass("another-quick-switcher__modal-prompt"),this.limit=1e3,this.appHelper=new C(e),this.settings=t,this.floating=s,this.autoPreview=t.autoPreviewInFloatingHeaderSearch&&s,this.stateToRestore=this.appHelper.captureStateInFile(),this.initialCursor=this.appHelper.getCurrentEditor().getCursor(),this.navQueue=Promise.resolve(),this.items=this.appHelper.getHeadersInActiveFile().map((r,a)=>({value:ce(r.heading),level:r.level,position:r.position,hit:!1,index:a})),this.inputEl.addEventListener("input",r=>{var l,c;let a=r;if(this.hitItems.length===0){this.select(this.unsafeSelectedIndex,a);return}let o=(c=(l=this.hitItems.find(u=>u.index>=this.unsafeSelectedIndex))==null?void 0:l.index)!=null?c:this.hitItems[0].index;this.select(o,a)}),this.setHotkeys()}toKey(e){return String(e.index)}navigate(e){this.navQueue=this.navQueue.then(e)}onClose(){super.onClose(),this.disableFloatingModalWheelScroll(),this.navigate(()=>this.stateToRestore.restore())}select(e,t,s){var a;this.chooser.setSelectedItem(e,t),(a=this.chooser.suggestions.at(e))==null||a.scrollIntoView({behavior:"auto",block:"center",inline:"center"}),this.unsafeSelectedIndex=e;let r=this.items.at(this.unsafeSelectedIndex);this.autoPreview&&r&&!s&&this.appHelper.moveTo(r.position)}getNextSelectIndex(){return this.unsafeSelectedIndex+1>this.items.length-1?0:this.unsafeSelectedIndex+1}getPreviousSelectIndex(){return this.unsafeSelectedIndex-1<0?this.items.length-1:this.unsafeSelectedIndex-1}onOpen(){super.onOpen(),this.floating&&(this.enableFloating(),this.refreshPreviewIcon());let e=this.appHelper.getMarkdownViewInActiveLeaf();if(!e||this.items.length===0)return;let s=e.getMode()==="source"?this.appHelper.getCurrentOffset():e.editor.posToOffset({ch:0,line:e.previewMode.getScroll()});if(!s)return;let r=this.items.findIndex(a=>a.position.start.offset>s);r===-1?this.select(this.items.last().index,void 0,!0):r===0?this.select(0,void 0,!0):this.select(r-1,void 0,!0)}refreshPreviewIcon(){var e,t;(e=this.previewIcon)==null||e.remove(),this.autoPreview&&(this.previewIcon=this.inputEl.insertAdjacentElement("afterend",createDiv({cls:"another-quick-switcher__header__auto-preview-icon"})),(t=this.previewIcon)==null||t.insertAdjacentHTML("beforeend",re))}enableFloating(){this.floating=!0,Ls.Platform.isPhone||(K(this.appHelper),this.enableFloatingModalWheelScroll())}getSuggestions(e){let t=V(e),s=this.items.map(r=>{let a=t.length>0&&t.every(o=>E(r.value,o,this.settings.normalizeAccentsAndDiacritics));return{...r,hit:a}});return this.hitItems=s.filter(r=>r.hit),s}renderSuggestion(e,t){let s=createDiv({cls:"another-quick-switcher__item"}),r=createDiv({cls:"another-quick-switcher__item__entry"}),a=createDiv({cls:["another-quick-switcher__item__title","another-quick-switcher__item__title__header",e.hit?"another-quick-switcher__item__title__header_hit":"another-quick-switcher__item__title__header_no_hit",`another-quick-switcher__item__title__header${e.level}`],text:e.value});if(r.appendChild(a),e.hit){let o=this.hitItems.findIndex(l=>l.index===e.index);o!==-1&&r.createSpan({cls:"another-quick-switcher__item__title__header_hit__counter",text:`${o+1} / ${this.hitItems.length}`})}s.appendChild(r),t.appendChild(s)}async onChooseSuggestion(e){this.appHelper.moveTo(e.position,void 0,this.initialCursor)}registerKeys(e,t){var s;for(let r of(s=this.settings.hotkeys.header[e])!=null?s:[])this.scope.register(r.modifiers,q(O(r.key)),a=>{if(!a.isComposing)return a.preventDefault(),t(a),!1})}setHotkeys(){this.scope.unregister(this.scope.keys.find(a=>a.key==="Escape")),this.scope.unregister(this.scope.keys.find(a=>a.key==="Home")),this.scope.unregister(this.scope.keys.find(a=>a.key==="End")),this.settings.hideHotkeyGuides||this.setInstructions([{command:"[\u21B5]",purpose:"move to header"},{command:"[\u2191]",purpose:"up"},{command:"[\u2193]",purpose:"down"},...x(this.settings.hotkeys.header)]);let e=a=>{this.select(this.getNextSelectIndex(),a)},t=a=>{this.select(this.getPreviousSelectIndex(),a)},s=a=>{var l,c;if(this.hitItems.length===1)return;if(this.hitItems.length===0){e(a);return}let o=(c=(l=this.hitItems.find(u=>u.index>this.unsafeSelectedIndex))==null?void 0:l.index)!=null?c:this.hitItems[0].index;this.select(o,a)},r=a=>{if(this.hitItems.length===1)return;if(this.hitItems.length===0){t(a);return}let o=this.hitItems.findIndex(c=>c.index>=this.unsafeSelectedIndex),l=o===0?this.hitItems.length-1:o-1;this.select(this.hitItems[l].index,a)};for(let a of this.scope.keys.filter(o=>["ArrowDown","ArrowUp"].includes(o.key)))this.scope.unregister(a);this.scope.register([],"ArrowUp",a=>(a.preventDefault(),t(a),!1)),this.scope.register([],"ArrowDown",a=>(a.preventDefault(),e(a),!1)),this.registerKeys("up",a=>{t(a)}),this.registerKeys("down",a=>{e(a)}),this.registerKeys("scroll preview up",()=>{this.scrollActiveLeafByPage("up")}),this.registerKeys("scroll preview down",()=>{this.scrollActiveLeafByPage("down")}),this.registerKeys("clear input",()=>{this.inputEl.value="",this.inputEl.dispatchEvent(new InputEvent("input"))}),this.registerKeys("move to next hit",a=>{s(a)}),this.registerKeys("move to previous hit",a=>{r(a)}),this.registerKeys("toggle auto preview",()=>{this.autoPreview=!this.autoPreview,this.refreshPreviewIcon(),this.autoPreview&&!this.floating&&this.enableFloating()}),this.registerKeys("insert all to editor",async()=>{this.close();let a=this.chooser.values;if(!a)return;let o=pe(a,l=>l.level).level;for(let l of a)this.appHelper.insertStringToActiveFile(`${" ".repeat((l.level-o)*4)}- ${l.value}
`)}),this.registerKeys("dismiss",async()=>{this.close()})}};var At=require("obsidian");var Se={query:"",selected:null},je=class extends I{constructor(e,t){super(e);this.unsafeSelectedIndex=0;this.suggestions=[];this.modalEl.addClass("another-quick-switcher__modal-prompt"),this.appHelper=new C(e),this.settings=t,this.logger=z.of(this.settings),this.floating=this.settings.autoPreviewInFloatingInFileSearch,this.autoPreview=t.autoPreviewInFloatingInFileSearch,this.stateToRestore=this.appHelper.captureStateInFile(),this.initialCursor=this.appHelper.getCurrentEditor().getCursor(),this.navQueue=Promise.resolve(),this.limit=255,this.setHotkeys(),this.setPlaceholder("Type anything then shows the results")}toKey(e){return String(e.lineNumber)}close(){At.Platform.isMobile&&this.onClose(),super.close()}async init(){await this.indexingItems()}navigate(e){this.navQueue=this.navQueue.then(e)}onOpen(){var e;if(this.isOpen=!0,this.inputEl.value=Se.query,this.inputEl.select(),this.updateSuggestions(),this.floating&&(this.enableFloating(),this.refreshPreviewIcon()),Se.selected!=null&&this.chooser.suggestions.length>0){let t=Math.min(Se.selected,this.chooser.suggestions.length-1);this.select(t),(e=this.chooser.suggestions.at(t))==null||e.scrollIntoView({behavior:"auto",block:"center",inline:"center"})}this.inputEl.addEventListener("input",t=>{let s=t;this.suggestions.length!==0&&this.select(Math.min(this.unsafeSelectedIndex,this.suggestions.length-1),s)}),this.opened=!0}onClose(){super.onClose(),this.disableFloatingModalWheelScroll(),Se.query=this.inputEl.value,Se.selected=this.chooser.values!=null?this.chooser.selectedItem:null,this.navigate(()=>this.stateToRestore.restore())}select(e,t){if(this.chooser.setSelectedItem(e,t),this.unsafeSelectedIndex=e,this.autoPreview){let s={line:this.chooser.values[e].lineNumber-1,offset:0,col:0};this.appHelper.moveTo({start:s,end:s})}}getNextSelectIndex(){return this.chooser.selectedItem+1>this.chooser.suggestions.length-1?0:this.chooser.selectedItem+1}getPreviousSelectIndex(){return this.chooser.selectedItem-1<0?this.chooser.suggestions.length-1:this.chooser.selectedItem-1}refreshPreviewIcon(){var e,t;(e=this.previewIcon)==null||e.remove(),this.autoPreview&&(this.previewIcon=this.inputEl.insertAdjacentElement("afterend",createDiv({cls:"another-quick-switcher__in-file__auto-preview-icon"})),(t=this.previewIcon)==null||t.insertAdjacentHTML("beforeend",re))}enableFloating(){this.floating=!0,At.Platform.isPhone||(K(this.appHelper),this.enableFloatingModalWheelScroll())}async indexingItems(){let e=this.appHelper.getCurrentEditor().getValue().split(`
`);this.ignoredItems=e.map((t,s)=>({lineBefore:nt(this.settings.inFileContextLines).reverse().map(r=>e[s-r-1]).filter(he),line:t,lineAfter:nt(this.settings.inFileContextLines).map(r=>e[s+r+1]).filter(he),lineNumber:s+1}))}getSuggestions(e){var o;let t=performance.now(),s=e.trim()==="",r=V(e.trim());this.currentQueriesRegExp=new RegExp(r.map(Pe).join("|"),"gi");let a=s?[]:this.ignoredItems.filter(l=>r.every(c=>$t(l.line,c,this.settings.normalizeAccentsAndDiacritics)));return this.logger.showDebugLog(`Get suggestions: ${e}`,t),(o=this.countInputEl)==null||o.remove(),this.countInputEl=createDiv({text:`${Math.min(a.length,this.limit)} / ${a.length}`,cls:"another-quick-switcher__in-file__status__count-input"}),this.inputEl.before(this.countInputEl),this.suggestions=a.slice(0,this.limit).map((l,c)=>({...l,order:c})),this.suggestions}renderSuggestion(e,t){let s=createDiv({cls:["another-quick-switcher__item","another-quick-switcher__in-file__item"]}),r=createDiv({cls:"another-quick-switcher__item__descriptions"}),a=createDiv({cls:"another-quick-switcher__in-file__item__description"});e.lineBefore.forEach((m,p)=>{let h=a.createDiv({cls:"another-quick-switcher__in-file__line"});h.createSpan({text:String(e.lineNumber-e.lineBefore.length+p),cls:"another-quick-switcher__in-file__line-number"}),h.createSpan({text:Q(m,this.settings.inFileMaxDisplayLengthAroundMatchedWord)})});let o=a.createDiv({cls:["another-quick-switcher__in-file__line","another-quick-switcher__in-file__active-line"]});o.createSpan({text:e.lineNumber.toString(),cls:"another-quick-switcher__in-file__line-number"});let l=o.createDiv(),c=e.line,u=0,g=Array.from(c.matchAll(this.currentQueriesRegExp)).map(m=>({index:m.index,text:m[0]}));for(let{index:m,text:p}of g){let h=c.slice(0,m-u);l.createSpan({text:Q(h,this.settings.inFileMaxDisplayLengthAroundMatchedWord)}),l.createSpan({text:p,cls:"another-quick-switcher__hit_word"}),u+=h.length+p.length,c=e.line.slice(u)}if(l.createSpan({text:Q(c,this.settings.inFileMaxDisplayLengthAroundMatchedWord)}),e.lineAfter.forEach((m,p)=>{let h=a.createDiv({cls:"another-quick-switcher__in-file__line"});h.createSpan({text:String(e.lineNumber+p+1),cls:"another-quick-switcher__in-file__line-number"}),h.createSpan({text:Q(m,this.settings.inFileMaxDisplayLengthAroundMatchedWord)})}),e.order<9){let m=createSpan({cls:"another-quick-switcher__in-file__item__hot-key-guide",text:`${e.order+1}`});r.appendChild(m)}r.appendChild(a),s.appendChild(r),t.appendChild(s)}async onChooseSuggestion(e){this.appHelper.moveTo(this.appHelper.getCurrentEditor().posToOffset({line:e.lineNumber-1,ch:0}),void 0,this.initialCursor)}registerKeys(e,t){var s;for(let r of(s=this.settings.hotkeys["in-file"][e])!=null?s:[])this.scope.register(r.modifiers,q(O(r.key)),a=>{if(!a.isComposing)return a.preventDefault(),t(a),!1})}setHotkeys(){this.scope.unregister(this.scope.keys.find(o=>o.key==="Escape")),this.scope.unregister(this.scope.keys.find(o=>o.key==="Home")),this.scope.unregister(this.scope.keys.find(o=>o.key==="End"));let e=G(this.settings.userAltInsteadOfModForQuickResultSelection);this.settings.hideHotkeyGuides||this.setInstructions([{command:"[\u21B5]",purpose:"open"},{command:"[\u2191]",purpose:"up"},{command:"[\u2193]",purpose:"down"},{command:`[${e} 1~9]`,purpose:"open Nth"},...x(this.settings.hotkeys["in-file"])]);let t=o=>{this.select(this.getNextSelectIndex(),o)},s=o=>{this.select(this.getPreviousSelectIndex(),o)},r=this.scope.keys.filter(o=>["ArrowDown","ArrowUp"].includes(o.key));for(let o of r)this.scope.unregister(o);this.scope.register([],"ArrowUp",o=>(o.preventDefault(),s(o),!1)),this.scope.register([],"ArrowDown",o=>(o.preventDefault(),t(o),!1)),this.registerKeys("up",o=>{s(o)}),this.registerKeys("down",o=>{t(o)}),this.registerKeys("scroll preview up",()=>{this.scrollActiveLeafByPage("up")}),this.registerKeys("scroll preview down",()=>{this.scrollActiveLeafByPage("down")}),this.registerKeys("insert to editor",async()=>{var c;let o=(c=this.chooser.values)==null?void 0:c[this.chooser.selectedItem];if(!o)return;let l=this.appHelper.getCurrentEditor();l&&(l.setCursor(this.initialCursor),this.appHelper.insertStringToActiveFile(o.line),this.close())}),this.registerKeys("show all results",()=>{this.limit=Number.MAX_SAFE_INTEGER,this.inputEl.dispatchEvent(new Event("input"))});let a=this.settings.userAltInsteadOfModForQuickResultSelection?"Alt":"Mod";for(let o of[1,2,3,4,5,6,7,8,9])this.scope.register([a],String(o),l=>(this.chooser.setSelectedItem(o-1,l),this.chooser.useSelectedItem({}),!1));this.registerKeys("toggle auto preview",()=>{this.autoPreview=!this.autoPreview,this.refreshPreviewIcon(),this.autoPreview&&(this.select(this.unsafeSelectedIndex),this.floating||this.enableFloating())}),this.registerKeys("dismiss",async()=>{this.close()})}};var Ye=require("obsidian");var Ge=class extends I{constructor(e,t,s){super(e);this.suggestions=[];this.isClosed=new Promise(e=>{this.markClosed=e});this.navQueue=Promise.resolve();this.modalEl.addClass("another-quick-switcher__modal-prompt"),this.vaultRootPath=j(this.app.vault.adapter.basePath),this.appHelper=new C(e),this.settings=t,this.logger=z.of(this.settings),this.initialLeaf=s,this.floating=!1,this.autoPreview=t.autoPreviewInFloatingLinkSearch,this.limit=255,this.setHotkeys(),this.debounceGetSuggestions=(0,Ye.debounce)((r,a)=>{a(this._getSuggestions(r))},this.settings.searchDelayMilliSeconds,!0)}toKey(e){return String(e.offset)}async init(){this.indexingItems()}onOpen(){super.onOpen(),this.enableFloating(),this.opened=!0,this.setupAutoPreviewListeners(),this.refreshPreviewIcon(),this.requestAutoPreview()}onClose(){super.onClose(),this.disableFloatingModalWheelScroll(),this.stateToRestore&&this.navigate(()=>this.stateToRestore.restore()),this.navigate(this.markClosed)}enableFloating(){this.floating=!0,Ye.Platform.isPhone||(K(this.appHelper),this.enableFloatingModalWheelScroll())}setupAutoPreviewListeners(){this.originalSetSelectedItem||(this.originalSetSelectedItem=this.chooser.setSelectedItem.bind(this.chooser),this.chooser.setSelectedItem=(e,t)=>{var s;(s=this.originalSetSelectedItem)==null||s.call(this,e,t),this.requestAutoPreview()})}refreshPreviewIcon(){var e,t;(e=this.previewIcon)==null||e.remove(),this.previewIcon=null,this.autoPreview&&(this.previewIcon=this.inputEl.insertAdjacentElement("afterend",createDiv({cls:"another-quick-switcher__link__auto-preview-icon"})),(t=this.previewIcon)==null||t.insertAdjacentHTML("beforeend",re))}requestAutoPreview(){!this.autoPreview||!this.opened||this.preview()}async preview(){await this.chooseCurrentSuggestion("same-tab",{keepOpen:!0})}indexingItems(){let e=[],t=this.appHelper.getLinksByFilePathInActiveFile();if(t){for(let[s,r]of Object.entries(t)){let a=this.appHelper.getFileByPath(s),o=this.appHelper.getCurrentEditor().getValue(),l=r.filter(u=>!ie(u)),c=Ce(l,u=>u.position.start.line);for(let u of c)e.push({file:a,displayLink:u.displayText,line:o.split(`
`).at(u.position.start.line),lineNumber:u.position.start.line+1,offset:u.position.start.offset})}this.ignoredItems=e}}getSuggestions(e){return!e||!this.opened?this._getSuggestions(e):new Promise(t=>{this.debounceGetSuggestions(e,s=>{t(s)})})}_getSuggestions(e){var o;let t=performance.now(),s=e.trim()==="",r=e.trim().split(" "),a=s?this.ignoredItems:this.ignoredItems.filter(l=>r.every(c=>l.file&&E(l.file.path,c,this.settings.normalizeAccentsAndDiacritics)||E(l.line,c,this.settings.normalizeAccentsAndDiacritics)));return this.logger.showDebugLog(`Get suggestions: ${e}`,t),(o=this.countInputEl)==null||o.remove(),this.countInputEl=createDiv({text:`${Math.min(a.length,this.limit)} / ${a.length}`,cls:"another-quick-switcher__link__status__count-input"}),this.inputEl.before(this.countInputEl),this.suggestions=a.slice(0,this.limit).map((l,c)=>({...l,order:c})),this.suggestions}renderSuggestion(e,t){var u,g,m,p,h,d,f,v,y,w,k,S,M,F;let r=((p=(g=(u=this.suggestions[e.order-1])==null?void 0:u.file)==null?void 0:g.path)!=null?p:(m=this.suggestions[e.order-1])==null?void 0:m.displayLink)===((d=(h=e.file)==null?void 0:h.path)!=null?d:e.displayLink),a=createDiv({cls:"another-quick-switcher__item"}),o=createDiv({cls:"another-quick-switcher__item__entry"});if(!r){let W=(v=(f=e.file)==null?void 0:f.extension)!=null?v:"md",N=createDiv({cls:["another-quick-switcher__item__title","another-quick-switcher__link__item__title_entry"],text:(w=(y=e.file)==null?void 0:y.basename)!=null?w:e.displayLink,attr:{extension:W}}),Z=te(e.file);if(W!=="md"||Z){let P=createDiv({cls:"another-quick-switcher__item__extension",text:Z?"excalidraw":W});N.appendChild(P)}if(o.appendChild(N),a.appendChild(o),this.settings.showDirectory){let P=createDiv({cls:"another-quick-switcher__item__directory"});P.insertAdjacentHTML("beforeend",D);let L=this.settings.showFullPathOfDirectory?(S=(k=e.file)==null?void 0:k.parent)==null?void 0:S.path:(F=(M=e.file)==null?void 0:M.parent)==null?void 0:F.name;P.appendText(` ${L}`),o.appendChild(P),this.settings.showDirectoryAtNewLine&&a.appendChild(P)}}let l=createDiv({cls:"another-quick-switcher__item__descriptions"}),c=createDiv({cls:"another-quick-switcher__link__item__description"});if(c.createSpan({text:e.line}),e.order<9){let W=createSpan({cls:"another-quick-switcher__link__item__hot-key-guide",text:`${e.order+1}`});l.appendChild(W)}l.appendChild(c),a.appendChild(l),t.appendChild(a)}navigate(e){this.navQueue=this.navQueue.then(e)}async chooseCurrentSuggestion(e,t={}){var r,a;let s=(r=this.chooser.values)==null?void 0:r[this.chooser.selectedItem];return s?(t.keepOpen?e==="same-tab"&&((a=this.stateToRestore)!=null||(this.stateToRestore=this.appHelper.captureState(this.initialLeaf))):(this.close(),this.navigate(()=>this.isClosed)),this.navigate(()=>this.appHelper.openFile(this.appHelper.getActiveFile(),{leafType:e,line:s.lineNumber-1,inplace:t.keepOpen,preventDuplicateTabs:this.settings.preventDuplicateTabs},this.stateToRestore)),this.appHelper.getActiveFile()):null}async onChooseSuggestion(e,t){await this.chooseCurrentSuggestion(ne(t))}registerKeys(e,t){var s;for(let r of(s=this.settings.hotkeys.link[e])!=null?s:[])this.scope.register(r.modifiers,q(O(r.key)),a=>{if(!a.isComposing)return a.preventDefault(),t(),!1})}setHotkeys(){this.scope.unregister(this.scope.keys.find(s=>s.key==="Enter")),this.scope.unregister(this.scope.keys.find(s=>s.key==="Escape")),this.scope.unregister(this.scope.keys.find(s=>s.key==="Home")),this.scope.unregister(this.scope.keys.find(s=>s.key==="End"));let e=G(this.settings.userAltInsteadOfModForQuickResultSelection);this.settings.hideHotkeyGuides||this.setInstructions([{command:"[\u21B5]",purpose:"open"},{command:"[\u2191]",purpose:"up"},{command:"[\u2193]",purpose:"down"},{command:`[${e} 1~9]`,purpose:"open Nth"},...x(this.settings.hotkeys.link)]),this.registerKeys("up",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"}))}),this.registerKeys("down",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"}))}),this.registerKeys("scroll preview up",()=>{this.scrollActiveLeafByPage("up")}),this.registerKeys("scroll preview down",()=>{this.scrollActiveLeafByPage("down")}),this.registerKeys("open",async()=>{await this.chooseCurrentSuggestion("same-tab")}),this.registerKeys("open in new tab",async()=>{await this.chooseCurrentSuggestion("new-tab")}),this.registerKeys("open in new pane (horizontal)",async()=>{await this.chooseCurrentSuggestion("new-pane-horizontal")}),this.registerKeys("open in new pane (vertical)",async()=>{await this.chooseCurrentSuggestion("new-pane-vertical")}),this.registerKeys("open in new window",async()=>{await this.chooseCurrentSuggestion("new-window")}),this.registerKeys("open in popup",async()=>{await this.chooseCurrentSuggestion("popup")}),this.registerKeys("show all results",()=>{this.limit=Number.MAX_SAFE_INTEGER,this.inputEl.dispatchEvent(new Event("input"))}),this.registerKeys("preview",async()=>{await this.chooseCurrentSuggestion("same-tab",{keepOpen:!0})}),this.registerKeys("toggle auto preview",()=>{this.autoPreview=!this.autoPreview,this.refreshPreviewIcon(),this.autoPreview&&!this.floating&&this.enableFloating(),this.autoPreview&&this.requestAutoPreview()});let t=this.settings.userAltInsteadOfModForQuickResultSelection?"Alt":"Mod";for(let s of[1,2,3,4,5,6,7,8,9])this.scope.register([t],String(s),r=>(this.chooser.setSelectedItem(s-1,r),this.chooser.useSelectedItem({}),!1));this.registerKeys("dismiss",async()=>{this.close()})}};var Xe=require("obsidian");function Vi(n){if(n.length===0)return[];let i=[...n].sort((s,r)=>s.start-r.start),e=[],t=i[0];for(let s=1;s<i.length;s++){let r=i[s];r.start<=t.end+1?t={start:t.start,end:Math.max(t.end,r.end)}:(e.push(t),t=r)}return e.push(t),e}function Ds(n,i){let e=document.createDocumentFragment();if(!i||i.length===0)return e.appendChild(document.createTextNode(n)),e;let t=Vi(i),s=-1;for(let r of t){if(r.start>s+1){let o=n.slice(s+1,r.start);o&&e.appendChild(document.createTextNode(o))}let a=n.slice(r.start,r.end+1);if(a){let o=createSpan({cls:"another-quick-switcher__hit_word",text:a});e.appendChild(o)}s=r.end}if(s+1<n.length){let r=n.slice(s+1);r&&e.appendChild(document.createTextNode(r))}return e}function Qi(n,i,e,t){let s=i.split("/"),r=s.pop();return s.every(a=>n.folder.parent&&E(n.folder.parent.path,a,t))&&e(n,r)}function Wi(n,i,e,t){return i.every(s=>Qi(n,s,e,t))}function $i(n,i,e){var r;let t=i.join(" "),s=de(n.folder.name,t,e);switch(s.type){case"starts-with":return{...n,matchType:"prefix-name",score:s.score,ranges:s.ranges};case"includes":return{...n,matchType:"name",score:s.score,ranges:s.ranges};case"fuzzy":return{...n,matchType:"fuzzy-name",score:s.score,ranges:s.ranges}}if(Wi(n,i,(a,o)=>E(a.folder.path,o,e),e)){let a=((r=n.folder.parent)==null?void 0:r.name)||"",o=de(a,t,e);return{...n,matchType:"directory",directoryRanges:o.ranges}}return n}function ji(n,i){let e=i.indexOf(n.folder.path);return e!==-1?{...n,isRecentlyUsed:!0,recentlyUsedIndex:e}:n}function Gi(n,i){return n.sort((e,t)=>{var s,r;switch(i){case"Recently used":{let a=(s=e.recentlyUsedIndex)!=null?s:999999,o=(r=t.recentlyUsedIndex)!=null?r:999999;return a-o}case"Alphabetical":return e.folder.name.localeCompare(t.folder.name);case"Alphabetical reverse":return t.folder.name.localeCompare(e.folder.name);default:return 0}})}var Je=class extends Xe.SuggestModal{constructor(e,t){super(e);this.recentFolders=[];this.modalEl.addClass("another-quick-switcher__modal-prompt"),this.appHelper=new C(e),this.settings=t,this.setHotkeys(),this.originItems=this.appHelper.getFolders().map(s=>({folder:s.isRoot()?Object.assign({},s,{name:"<VAULT_ROOT>"}):s})),this.filteredItems=_e(this.originItems,this.settings.moveFileExcludePrefixPathPatterns,s=>s.folder.path)}async onOpen(){await this.loadRecentlyUsedFolders(),super.onOpen()}getRecentlyUsedFilePath(){return this.settings.moveFileRecentlyUsedFilePath||".obsidian/plugins/obsidian-another-quick-switcher/recently-used-folders.json"}async loadRecentlyUsedFolders(){let e=this.getRecentlyUsedFilePath();try{if(await this.app.vault.adapter.exists(e)){let t=await this.app.vault.adapter.read(e);this.recentFolders=JSON.parse(t)}}catch(t){console.warn("Failed to load recently used folders:",t),this.recentFolders=[]}}async saveRecentlyUsedFolders(){let e=this.getRecentlyUsedFilePath();try{let t=e.substring(0,e.lastIndexOf("/"));await this.app.vault.adapter.exists(t)||await this.app.vault.adapter.mkdir(t),await this.app.vault.adapter.write(e,JSON.stringify(this.recentFolders,null,2))}catch(t){console.warn("Failed to save recently used folders:",t)}}async updateRecentlyUsedFolder(e){let t=this.recentFolders.indexOf(e);t>-1&&this.recentFolders.splice(t,1),this.recentFolders.unshift(e),this.recentFolders.length>this.settings.moveFileMaxRecentlyUsedFolders&&this.recentFolders.pop(),await this.saveRecentlyUsedFolders()}getSuggestions(e){let t=e.split(" ").filter(a=>a),s=this.filteredItems.map(a=>$i(a,t,this.settings.normalizeAccentsAndDiacritics)).filter(a=>a.matchType).map(a=>ji(a,this.recentFolders));return Gi(s,this.settings.moveFolderSortPriority).slice(0,10)}renderSuggestion(e,t){var u;let s=createDiv({cls:["another-quick-switcher__item","another-quick-switcher__directory_item"]}),r=createDiv({cls:"another-quick-switcher__item__entry"}),a=createDiv({cls:"another-quick-switcher__item__title"}),o=Ds(e.folder.name,e.ranges);a.appendChild(o),r.appendChild(a);let l=createDiv({cls:"another-quick-switcher__item__directory"});l.insertAdjacentHTML("beforeend",D);let c=((u=e.folder.parent)==null?void 0:u.name)||"";if(e.matchType==="directory"&&e.directoryRanges){l.appendText(" ");let g=Ds(c,e.directoryRanges);l.appendChild(g)}else l.appendText(` ${c}`);r.appendChild(l),s.appendChild(r),t.appendChild(s)}async onChooseSuggestion(e){let t=this.app.workspace.getActiveFile();if(!t)return;let s=`${e.folder.path}/${t.name}`;if(await this.appHelper.exists(s)){let r=`${t.basename}.${window.moment().format("YYYYMMDD_HHmmss_SSS")}.${t.extension}`;s=`${e.folder.path}/${r}`,new Xe.Notice(`Since a file with the same name already exists in the destination directory, it will be moved and renamed ${r}`)}await this.app.fileManager.renameFile(t,s),await this.updateRecentlyUsedFolder(e.folder.path)}registerKeys(e,t){var s;for(let r of(s=this.settings.hotkeys.move[e])!=null?s:[])this.scope.register(r.modifiers,r.key.toUpperCase(),a=>(a.preventDefault(),t(),!1))}setHotkeys(){this.scope.unregister(this.scope.keys.find(e=>e.key==="Escape")),this.scope.unregister(this.scope.keys.find(e=>e.key==="Home")),this.scope.unregister(this.scope.keys.find(e=>e.key==="End")),this.settings.hideHotkeyGuides||this.setInstructions([{command:"[\u21B5]",purpose:"move to"},{command:"[\u2191]",purpose:"up"},{command:"[\u2193]",purpose:"down"},...x(this.settings.hotkeys.move)]),this.registerKeys("up",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowUp"}))}),this.registerKeys("down",()=>{document.dispatchEvent(new KeyboardEvent("keydown",{key:"ArrowDown"}))}),this.registerKeys("open in default app",()=>{var t,s;let e=(s=(t=this.chooser.values)==null?void 0:t[this.chooser.selectedItem])==null?void 0:s.folder;e&&(this.appHelper.openFolderInDefaultApp(e),this.close())}),this.registerKeys("dismiss",async()=>{this.close()})}};var Yi="search-command";function Ji(n,i,e){var a,o,l,c;let t=(o=(a=n.workspace.getActiveViewOfType(R.FileView))==null?void 0:a.leaf)!=null?o:null,s=(c=(l=n.workspace.getActiveViewOfType(R.MarkdownView))==null?void 0:l.editor)!=null?c:null;new Oe({app:n,settings:i,command:e,originFile:n.workspace.getActiveFile(),inputQuery:i.useSelectionWordsAsDefaultInputQuery&&(s==null?void 0:s.getSelection())||null,navigationHistories:[],currentNavigationHistoryIndex:0,stackHistory:!0,initialLeaf:t}).open()}function Xi(n,i){new Ke(n,i).open()}function Zi(n,i){if(!n.workspace.getActiveFile())return;new Je(n,i).open()}async function Pt(n,i,e){var r,a;if(!R.Platform.isDesktop){new R.Notice("Grep is not supported on mobile.");return}if(!await Ts(i.ripgrepCommand)){new R.Notice(`"${i.ripgrepCommand}" was not working as a ripgrep command. If you have not installed ripgrep yet, please install it.`);return}let t=(a=(r=n.workspace.getActiveViewOfType(R.FileView))==null?void 0:r.leaf)!=null?a:null;new We(n,i,t,e).open()}async function en(n,i){var s,r;if(!n.workspace.getActiveFile())return;let e=(r=(s=n.workspace.getActiveViewOfType(R.FileView))==null?void 0:s.leaf)!=null?r:null,t=new qe(n,i,e);await t.init(),t.open()}async function tn(n,i){var s,r;if(!n.workspace.getActiveFile())return;let e=(r=(s=n.workspace.getActiveViewOfType(R.FileView))==null?void 0:s.leaf)!=null?r:null,t=new Ge(n,i,e);await t.init(),t.open()}async function sn(n,i){if(!n.workspace.getActiveFile())return;let e=new je(n,i);await e.init(),e.open()}function Rs(n,i,e){if(!n.workspace.getActiveFile())return;new $e(n,i,e).open()}async function nn(n){var c;let i=Re(),e=n.settings.commandPaletteHistoryPath||".obsidian/plugins/obsidian-another-quick-switcher/command-history.json",{lastUsedMap:t={},queryUsedMap:s={}}=(c=await ts(e))!=null?c:{},r=n.settings.commandPaletteMaxHistoryRetentionDays>0?ae(t,(u,g)=>i-g>n.settings.commandPaletteMaxHistoryRetentionDays*24*60*60):t,a=n.settings.commandPaletteMaxHistoryRetentionDays>0?ae(s,(u,g)=>r[g]==null):s,o=Xt().map(u=>({...u,lastUsed:r[u.id]}));new ze(n.app,o,r,a,e,n.settings).open()}function Bs(n,i){return[{id:"header-search-in-file",name:"Header search in file",checkCallback:e=>{if(e)return!!n.workspace.getActiveFile();Rs(n,i,!1)}},{id:"header-floating-search-in-file",name:"Header floating search in file",checkCallback:e=>{if(e)return!!n.workspace.getActiveFile();Rs(n,i,!0)}},{id:"folder",name:"Reveal a folder in the file tree",hotkeys:[],callback:()=>{Xi(n,i)}},{id:"move",name:"Move file to another folder",hotkeys:[{modifiers:["Mod","Shift"],key:"m"}],checkCallback:e=>{if(e)return!!n.workspace.getActiveFile();Zi(n,i)}},{id:"grep",name:"Grep",hotkeys:[],checkCallback:e=>{if(e)return R.Platform.isDesktop;Pt(n,i)}},{id:"backlink",name:"Backlink search",hotkeys:[],checkCallback:e=>{if(e)return!!n.workspace.getActiveFile();en(n,i)}},{id:"link",name:"Link search",hotkeys:[],checkCallback:e=>{if(e)return!!n.workspace.getActiveFile();tn(n,i)}},{id:"in-file-search",name:"In file search",hotkeys:[],checkCallback:e=>{if(e)return!!n.workspace.getActiveFile();sn(n,i)}},{id:"command-palette",name:"Command palette",hotkeys:[],callback:()=>{nn({app:n,settings:i})}},...i.searchCommands.filter(e=>e.name.trim().length>0).map(e=>({id:`${Yi}_${e.name.replace(/ /g,"-").toLowerCase()}`,name:e.name,hotkeys:[],callback:()=>{Ji(n,i,e)}}))]}var Ze=class extends Os.Plugin{async onload(){if(this.appHelper=new C(this.app),await this.loadSettings(),this.addSettingTab(new Te(this.app,this)),this.appHelper.isCacheInitialized())this.reloadCommands();else{let i=this.app.metadataCache.on("resolved",async()=>{this.reloadCommands(),this.app.metadataCache.offref(i)})}}reloadCommands(){let i=this.appHelper.getCommandIds(this.manifest.id);for(let t of i)this.appHelper.removeCommand(t);let e=Bs(this.app,this.settings);for(let t of e)this.addCommand(t)}async loadSettings(){let i=await this.loadData();this.settings=Ht.default.withOptions({mergeArrays:!1},ys,i!=null?i:{}),this.settings.searchCommands.forEach((s,r)=>{this.settings.searchCommands[r]=Ht.default.withOptions({mergeArrays:!1},xt(),{...this.settings.searchCommands[r]}),this.settings.searchCommands[r].searchTarget==="markdown"&&(this.settings.searchCommands[r].searchTarget="file")});let e=Ct(),t=Object.keys(e);for(let s of t){let r=Object.keys(this.settings.hotkeys[s]);for(let a of r)a in e[s]||delete this.settings.hotkeys[s][a]}}async saveSettings(){await this.saveData(this.settings)}};

/* nosourcemap */